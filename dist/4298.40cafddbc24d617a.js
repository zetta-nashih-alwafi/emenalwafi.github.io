"use strict";(self.webpackChunkGene=self.webpackChunkGene||[]).push([[4298],{54298:(yt,U,u)=>{u.d(U,{U:()=>Ct});var e=u(94650),C=u(29521),E=u(36895),f=u(24006),S=u(65938),O=u(34318),T=u(9749),d=u(17489),y=u(80013),P=u(68745),L=u(35226),p=u.n(L),B=u(26698),I=u(33296),D=u(89383),R=u(52688),k=u(91013),F=u(80484),w=u(84075),N=u(84130),x=u(73555),A=u(47957),V=u(3238),G=u(4859),v=u(77331),j=u(97392),M=u(59549),W=u(284),K=u(10266),Q=u(24784),H=u(37204);const Y=["myInput"],J=["languagesInput"],$=["recipientCc"],q=["recipientBcc"],z=["auto"],X=["chipList"];function Z(h,g){if(1&h){const s=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",31),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(s);const n=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(n.addDoc())}),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()}2&h&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"Add document")," "))}function tt(h,g){if(1&h){const s=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"mat-icon",32),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(s);const n=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(n.sendMail())}),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275text(2,"send"),e.\u0275\u0275elementEnd()}2&h&&e.\u0275\u0275propertyInterpolate("matTooltip",e.\u0275\u0275pipeBind1(1,1,"MailBox.SEND"))}function et(h,g){1&h&&(e.\u0275\u0275elementStart(0,"mat-icon",33),e.\u0275\u0275text(1,"send"),e.\u0275\u0275elementEnd())}function it(h,g){1&h&&(e.\u0275\u0275elementStart(0,"mat-icon",36),e.\u0275\u0275text(1,"cancel"),e.\u0275\u0275elementEnd())}function st(h,g){if(1&h){const s=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"mat-chip",34),e.\u0275\u0275listener("removed",function(){const t=e.\u0275\u0275restoreView(s).$implicit,o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.removeTo(t))}),e.\u0275\u0275text(1),e.\u0275\u0275template(2,it,2,0,"mat-icon",35),e.\u0275\u0275elementEnd()}if(2&h){const s=g.$implicit,i=e.\u0275\u0275nextContext();e.\u0275\u0275property("selectable",i.selectable)("removable",i.removable),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",s," "),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",i.removable)}}function nt(h,g){1&h&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&h&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(2,1,"This field is required")))}function at(h,g){if(1&h&&(e.\u0275\u0275elementStart(0,"mat-option",37),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&h){const s=g.$implicit;e.\u0275\u0275property("value",s),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",s," ")}}function rt(h,g){1&h&&(e.\u0275\u0275elementStart(0,"mat-icon",36),e.\u0275\u0275text(1,"cancel"),e.\u0275\u0275elementEnd())}function ot(h,g){if(1&h){const s=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"mat-chip",34),e.\u0275\u0275listener("removed",function(){const t=e.\u0275\u0275restoreView(s).$implicit,o=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(o.removeCc(t))}),e.\u0275\u0275text(1),e.\u0275\u0275template(2,rt,2,0,"mat-icon",35),e.\u0275\u0275elementEnd()}if(2&h){const s=g.$implicit,i=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("selectable",i.selectable)("removable",i.removable),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",s," "),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",i.removable)}}function lt(h,g){if(1&h){const s=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"mat-option",42),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(s);const n=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(n.resetValueCc())}),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()}if(2&h){const s=g.$implicit;e.\u0275\u0275property("value",s),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",s," ")}}function ct(h,g){1&h&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&h&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(2,1,"This field is required")))}function ht(h,g){if(1&h){const s=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"mat-form-field",16)(1,"mat-chip-list",null,38),e.\u0275\u0275template(3,ot,3,4,"mat-chip",19),e.\u0275\u0275elementStart(4,"input",39,40),e.\u0275\u0275listener("matChipInputTokenEnd",function(n){e.\u0275\u0275restoreView(s);const t=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(t.addCc(n))}),e.\u0275\u0275pipe(6,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(7,"mat-autocomplete",23,24),e.\u0275\u0275listener("optionSelected",function(n){e.\u0275\u0275restoreView(s);const t=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(t.setSelectedEmailCc(n))}),e.\u0275\u0275template(9,lt,2,2,"mat-option",41),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(10,ct,3,3,"mat-error",22),e.\u0275\u0275elementEnd()}if(2&h){const s=e.\u0275\u0275reference(2),i=e.\u0275\u0275reference(8),n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",n.selectedEmailCc),e.\u0275\u0275advance(1),e.\u0275\u0275propertyInterpolate1("placeholder"," ",e.\u0275\u0275pipeBind1(6,8,"MailBox.composeMail.cc"),""),e.\u0275\u0275property("matAutocomplete",i)("matChipInputFor",s)("matChipInputSeparatorKeyCodes",n.separatorKeysCodesCc)("matChipInputAddOnBlur",n.addOnBlurCc),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngForOf",n.emailAddressesListCc),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",n.sendEmailForm.get("cc").hasError("required")&&(n.sendEmailForm.get("cc").dirty||n.sendEmailForm.get("cc").touched))}}function dt(h,g){1&h&&(e.\u0275\u0275elementStart(0,"mat-icon",36),e.\u0275\u0275text(1,"cancel"),e.\u0275\u0275elementEnd())}function pt(h,g){if(1&h){const s=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"mat-chip",34),e.\u0275\u0275listener("removed",function(){const t=e.\u0275\u0275restoreView(s).$implicit,o=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(o.removeBcc(t))}),e.\u0275\u0275text(1),e.\u0275\u0275template(2,dt,2,0,"mat-icon",35),e.\u0275\u0275elementEnd()}if(2&h){const s=g.$implicit,i=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("selectable",i.selectable)("removable",i.removable),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",s," "),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",i.removable)}}function mt(h,g){if(1&h&&(e.\u0275\u0275elementStart(0,"mat-option",37),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&h){const s=g.$implicit;e.\u0275\u0275property("value",s),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",s," ")}}function ut(h,g){1&h&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&h&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(2,1,"This field is required")))}function gt(h,g){if(1&h){const s=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"mat-form-field",16)(1,"mat-chip-list",null,43),e.\u0275\u0275template(3,pt,3,4,"mat-chip",19),e.\u0275\u0275elementStart(4,"input",44,45),e.\u0275\u0275listener("matChipInputTokenEnd",function(n){e.\u0275\u0275restoreView(s);const t=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(t.addBcc(n))}),e.\u0275\u0275pipe(6,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(7,"mat-autocomplete",23,24),e.\u0275\u0275listener("optionSelected",function(n){e.\u0275\u0275restoreView(s);const t=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(t.setSelectedEmailBcc(n))}),e.\u0275\u0275template(9,mt,2,2,"mat-option",25),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(10,ut,3,3,"mat-error",22),e.\u0275\u0275elementEnd()}if(2&h){const s=e.\u0275\u0275reference(2),i=e.\u0275\u0275reference(8),n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",n.selectedEmailBcc),e.\u0275\u0275advance(1),e.\u0275\u0275propertyInterpolate1("placeholder"," ",e.\u0275\u0275pipeBind1(6,8,"MailBox.composeMail.bcc"),""),e.\u0275\u0275property("matAutocomplete",i)("matChipInputFor",s)("matChipInputSeparatorKeyCodes",n.separatorKeysCodesBcc)("matChipInputAddOnBlur",n.addOnBlurBcc),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngForOf",n.emailAddressesListBcc),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",n.sendEmailForm.get("bcc").hasError("required")&&(n.sendEmailForm.get("bcc").dirty||n.sendEmailForm.get("bcc").touched))}}function ft(h,g){1&h&&(e.\u0275\u0275elementStart(0,"mat-error"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&h&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(2,1,"This field is required")))}const _t=function(h,g){return{pointer:h,pointer:g}};function bt(h,g){if(1&h){const s=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",46)(1,"button",47)(2,"mat-icon"),e.\u0275\u0275text(3,"insert_drive_file"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(4,"label",48),e.\u0275\u0275listener("click",function(){const t=e.\u0275\u0275restoreView(s).$implicit,o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.openAttachment(t))}),e.\u0275\u0275text(5),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"button",49),e.\u0275\u0275listener("click",function(){const t=e.\u0275\u0275restoreView(s).$implicit,o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.removeAttachment(t))}),e.\u0275\u0275elementStart(7,"mat-icon"),e.\u0275\u0275text(8," close "),e.\u0275\u0275elementEnd()()()}if(2&h){const s=g.$implicit;e.\u0275\u0275advance(4),e.\u0275\u0275property("ngClass",e.\u0275\u0275pureFunction2(2,_t,null==s?null:s.is_from_builder,"Invoice"===(null==s?null:s.document_id))),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(s.name)}}var b=(()=>{return(h=b||(b={})).LABEL="LABEL",h.VALUE="VALUE",h.OBJECT="OBJECT",b;var h})();let Ct=(()=>{class h{constructor(s,i,n,t,o,l,r,m,a,c){this.translate=s,this.userService=i,this.mailboxService=n,this.dialogref=t,this.fileUploadService=o,this.fb=l,this.utilService=r,this.permissions=m,this.dialog=a,this.recepientData=c,this.subs=new P.Y,this.Editor=T,this.showCC=!1,this.showBCC=!1,this.dragging=!1,this.loaded=!1,this.imageLoaded=!1,this.triggeredFromStudent=!0,this.imageSrc=[],this.config={toolbar:["heading","|","fontsize","|","bold","italic","Underline","strikethrough","highlight","|","alignment","|","numberedList","bulletedList","|"]},this.selectedEmailTo=[],this.selectedEmailCc=[],this.selectedEmailBcc=[],this.isDraftMail=!1,this.DraftData=[],this.visible=!0,this.selectable=!0,this.removable=!0,this.addOnBlur=!0,this.addOnBlurCc=!0,this.addOnBlurBcc=!0,this.allowOther=!1,this.returnType=b.LABEL,this.optionSelected=new e.EventEmitter,this.separatorKeysCodes=[C.K5,C.OC],this.separatorKeysCodesCc=[C.K5,C.OC],this.separatorKeysCodesBcc=[C.K5,C.OC],this.languagesCtrl=new f.UntypedFormControl,this.languages=[],this.currentMailData=[],this.tags=[],this.isUrgentFlag=!1,this.isSenderReq=!0,this.userTypeToggle=!1,this.composeProcess=!1,this.showSubject=!0,this.isGroupEmail=!1,this.attachmnetsPaths=[],this.isSugesstion=!1,this.showCCInput=!1,this.showBCCInput=!1,this.check=!1,this.populated=!0,this.disableAddEditing=!0,this.displayBCC=!1,this.displayCC=!1,this.isShared=!1,this.selectedRecepientsList=[],this.ccselectedRecepientsList=[],this.bccselectedRecepientsList=[],this.recpList=[],this.recpListCc=[],this.recpListBcc=[],this.usersList=[],this.isUserAcadir=!1,this.isUserAcadAdmin=!1,this.isUserCrossCor=!1,this.isUserCorrector=!1,this.isUserAnimator=!1,this.isUserDirector=!1,this.isUserTeacher=!1,this.isUserPJM=!1,this.isUserAJM=!1,this.isUserCorrectorQuality=!1,this.isUserCorrectorProblematic=!1,this.isUserCertifierCorrector=!1,this.isuserPresidentJury=!1,this.isUserChiefGroupAcademic=!1,this.isUserCertifierAdmin=!1,this.isUserCertifierDir=!1,this.isUserStudent=!1,this.acadDirId="5a2e1ecd53b95d22c82f9554",this.acadAdminId="5a2e1ecd53b95d22c82f9555",this.certDirId="5a2e1ecd53b95d22c82f954f",this.certAdminId="5a2e1ecd53b95d22c82f9550",this.acadamicJuryMemberId="5cdbdeaf4b1f6a1b5a0b3fb6",this.professionalJuryMemberId="5cdbde9b4b1f6a1b5a0b3fb5",this.correctorId="5a2e1ecd53b95d22c82f9559",this.crossCorrectorId="5a9e7ddf8228f45eb2e9bc77",this.pcSchoolDirector="5a2e1ecd53b95d22c82f9553",this.teacherId="5a2e1ecd53b95d22c82f9558",this.studentId="5a067bba1c0217218c75f8ab",this.pcRoleIds=[this.acadDirId,this.pcSchoolDirector,this.acadAdminId,this.acadamicJuryMemberId,this.professionalJuryMemberId,this.teacherId,this.correctorId,this.crossCorrectorId,this.studentId],this.emailAddressesListTo=[],this.emailAddressesListCc=[],this.emailAddressesListBcc=[],this.isWarningTo=!1,this.sendEmailForm=this.fb.group({to:["",[f.Validators.required,O.I8]],cc:["",[f.Validators.required,O.I8]],bcc:["",[f.Validators.required,O.I8]],subject:["",[f.Validators.required,O.I8]],message:["",f.Validators.required],rncp_titles:[""],user_type_selection:[""],user_types:[""]})}ngOnInit(){this.isPermission=this.userService.getPermission(),this.getCurrentUser(),this.mailSignature(),this.patchEmailRecepient(),this.CheckforDraft()}onReady(s){console.log("Editor : ",s),s.ui.getEditableElement().parentElement.insertBefore(s.ui.view.toolbar.element,s.ui.getEditableElement())}patchEmailRecepient(){if(console.log("recepient data is:",this.recepientData),this.recepientData&&this.recepientData.student_id){let i=this.recepientData.student_id;this.preSelectedEmail=(i.civility&&"neutral"!==i.civility?this.translate.instant(i.civility)+" ":"")+i.first_name+" "+i.last_name+" <"+(this.recepientData.trombinoscope?i.school_mail:i.email)+">",this.selectedEmailTo.push((i.civility&&"neutral"!==i.civility?this.translate.instant(i.civility)+" ":"")+i.first_name+" "+i.last_name+" <"+(this.recepientData.trombinoscope?i.school_mail:i.email)+">"),this.emailAddressesListTo.push(this.preSelectedEmail),this.validateEmail(this.recepientData.trombinoscope?i.school_mail:i.email)?(this.selectedRecepientsList.push(this.recepientData.trombinoscope?i.school_mail:i.email),console.log("Success")):console.log("Eror"),this.recpList.push(this.recepientData.trombinoscope?i.school_mail:i.email)}this.sendEmailForm.get("to").setValue(null),this.sendEmailForm.get("subject").setValue("")}setSelectedEmailTo(s){const i=s.option.value,n=i.split(" ");let t="";n.forEach(_=>{t=_});const l=t.replace("<","").replace(">","");this.validateEmail(l)?(this.selectedEmailTo.push(i),this.selectedRecepientsList.push(i),console.log("Success")):console.log("Eror");const r=i.split(" ");let m="";r.forEach(_=>{m=_});const c=m.replace("<","").replace(">","");this.recpList.push(c),this.languagesInput.nativeElement.value="",this.sendEmailForm.get("to").setValue(null),this.emitSelectedLanguagesTo()}setSelectedEmailCc(s){const i=s.option.value,n=i.split(" ");let t="";n.forEach(_=>{t=_});const l=t.replace("<","").replace(">","");this.validateEmail(l)?(this.selectedEmailCc.push(i),this.selectedRecepientsList.push(i),console.log("Success")):console.log("Eror");const r=i.split(" ");let m="";r.forEach(_=>{m=_});const c=m.replace("<","").replace(">","");this.recpListCc.push(c),this.recipientCc.nativeElement.value="",this.sendEmailForm.get("cc").patchValue("",{emitEvent:!0}),this.sendEmailForm.get("cc").setValue("")}setSelectedEmailBcc(s){const i=s.option.value,n=i.split(" ");let t="";n.forEach(_=>{t=_});const l=t.replace("<","").replace(">","");this.validateEmail(l)?(this.selectedEmailBcc.push(i),this.selectedRecepientsList.push(i),console.log("Success")):console.log("Eror");const r=i.split(" ");let m="";r.forEach(_=>{m=_});const c=m.replace("<","").replace(">","");this.recpListBcc.push(c),this.sendEmailForm.get("bcc").setValue(null),this.sendEmailForm.get("bcc").setValue(""),this.recipientBcc.nativeElement.value=""}validateEmail(s){return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(s)}closeDialog(){p().fire({title:this.translate.instant("MailBox.composeMail.DRAFT.TITLE"),html:this.translate.instant("MailBox.composeMail.DRAFT.TEXT"),type:"warning",showCancelButton:!0,confirmButtonText:this.translate.instant("MailBox.composeMail.DRAFT.CONFIRMBTN"),cancelButtonText:this.translate.instant("MailBox.composeMail.DRAFT.DECBTN")}).then(s=>{s.value?(this.saveDraft(),this.dialogref.close()):this.dialogref.close()})}saveDraft(){if(this.isDraftMail){const s=this.sendEmailForm.value;if(""!==s.subject||""!==s.message&&void 0!==s.message){const i=[];this.mailData={};const n=this.recpList,t=this.recpListCc,o=this.recpListBcc;this.currentUser=this.userService.getLocalStorageUser();const l={sender:this.currentUser.email,is_read:!1,mail_type:"draft"};if(console.log("recipient.toString() : ",n,t,o),n){const a=n.toString().split(",");for(let c=0;c<a.length;c++)a[c]=a[c].replace(/^\s*/,"").replace(/\s*$/,""),this.validateEmail(a[c])&&i.push({recipients:[a[c]],rank:"a",is_read:!1,mail_type:"draft"})}if(t){const a=t.toString().split(",");for(let c=0;c<a.length;c++)a[c]=a[c].replace(/^\s*/,"").replace(/\s*$/,""),this.validateEmail(a[c])&&i.push({recipients:[a[c]],rank:"cc",is_read:!1,mail_type:"draft"})}if(o){const a=o.toString().split(",");for(let c=0;c<a.length;c++)a[c]=a[c].replace(/^\s*/,"").replace(/\s*$/,""),this.validateEmail(a[c])&&i.push({recipients:[a[c]],rank:"c",is_read:!1,mail_type:"draft"})}const r=[],m=[];this.attachmnetsPaths.forEach(a=>{const c={file_name:a&&a.file_name?a.file_name:a.name,path:a.path};m.push(a.is_from_builder?a.path:a.name),r.push(c)}),this.mailData.sender_property=l,this.mailData.recipient_properties=i,this.mailData.subject=s.subject,this.mailData.message=s.message,this.mailData.is_sent=!1,this.mailData.status="active",this.mailData.is_urgent_mail=!1,this.mailData.attachments=m,this.mailData.file_attachments=r,this.mailData.tags=["draft"],this.isGroupEmail&&(this.mailData.is_group_parent=this.isGroupEmail,this.mailData.user_type_selection=s.user_type_selection,this.mailData.group_detail=this.computeGroupDetails()),this.subs.sink=this.mailboxService.updateSingleMail(this.DraftData._id,this.mailData).subscribe(a=>{p().fire({type:"info",title:this.translate.instant("MailBox.MESSAGES.DRAFTMSG"),text:"",confirmButtonText:this.translate.instant("MailBox.MESSAGES.THANK")})},a=>{this.userService.postErrorLog(a),p().fire({type:"info",title:this.translate.instant("SORRY"),text:a&&a.message?this.translate.instant(a.message.replaceAll("GraphQL error: ","")):a,confirmButtonText:this.translate.instant("DISCONNECT_SCHOOL.BUTTON3")})})}}else{const s=this.sendEmailForm.value;if(""!==s.subject||""!==s.message&&void 0!==s.message){const i=[];this.mailData={};const n=this.recpList,t=this.recpListCc,o=this.recpListBcc;this.currentUser=this.userService.getLocalStorageUser();const l={sender:this.currentUser.email,is_read:!1,mail_type:"draft"};if(n){const a=n.toString().split(",");for(let c=0;c<a.length;c++)a[c]=a[c].replace(/^\s*/,"").replace(/\s*$/,""),this.validateEmail(a[c])&&i.push({recipients:[a[c]],rank:"a",is_read:!1,mail_type:"draft"})}if(t){const a=t.toString().split(",");for(let c=0;c<a.length;c++)a[c]=a[c].replace(/^\s*/,"").replace(/\s*$/,""),this.validateEmail(a[c])&&i.push({recipients:[a[c]],rank:"cc",is_read:!1,mail_type:"draft"})}if(o){const a=o.toString().split(",");for(let c=0;c<a.length;c++)a[c]=a[c].replace(/^\s*/,"").replace(/\s*$/,""),this.validateEmail(a[c])&&i.push({recipients:[a[c]],rank:"c",is_read:!1,mail_type:"draft"})}const r=[],m=[];this.attachmnetsPaths.forEach(a=>{const c={file_name:a&&a.file_name?a.file_name:a.name,path:a.path};m.push(a.is_from_builder?a.path:a.name),r.push(c)}),this.mailData.sender_property=l,this.mailData.recipient_properties=i,this.mailData.subject=s.subject,this.mailData.message=s.message,this.mailData.is_sent=!1,this.mailData.status="active",this.mailData.is_urgent_mail=!1,this.mailData.attachments=m,this.mailData.file_attachments=r,this.mailData.tags=["draft"],this.isGroupEmail&&(this.mailData.is_group_parent=this.isGroupEmail,this.mailData.user_type_selection=s.user_type_selection,this.mailData.group_detail=this.computeGroupDetails()),this.mailData.lang=this.translate.currentLang,this.subs.sink=this.mailboxService.createMail(this.mailData).subscribe(a=>{p().fire({type:"info",title:this.translate.instant("MailBox.MESSAGES.DRAFTMSG"),text:"",confirmButtonText:this.translate.instant("MailBox.MESSAGES.THANK")})},a=>{this.userService.postErrorLog(a),p().fire({type:"info",title:this.translate.instant("SORRY"),text:a&&a.message?this.translate.instant(a.message.replaceAll("GraphQL error: ","")):a,confirmButtonText:this.translate.instant("DISCONNECT_SCHOOL.BUTTON3")})})}}}sendMail(){if(this.isDraftMail){const s=this.sendEmailForm.value;if(""!==s.subject||""!==s.message&&void 0!==s.message){const i=[];this.mailData={};const n=this.recpList,t=this.recpListCc,o=this.recpListBcc;this.currentUser=this.userService.getLocalStorageUser();const l={sender:this.currentUser.email,is_read:!1,mail_type:"sent"};if(n){const a=n.toString().split(",");for(let c=0;c<a.length;c++)a[c]=a[c].replace(/^\s*/,"").replace(/\s*$/,""),this.validateEmail(a[c])&&i.push({recipients:[a[c]],rank:"a",is_read:!1,mail_type:"inbox"})}if(t){const a=t.toString().split(",");for(let c=0;c<a.length;c++)a[c]=a[c].replace(/^\s*/,"").replace(/\s*$/,""),this.validateEmail(a[c])&&i.push({recipients:[a[c]],rank:"cc",is_read:!1,mail_type:"inbox"})}if(o){const a=o.toString().split(",");for(let c=0;c<a.length;c++)a[c]=a[c].replace(/^\s*/,"").replace(/\s*$/,""),this.validateEmail(a[c])&&i.push({recipients:[a[c]],rank:"c",is_read:!1,mail_type:"inbox"})}const r=[],m=[];this.attachmnetsPaths.forEach(a=>{const c={file_name:a&&a.file_name?a.file_name:a.name,path:a.path};m.push(a.is_from_builder?a.path:a.name),r.push(c)}),this.mailData.sender_property=l,this.mailData.recipient_properties=i,this.mailData.subject=s.subject,this.mailData.message=s.message,this.mailData.is_sent=!0,this.mailData.status="active",this.mailData.attachments=m,this.mailData.file_attachments=r,this.mailData.tags=["sent"],this.isGroupEmail&&(this.mailData.is_group_parent=this.isGroupEmail,this.mailData.user_type_selection=s.user_type_selection,this.mailData.group_detail=this.computeGroupDetails()),this.mailData.lang=this.translate.currentLang,this.subs.sink=this.mailboxService.sendMail(this.DraftData._id,this.mailData).subscribe(a=>{this.composeProcess=!1,this.dialogref.close("updateMailList"),p().fire({title:this.translate.instant("MailBox.composeMail.MESSAGES.TITLE"),text:this.translate.instant("MailBox.composeMail.MESSAGES.TEXT"),allowEscapeKey:!0,type:"success",confirmButtonText:this.translate.instant("MailBox.composeMail.MESSAGES.CONFIRMBTN")})},a=>{this.userService.postErrorLog(a),p().fire({title:this.translate.instant("STUDENT.MESSAGE.ERRORTIT"),text:this.translate.instant("STUDENT.MESSAGE.ERRORMSG"),allowEscapeKey:!0,type:"info"}),this.composeProcess=!1})}}else{const s=this.sendEmailForm.value;if(""!==s.subject||""!==s.message&&void 0!==s.message){const i=[];this.mailData={};const n=this.recpList,t=this.recpListCc,o=this.recpListBcc;this.currentUser=this.userService.getLocalStorageUser();const l={sender:this.currentUser.email,is_read:!1,mail_type:"sent"};if(n){const a=n.toString().split(",");for(let c=0;c<a.length;c++)a[c]=a[c].replace(/^\s*/,"").replace(/\s*$/,""),this.validateEmail(a[c])&&i.push({recipients:[a[c]],rank:"a",is_read:!1,mail_type:"inbox"})}if(t){const a=t.toString().split(",");for(let c=0;c<a.length;c++)a[c]=a[c].replace(/^\s*/,"").replace(/\s*$/,""),this.validateEmail(a[c])&&i.push({recipients:[a[c]],rank:"cc",is_read:!1,mail_type:"inbox"})}if(o){const a=o.toString().split(",");for(let c=0;c<a.length;c++)a[c]=a[c].replace(/^\s*/,"").replace(/\s*$/,""),this.validateEmail(a[c])&&i.push({recipients:[a[c]],rank:"c",is_read:!1,mail_type:"inbox"})}const r=[],m=[];this.attachmnetsPaths.forEach(a=>{const c={file_name:a&&a.file_name?a.file_name:a.name,path:a.path};m.push(a.is_from_builder?a.path:a.name),r.push(c)}),this.mailData.sender_property=l,this.mailData.recipient_properties=i,this.mailData.subject=s.subject,this.mailData.message=s.message,this.mailData.is_sent=!0,this.mailData.status="active",this.mailData.attachments=m,this.mailData.file_attachments=r,this.mailData.tags=["sent"],this.isGroupEmail&&(this.mailData.is_group_parent=this.isGroupEmail,this.mailData.user_type_selection=s.user_type_selection,this.mailData.group_detail=this.computeGroupDetails()),this.mailData.lang=this.translate.currentLang,this.subs.sink=this.mailboxService.createMail(this.mailData).subscribe(a=>{this.composeProcess=!1,this.dialogref.close("updateMailList"),p().fire({title:this.translate.instant("MailBox.composeMail.MESSAGES.TITLE"),text:this.translate.instant("MailBox.composeMail.MESSAGES.TEXT"),allowEscapeKey:!0,type:"success",confirmButtonText:this.translate.instant("MailBox.composeMail.MESSAGES.CONFIRMBTN")})},a=>{this.userService.postErrorLog(a),this.composeProcess=!1,p().fire({type:"info",title:this.translate.instant("SORRY"),text:a&&a.message?this.translate.instant(a.message.replaceAll("GraphQL error: ","")):a,confirmButtonText:this.translate.instant("DISCONNECT_SCHOOL.BUTTON3")})})}}}deleteOldDraftMail(){this.isDraftMail&&this.DraftData._id&&(this.selectedEmailTo=[],this.selectedEmailTo.push(this.DraftData._id),this.subs.sink=this.mailboxService.deleteMail(this.selectedEmailTo).subscribe(s=>{},s=>{this.userService.postErrorLog(s)}))}getTranslateUserType(s){const i=this.translate.instant("ADMTCSTAFFKEY."+s.toUpperCase());return i!=="ADMTCSTAFFKEY."+s.toUpperCase()?i:s}getCurrentUser(){this.currentUser=this.userService.getLocalStorageUser(),this.subs.sink=this.userService.getUserById(this.currentUser._id).subscribe(s=>{this.userData=s,this.userTypeChecking()},s=>{this.userService.postErrorLog(s),p().fire({type:"info",title:this.translate.instant("SORRY"),text:s&&s.message?this.translate.instant(s.message.replaceAll("GraphQL error: ","")):s,confirmButtonText:this.translate.instant("DISCONNECT_SCHOOL.BUTTON3")})})}computeGroupDetails(){const s=this.sendEmailForm.get("rncp_titles").value.map(n=>n.id);let i=[];return this.sendEmailForm.get("user_type_selection").value&&(i=this.sendEmailForm.get("user_types").value.map(n=>n.id)),{rncp_titles:s,user_types:i}}simpleDiacriticSensitiveRegex(s){return s?s.replace(/[a,\xe1,\xe0,\xe4]/g,"a").replace(/[e,\xe9,\xeb,\xe8]/g,"e").replace(/[i,\xed,\xef,\xce,\xee]/g,"i").replace(/[o,\xf3,\xf6,\xf2,\xf4]/g,"o").replace(/[u,\xfc,\xfa,\xf9]/g,"u").replace(/[ ,-]/g," "):""}handleDragEnter(){this.dragging=!0}handleDragLeave(){this.dragging=!1}handleDrop(s){s.preventDefault(),this.dragging=!1,this.handleInputChange(s)}handleInputChange(s){const i=s.target.files[0];i&&(this.subs.sink=this.fileUploadService.singleUpload(i).subscribe(n=>{n&&this.attachmnetsPaths.push({path:n.file_url,name:n.file_name,is_from_builder:!1})},n=>{this.userService.postErrorLog(n),console.log("[Response BE][Error] : ",n),p().fire({type:"info",title:this.translate.instant("SORRY"),text:n&&n.message?this.translate.instant(n.message.replaceAll("GraphQL error: ","")):n,confirmButtonText:"OK"})})),this.resetFileState()}resetFileState(){this.currentFile.nativeElement.value=""}removeAttachment(s){this.attachmnetsPaths.splice(this.attachmnetsPaths.indexOf(s),1)}_handleReaderLoaded({file_name:s},i){const n=i.target,t=n.result.split(";")[0].split(":")[1];this.imageSrc.push({type:t,name:s,data:n.result}),this.loaded=!0}LoadAttachments(s){if(s&&Array.isArray(s)){const i=this;s.forEach(n=>{i.attachmnetsPaths.push({path:n,name:i.getFileName(n),is_from_builder:!1})})}}getFileName(s){return s?s.substring(s.lastIndexOf("/")+1):""}getRecipientsData(){this.subs.sink=this.sendEmailForm.get("to").valueChanges.pipe((0,y.b)(400)).subscribe(s=>{this.emailAddressesListTo=[],s&&s.length&&(this.subs.sink=this.mailboxService.getRecipientDataUsingName(s.toString()).subscribe(i=>{i&&i.length&&i.filter(t=>!this.selectedRecepientsList.includes(("neutral"!==t.civility?this.translate.instant(t.civility)+" ":"")+t.first_name+" "+t.last_name+" <"+t.email+">")).concat(this.selectedRecepientsList.filter(t=>!this.selectedRecepientsList.includes(("neutral"!==t.civility?t.civility+" ":"")+t.first_name+" "+t.last_name+" <"+t.email+">"))).forEach(t=>{void 0!==t.email&&this.emailAddressesListTo.push(("neutral"!==t.civility?this.translate.instant(t.civility)+" ":"")+t.first_name+" "+t.last_name+" <"+t.email+">")})},i=>{this.userService.postErrorLog(i),p().fire({type:"info",title:this.translate.instant("SORRY"),text:i&&i.message?this.translate.instant(i.message.replaceAll("GraphQL error: ","")):i,confirmButtonText:this.translate.instant("DISCONNECT_SCHOOL.BUTTON3")})}))}),this.subs.sink=this.sendEmailForm.get("cc").valueChanges.pipe((0,y.b)(400)).subscribe(s=>{this.emailAddressesListCc=[],s&&s.length&&(this.subs.sink=this.mailboxService.getRecipientDataUsingName(s.toString()).subscribe(i=>{i&&i.length&&i.filter(t=>!this.selectedRecepientsList.includes(("neutral"!==t.civility?this.translate.instant(t.civility)+" ":"")+t.first_name+" "+t.last_name+" <"+t.email+">")).concat(this.selectedRecepientsList.filter(t=>!this.selectedRecepientsList.includes(("neutral"!==t.civility?t.civility+" ":"")+t.first_name+" "+t.last_name+" <"+t.email+">"))).forEach(t=>{void 0!==t.email&&this.emailAddressesListCc.push(("neutral"!==t.civility?this.translate.instant(t.civility)+" ":"")+t.first_name+" "+t.last_name+" <"+t.email+">")})},i=>{this.userService.postErrorLog(i),p().fire({type:"info",title:this.translate.instant("SORRY"),text:i&&i.message?this.translate.instant(i.message.replaceAll("GraphQL error: ","")):i,confirmButtonText:this.translate.instant("DISCONNECT_SCHOOL.BUTTON3")})}))}),this.subs.sink=this.sendEmailForm.get("bcc").valueChanges.pipe((0,y.b)(400)).subscribe(s=>{this.emailAddressesListBcc=[],s&&s.length&&(this.subs.sink=this.mailboxService.getRecipientDataUsingName(s.toString()).subscribe(i=>{i&&i.length&&i.filter(t=>!this.selectedRecepientsList.includes(("neutral"!==t.civility?this.translate.instant(t.civility)+" ":"")+t.first_name+" "+t.last_name+" <"+t.email+">")).concat(this.selectedRecepientsList.filter(t=>!this.selectedRecepientsList.includes(("neutral"!==t.civility?t.civility+" ":"")+t.first_name+" "+t.last_name+" <"+t.email+">"))).forEach(t=>{void 0!==t.email&&this.emailAddressesListBcc.push(("neutral"!==t.civility?this.translate.instant(t.civility)+" ":"")+t.first_name+" "+t.last_name+" <"+t.email+">")})},i=>{this.userService.postErrorLog(i),p().fire({type:"info",title:this.translate.instant("SORRY"),text:i&&i.message?this.translate.instant(i.message.replaceAll("GraphQL error: ","")):i,confirmButtonText:this.translate.instant("DISCONNECT_SCHOOL.BUTTON3")})}))})}addTo(s){if(!this.matAutocomplete.isOpen){const i=s.chipInput.inputElement,n=s.value,t=n.split(" ");let o="";t.forEach(c=>{o=c});const r=o.replace("<","").replace(">","");this.validateEmail(r)?(n||"").trim()&&this.allowOther&&this.selectedEmailTo.push({label:n.trim(),value:n.trim()}):console.log("Error not email type!! : ",n);const m=this.sendEmailForm.get("to").dirty||this.sendEmailForm.get("to").touched;!this.selectedEmailTo.length&&m?(this.isWarningTo=!0,this.chipList.errorState=!0):(this.isWarningTo=!1,this.chipList.errorState=!1),i&&(i.value=""),this.sendEmailForm.get("to").setValue(null),this.sendEmailForm.get("to").setValue("")}this.emitSelectedLanguagesTo()}addCc(s){if(!this.matAutocomplete.isOpen){const i=s.chipInput.inputElement,n=s.value,t=n.split(" ");let o="";t.forEach(m=>{o=m});const r=o.replace("<","").replace(">","");this.validateEmail(r)?(n||"").trim()&&this.allowOther&&this.selectedEmailCc.push({label:n.trim(),value:n.trim()}):console.log("Error not email type!! : ",n),i&&(i.value=""),this.sendEmailForm.get("cc").setValue(null),this.sendEmailForm.get("cc").setValue("")}this.emitSelectedLanguagesCc()}addBcc(s){if(!this.matAutocomplete.isOpen){const i=s.chipInput.inputElement,n=s.value,t=n.split(" ");let o="";t.forEach(m=>{o=m});const r=o.replace("<","").replace(">","");this.validateEmail(r)?(n||"").trim()&&this.allowOther&&this.selectedEmailBcc.push({label:n.trim(),value:n.trim()}):console.log("Error not email type!! : ",n),i&&(i.value=""),this.sendEmailForm.get("bcc").setValue(null),this.sendEmailForm.get("bcc").setValue("")}this.emitSelectedLanguagesBcc()}emitSelectedLanguagesTo(){this.optionSelected.emit(this.returnType===b.OBJECT?this.selectedEmailTo:this.selectedEmailTo.map(this.returnType===b.VALUE?s=>s.value:s=>s.label))}emitSelectedLanguagesCc(){this.optionSelected.emit(this.returnType===b.OBJECT?this.selectedEmailCc:this.selectedEmailCc.map(this.returnType===b.VALUE?s=>s.value:s=>s.label))}emitSelectedLanguagesBcc(){this.optionSelected.emit(this.returnType===b.OBJECT?this.selectedEmailBcc:this.selectedEmailBcc.map(this.returnType===b.VALUE?s=>s.value:s=>s.label))}removeTo(s){const i=this.selectedEmailTo.findIndex(t=>t===s),n=this.selectedRecepientsList.findIndex(t=>t===s);i>=0&&this.selectedEmailTo.splice(i,1),n>=0&&this.selectedRecepientsList.splice(n,1),this.emitSelectedLanguagesTo()}removeCc(s){const i=this.selectedEmailCc.findIndex(t=>t===s),n=this.selectedRecepientsList.findIndex(t=>t===s);i>=0&&this.selectedEmailCc.splice(i,1),n>=0&&this.selectedRecepientsList.splice(n,1),this.emitSelectedLanguagesCc()}removeBcc(s){const i=this.selectedEmailBcc.findIndex(t=>t===s),n=this.selectedRecepientsList.findIndex(t=>t===s);i>=0&&this.selectedEmailBcc.splice(i,1),n>=0&&this.selectedRecepientsList.splice(n,1),this.emitSelectedLanguagesBcc()}CheckforDraft(){this.isDraftMail&&this.DraftData&&this.DraftData._id&&(this.sendEmailForm.get("subject").setValue(this.DraftData.subject),this.composeMailMessage=this.DraftData.message,this.sendEmailForm.get("message").setValue(this.composeMailMessage),this.selectedEmailTo=[],this.selectedEmailCc=[],this.selectedEmailBcc=[],this.DraftData.recipient_properties&&this.LoadRecepient(this.DraftData.recipient_properties,["a","c","cc"]),this.LoadAttachments(this.DraftData.attachments),this.DraftData.is_group_parent&&(this.userTypeToggle=this.DraftData.user_type_selection))}LoadRecipientReplyAll(s,i){Array.isArray(s)?(console.log("Data is Array!! ",s),s.forEach(n=>{"to"===i?this.subs.sink=this.mailboxService.getRecipientDataEmail(n.sender.email.toString()).subscribe(t=>{this.recpList.push(t.email),this.selectedEmailTo.push(("neutral"!==t.civility?this.translate.instant(t.civility)+" ":"")+t.first_name+" "+t.last_name+" <"+t.email+">")},t=>{this.userService.postErrorLog(t),p().fire({type:"info",title:this.translate.instant("SORRY"),text:t&&t.message?this.translate.instant(t.message.replaceAll("GraphQL error: ","")):t,confirmButtonText:this.translate.instant("DISCONNECT_SCHOOL.BUTTON3")})}):"cc"===i&&(this.subs.sink=this.mailboxService.getRecipientDataEmail(n.recipients[0].email.toString()).subscribe(t=>{"a"===n.rank&&this.currentUser.email!==t.email&&(this.recpList.push(t.email),this.selectedEmailTo.push(("neutral"!==t.civility?this.translate.instant(t.civility)+" ":"")+t.first_name+" "+t.last_name+" <"+t.email+">")),"cc"===n.rank&&this.currentUser.email!==t.email&&(this.recpListCc.push(t.email),this.showCC=!0,this.selectedEmailCc.push(("neutral"!==t.civility?this.translate.instant(t.civility)+" ":"")+t.first_name+" "+t.last_name+" <"+t.email+">"))},t=>{this.userService.postErrorLog(t),p().fire({type:"info",title:this.translate.instant("SORRY"),text:t&&t.message?this.translate.instant(t.message.replaceAll("GraphQL error: ","")):t,confirmButtonText:this.translate.instant("DISCONNECT_SCHOOL.BUTTON3")})}))})):(console.log("Data is not Array!! ",s),"to"===i?this.subs.sink=this.mailboxService.getRecipientDataEmail(s.sender.email.toString()).subscribe(n=>{this.recpList.push(n.email),this.selectedEmailTo.push(("neutral"!==n.civility?this.translate.instant(n.civility)+" ":"")+n.first_name+" "+n.last_name+" <"+n.email+">")},n=>{this.userService.postErrorLog(n),p().fire({type:"info",title:this.translate.instant("SORRY"),text:n&&n.message?this.translate.instant(n.message.replaceAll("GraphQL error: ","")):n,confirmButtonText:this.translate.instant("DISCONNECT_SCHOOL.BUTTON3")})}):"cc"===i&&(this.subs.sink=this.mailboxService.getRecipientDataEmail(s.sender.email.toString()).subscribe(n=>{"a"===s.rank&&this.currentUser.email!==n.email&&(this.recpList.push(n.email),this.selectedEmailTo.push(("neutral"!==n.civility?this.translate.instant(n.civility)+" ":"")+n.first_name+" "+n.last_name+" <"+n.email+">")),"cc"===s.rank&&this.currentUser.email!==n.email&&(this.recpListCc.push(n.email),this.showCC=!0,this.selectedEmailCc.push(("neutral"!==n.civility?this.translate.instant(n.civility)+" ":"")+n.first_name+" "+n.last_name+" <"+n.email+">"))},n=>{this.userService.postErrorLog(n),p().fire({type:"info",title:this.translate.instant("SORRY"),text:n&&n.message?this.translate.instant(n.message.replaceAll("GraphQL error: ","")):n,confirmButtonText:this.translate.instant("DISCONNECT_SCHOOL.BUTTON3")})})))}LoadRecepient(s,i,n=!1){Array.isArray(s)?(s.forEach(t=>{t&&t.recipients_email.length?this.selectedEmailTo=t.recipients_email:this.subs.sink=this.mailboxService.getRecipientDataEmail(t.recipients[0].email.toString()).subscribe(o=>{"a"===t.rank&&(o&&o.length?(this.recpList.push(o.email),this.selectedEmailTo.push(("neutral"!==o.civility?this.translate.instant(o.civility)+" ":"")+o.first_name+" "+o.last_name+" <"+o.email+">")):t&&t.recipients[0]&&(this.recpList.push(t.recipients[0].email),this.selectedEmailTo.push((t.recipients[0].civility&&"neutral"!==t.recipients[0].civility?this.translate.instant(t.recipients[0].civility):"")+" "+t.recipients[0].first_name+" "+t.recipients[0].last_name+" <"+t.recipients[0].email+">"))),"c"===t.rank&&(this.recpListBcc.push(o.email),this.showBCC=!0,this.selectedEmailBcc.push(("neutral"!==o.civility?this.translate.instant(o.civility)+" ":"")+o.first_name+" "+o.last_name+" <"+o.email+">")),"cc"===t.rank&&(this.recpListCc.push(o.email),this.showCC=!0,this.selectedEmailCc.push(("neutral"!==o.civility?this.translate.instant(o.civility)+" ":"")+o.first_name+" "+o.last_name+" <"+o.email+">")),null===t.rank&&(this.recpList.push(o.email),this.selectedEmailTo.push(("neutral"!==o.civility?this.translate.instant(o.civility)+" ":"")+o.first_name+" "+o.last_name+" <"+o.email+">"))},o=>{this.userService.postErrorLog(o),p().fire({type:"info",title:this.translate.instant("SORRY"),text:o&&o.message?this.translate.instant(o.message.replaceAll("GraphQL error: ","")):o,confirmButtonText:this.translate.instant("DISCONNECT_SCHOOL.BUTTON3")})})}),n&&this.selectedRecepientsList.push({email:this.currentMailData.sender_property.sender})):this.subs.sink=this.tags.indexOf("reply-mail")>-1&&this.currentMailData?this.mailboxService.getRecipientDataEmail(s.sender.email.toString()).subscribe(t=>{this.recpList.push(t.email),this.selectedEmailTo.push(("neutral"!==t.civility?this.translate.instant(t.civility)+" ":"")+t.first_name+" "+t.last_name+" <"+t.email+">")},t=>{this.userService.postErrorLog(t),p().fire({type:"info",title:this.translate.instant("SORRY"),text:t&&t.message?this.translate.instant(t.message.replaceAll("GraphQL error: ","")):t,confirmButtonText:this.translate.instant("DISCONNECT_SCHOOL.BUTTON3")})}):this.mailboxService.getRecipientDataEmail(s.recipients[0].email.toString()).subscribe(t=>{"a"===s.rank&&(t&&t.length?(this.recpList.push(t.email),this.selectedEmailTo.push(("neutral"!==t.civility?this.translate.instant(t.civility)+" ":"")+t.first_name+" "+t.last_name+" <"+t.email+">")):s&&s.recipients[0]&&(this.recpList.push(s.recipients[0].email),this.selectedEmailTo.push((s.recipients[0].civility&&"neutral"!==s.recipients[0].civility?this.translate.instant(s.recipients[0].civility):"")+" "+s.recipients[0].first_name+" "+s.recipients[0].last_name+" <"+s.recipients[0].email+">"))),"c"===s.rank&&(this.recpListBcc.push(t.email),this.showBCC=!0,this.selectedEmailBcc.push(("neutral"!==t.civility?this.translate.instant(t.civility)+" ":"")+t.first_name+" "+t.last_name+" <"+t.email+">")),"cc"===s.rank&&(this.recpListCc.push(t.email),this.showCC=!0,this.selectedEmailCc.push(("neutral"!==t.civility?this.translate.instant(t.civility)+" ":"")+t.first_name+" "+t.last_name+" <"+t.email+">")),null===s.rank&&(this.recpList.push(t.email),this.selectedEmailTo.push(("neutral"!==t.civility?this.translate.instant(t.civility)+" ":"")+t.first_name+" "+t.last_name+" <"+t.email+">"))},t=>{this.userService.postErrorLog(t),p().fire({type:"info",title:this.translate.instant("SORRY"),text:t&&t.message?this.translate.instant(t.message.replaceAll("GraphQL error: ","")):t,confirmButtonText:this.translate.instant("DISCONNECT_SCHOOL.BUTTON3")})})}if(s){this.selectedRecepientsList.push({email:this.currentMailData.sender_property.sender})}resetValueTo(){this.sendEmailForm.get("to").patchValue("",{emitEvent:!0})}resetValueCc(){this.sendEmailForm.get("cc").patchValue("",{emitEvent:!0})}resetValueBcc(){this.sendEmailForm.get("bcc").patchValue("",{emitEvent:!0})}mailSignature(){let s="";this.recepientData&&this.recepientData.student_id&&(console.log("masuk dong"),s+=this.translate.instant("Hello")+" ",s+=("neutral"!==this.recepientData.student_id.civility?this.translate.instant(this.recepientData.student_id.civility):"")+" "+this.recepientData.student_id.first_name+" "+this.recepientData.student_id.last_name),this.composeMailMessage="<p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p>",this.composeMailMessage+=("neutral"!==this.currentUser.civility?this.translate.instant(this.currentUser.civility):"")+" "+this.currentUser.first_name+" "+this.currentUser.last_name;const i=this.currentUser.entities.filter(t=>t.type.name===this.isPermission[0]),n=d.uniqBy(i,"school.short_name");this.composeMailMessage+=this.currentUser?.position?",<br>"+this.currentUser?.position:"",this.composeMailMessage+=n&&n.length&&n[0].school&&n[0].school.short_name?",<br>"+n[0].school.short_name:"",this.tags.indexOf("reply-mail")>-1&&this.currentMailData?(this.sendEmailForm.get("subject").setValue("RE : "+this.currentMailData.subject),this.LoadRecepient(this.currentMailData.sender_property,[],this.isSenderReq),this.LoadAttachments(this.currentMailData.attachments),this.composeMailMessage=this.AddMailBody("Message")):this.tags.indexOf("foward-mail")>-1&&this.currentMailData?(this.LoadAttachments(this.currentMailData.attachments),this.sendEmailForm.get("subject").setValue("FW : "+this.currentMailData.subject),this.composeMailMessage=this.AddMailBody("Forwarded message"),this.sendEmailForm.get("message").setValue(this.composeMailMessage)):this.tags.indexOf("reply-all")>-1&&this.currentMailData&&(this.LoadAttachments(this.currentMailData.attachments),this.sendEmailForm.get("subject").setValue("RE : "+this.currentMailData.subject),this.LoadRecipientReplyAll(this.currentMailData.sender_property,"to"),this.LoadRecipientReplyAll(this.currentMailData.recipient_properties,"cc"),this.composeMailMessage=this.AddMailBody("Message")),this.sendEmailForm.get("message").setValue(s+this.composeMailMessage)}getSignatureForShare(){let s="<br/><br/>";this.composeMailMessage+=" "+this.currentUser.first_name+" "+this.currentUser.last_name,s+=",</br>"+this.currentUser.position,s+="<br/><br/>",s+="------------Forward Message------------",s+="<br/><b> "+this.translate.instant("dashboardMessage.FROM")+"</b> : ",s+="<br/><b> "+this.translate.instant("dashboardMessage.TO")+"</b> : ",s+=this.getRecipientFullNameShare(this.currentUser),this.subject=this.categoryName,s+="<br/><b> "+this.translate.instant("MailBox.composeMail.subject")+" </b> : "+this.subject,s+="<br/><br/>",this.composeMailMessage=s,this.subjectName=this.translate.instant("1001 Ideas"),this.mailForm.controls.subject.setValue(this.subjectName+" : "+this.subject)}AddMailBody(s){let i="";return i+="<p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p>",i+="------------"+s+"------------",i+="<br/><b> "+this.translate.instant("MailBox.from")+"</b> : ",i+=this.getSenderFullName(this.currentMailData.sender_property),i+="<br/><b> "+this.translate.instant("MailBox.to")+"</b> : ",i+=this.getRecipientFullName(this.currentMailData.recipient_properties),i+="<br/><b> Date </b> : "+this.getTranslatedDate(this.currentMailData.created_at),i+="<br/><b> "+this.translate.instant("MailBox.composeMail.subject")+" </b> : "+this.currentMailData.subject,i+="<br/><br/>",i+=this.stringToHTML(this.currentMailData.message),i}getSenderFullName(s){const i=s;return i&&i.sender?(i.sender.hasOwnProperty("sender"),("neutral"!==i.sender.civility?this.translate.instant(i.sender.civility)+" ":"")+i.sender.first_name+" "+i.sender.last_name):""}getSenderFullNameShare(s){const i=s;return i?(i.hasOwnProperty("sender"),i.sender):""}getRecipientFullName(s){const i=s;if(i){if(i[0].recipients[0]){if(i[0].hasOwnProperty("recipients")){const n=i[0].recipients[0];return("neutral"!==n.civility?this.translate.instant(n.civility)+" ":"")+n.first_name+" "+n.last_name}return(i[0].recipients[0].civility&&"neutral"!==i[0].recipients[0].civility?this.translate.instant(i[0].recipients[0].civility)+" ":"")+i[0].recipients[0].first_name+" "+i[0].recipients[0].last_name}return""}return""}getRecipientFullNameShare(s){const i=s;return i&&i?i.hasOwnProperty("recipients")?i.recipients:i:""}getTranslatedDate(s){if(console.log("full sblm error",this.currentMailData),console.log("date sebelum error",s),"object"==typeof s){const i=new Date(s.year,s.month,s.date,s.hour,s.minute);return this.datePipe=new E.uU(this.translate.currentLang),this.datePipe.transform(i,"EEE d MMM, y")}{let i=s;if("number"==typeof i&&(i=i.toString()),8===i.length){const n=parseInt(i.substring(0,4)),t=parseInt(i.substring(4,6)),o=parseInt(i.substring(6,8));i=new Date(n,t,o)}return this.datePipe=new E.uU(this.translate.currentLang),this.datePipe.transform(i,"EEE d MMM, y")}}validateTo(s){console.log("_test",this.sendEmailForm.controls)}userTypeChecking(){console.log("Current User is : ",this.currentUser),this.isUserAcadir=!!this.permissions.getPermission("Academic Director"),this.isUserAcadAdmin=!!this.permissions.getPermission("Academic Admin"),this.isUserCorrector=!!this.permissions.getPermission("Corrector"),this.isUserAnimator=!!this.permissions.getPermission("Animator Business game"),this.isUserCrossCor=!!this.permissions.getPermission("Cross Corrector"),this.isUserDirector=!!this.permissions.getPermission("PC School Director"),this.isUserTeacher=!!this.permissions.getPermission("Teacher"),this.isUserPJM=!!this.permissions.getPermission("Professional Jury Member"),this.isUserAJM=!!this.permissions.getPermission("Academic Final Jury Member"),this.isUserCertifierCorrector=!!this.permissions.getPermission("Corrector Certifier"),this.isuserPresidentJury=!!this.permissions.getPermission("President of Jury"),this.isUserCorrectorProblematic=!!this.permissions.getPermission("Corrector of Problematic"),this.isUserCorrectorQuality=!!this.permissions.getPermission("Corrector Quality"),this.isUserChiefGroupAcademic=!!this.permissions.getPermission("Chief Group Academic"),this.isUserCertifierAdmin=!!this.permissions.getPermission("Certifier Admin"),this.isUserCertifierDir=!!this.permissions.getPermission("CR School Director"),this.isUserStudent=!!this.permissions.getPermission("Student"),this.isUserCrossCor||this.isUserCorrector||this.isUserAnimator||this.isUserTeacher||this.isUserPJM||this.isUserAJM||this.isUserCertifierCorrector||this.isuserPresidentJury||this.isUserCorrectorProblematic||this.isUserCorrectorQuality||this.isUserChiefGroupAcademic||this.isUserCertifierDir||this.isUserCertifierAdmin||this.isUserStudent?this.getRecipientByUserType():this.getRecipientsData()}getRecipientForAcadDirAndAcadAdmin(){if(this.permissions.getPermission("Academic Admin")){const s=this.currentUser.entities.filter(l=>"Academic Admin"===l.type.name),i=d.uniqBy(s,"school.short_name"),n=this.currentUser.entities?this.currentUser.entities[0].type.name:"";this.academicUser=this.userData.entities.filter(l=>l.type.name===n);const t=this.utilService.getAcademicAllAssignedTitle(this.academicUser),o=this.utilService.getUserAllAssignedSchool();i.forEach(l=>{this.subs.sink=this.mailboxService.geUserStudentListBySchoolAndTitleAndUsertype(o,t,this.pcRoleIds,"include_student").subscribe(r=>{if(r&&r.length){const m=d.filter(r,a=>a._id!==this.currentUser._id);console.log(m),console.log(this.currentUser),this.usersList=d.concat(this.usersList,m)}},r=>{this.userService.postErrorLog(r),p().fire({type:"info",title:this.translate.instant("SORRY"),text:r&&r.message?this.translate.instant(r.message.replaceAll("GraphQL error: ","")):r,confirmButtonText:this.translate.instant("DISCONNECT_SCHOOL.BUTTON3")})})}),console.log("this.usersList : ",this.usersList,s,i),this.getAllRecipientWithoutFilter(),this.getRecipientsFromSchool()}else if(this.permissions.getPermission("Academic Director")){const s=this.currentUser.entities.filter(l=>"Academic Director"===l.type.name),i=d.uniqBy(s,"school.short_name"),n=this.currentUser.entities?this.currentUser.entities[0].type.name:"";this.academicUser=this.userData.entities.filter(l=>l.type.name===n);const t=this.utilService.getAcademicAllAssignedTitle(this.academicUser),o=this.utilService.getUserAllAssignedSchool();i.forEach(l=>{this.subs.sink=this.mailboxService.geUserStudentListBySchoolAndTitleAndUsertype(o,t,this.pcRoleIds,"include_student").subscribe(r=>{if(r&&r.length){const m=d.filter(r,a=>a._id!==this.currentUser._id);this.usersList=d.concat(this.usersList,m)}},r=>{this.userService.postErrorLog(r),p().fire({type:"info",title:this.translate.instant("SORRY"),text:r&&r.message?this.translate.instant(r.message.replaceAll("GraphQL error: ","")):r,confirmButtonText:this.translate.instant("DISCONNECT_SCHOOL.BUTTON3")})})}),console.log("this.usersList : ",this.usersList,s,i),this.getAllRecipientWithoutFilter(),this.getRecipientsFromSchool()}else if(this.isUserDirector){console.log("isuser director ");const s=this.currentUser.entities.filter(l=>"PC School Director"===l.type.name),i=d.uniqBy(s,"school.short_name"),n=this.currentUser.entities?this.currentUser.entities[0].type.name:"";this.academicUser=this.userData.entities.filter(l=>l.type.name===n);const t=this.utilService.getAcademicAllAssignedTitle(this.academicUser),o=this.utilService.getUserAllAssignedSchool();i.forEach(l=>{this.subs.sink=this.mailboxService.geUserStudentListBySchoolAndTitleAndUsertype(o,t,this.pcRoleIds,"include_student").subscribe(r=>{if(r&&r.length){const m=d.filter(r,a=>a._id!==this.currentUser._id);this.usersList=d.concat(this.usersList,m)}},r=>{this.userService.postErrorLog(r),p().fire({type:"info",title:this.translate.instant("SORRY"),text:r&&r.message?this.translate.instant(r.message.replaceAll("GraphQL error: ","")):r,confirmButtonText:this.translate.instant("DISCONNECT_SCHOOL.BUTTON3")})})}),console.log("this.usersList : ",this.usersList,s,i),this.getAllRecipientWithoutFilter(),this.getRecipientsFromSchool()}}getRecipientByUserType(){if(this.usersList=[],this.isUserCorrector){const s=this.currentUser.entities.filter(l=>"Corrector"===l.type.name),i=d.uniqBy(s,"school.short_name"),n=this.currentUser.entities?this.currentUser.entities[0].type.name:"";this.academicUser=this.userData.entities.filter(l=>l.type.name===n);const t=this.utilService.getAcademicAllAssignedTitle(this.academicUser),o=this.utilService.getUserAllAssignedSchool();i.forEach(l=>{this.subs.sink=this.mailboxService.geUserListBySchoolAndTitleAndUsertype(o,t,[this.acadDirId,this.acadAdminId]).subscribe(r=>{this.usersList=d.concat(this.usersList,r)},r=>{this.userService.postErrorLog(r),p().fire({type:"info",title:this.translate.instant("SORRY"),text:r&&r.message?this.translate.instant(r.message.replaceAll("GraphQL error: ","")):r,confirmButtonText:this.translate.instant("DISCONNECT_SCHOOL.BUTTON3")})})}),this.getAllRecipientWithoutFilter(),this.getRecipientsFromSchool()}else if(this.isUserAnimator){const s=this.currentUser.entities.filter(l=>"Animator Business game"===l.type.name),i=d.uniqBy(s,"school.short_name"),n=this.currentUser.entities?this.currentUser.entities[0].type.name:"";this.academicUser=this.userData.entities.filter(l=>l.type.name===n);const t=this.utilService.getAcademicAllAssignedTitle(this.academicUser),o=this.utilService.getUserAllAssignedSchool();i.forEach(l=>{this.subs.sink=this.mailboxService.geUserListBySchoolAndTitleAndUsertype(o,t,[this.acadDirId,this.acadAdminId]).subscribe(r=>{this.usersList=d.concat(this.usersList,r)},r=>{this.userService.postErrorLog(r),p().fire({type:"info",title:this.translate.instant("SORRY"),text:r&&r.message?this.translate.instant(r.message.replaceAll("GraphQL error: ","")):r,confirmButtonText:this.translate.instant("DISCONNECT_SCHOOL.BUTTON3")})})}),this.getAllRecipientWithoutFilter(),this.getRecipientsFromSchool()}else if(this.isUserCrossCor){const s=this.currentUser.entities.filter(l=>"Cross Corrector"===l.type.name),i=d.uniqBy(s,"school.short_name"),n=this.currentUser.entities?this.currentUser.entities[0].type.name:"";this.academicUser=this.userData.entities.filter(l=>l.type.name===n);const t=this.utilService.getAcademicAllAssignedTitle(this.academicUser),o=this.utilService.getUserAllAssignedSchool();i.forEach(l=>{this.subs.sink=this.mailboxService.geUserListBySchoolAndTitleAndUsertype(o,t,[this.acadDirId,this.acadAdminId]).subscribe(r=>{this.usersList=d.concat(this.usersList,r)},r=>{this.userService.postErrorLog(r),p().fire({type:"info",title:this.translate.instant("SORRY"),text:r&&r.message?this.translate.instant(r.message.replaceAll("GraphQL error: ","")):r,confirmButtonText:this.translate.instant("DISCONNECT_SCHOOL.BUTTON3")})})}),console.log("this.usersList : ",this.usersList,s,i),this.getAllRecipientWithoutFilter(),this.getRecipientsFromSchool()}else if(this.isUserTeacher){const s=this.currentUser.entities.filter(l=>"Teacher"===l.type.name),i=d.uniqBy(s,"school.short_name");console.log("this.usersList : ",this.usersList,s,i,this.currentUser);const n=this.currentUser.entities?this.currentUser.entities[0].type.name:"";this.academicUser=this.userData.entities.filter(l=>l.type.name===n);const t=this.utilService.getAcademicAllAssignedTitle(this.academicUser),o=this.utilService.getUserAllAssignedSchool();i.forEach(l=>{this.subs.sink=this.mailboxService.geUserListBySchoolAndTitleAndUsertype(o,t,[this.acadDirId,this.acadAdminId]).subscribe(r=>{this.usersList=d.concat(this.usersList,r)},r=>{this.userService.postErrorLog(r),p().fire({type:"info",title:this.translate.instant("SORRY"),text:r&&r.message?this.translate.instant(r.message.replaceAll("GraphQL error: ","")):r,confirmButtonText:this.translate.instant("DISCONNECT_SCHOOL.BUTTON3")})})}),console.log("this.usersList : ",this.usersList,s,i),this.getAllRecipientWithoutFilter(),this.getRecipientsFromSchool()}else if(this.isUserPJM){const s=this.currentUser.entities.filter(n=>"Professional Jury Member"===n.type.name),i=d.uniqBy(s,"school.short_name");i.forEach(n=>{this.subs.sink=this.mailboxService.geUserListBySchoolAndUsertype([n.school._id],[this.acadDirId,this.acadAdminId]).subscribe(t=>{this.usersList=d.concat(this.usersList,t)},t=>{this.userService.postErrorLog(t),p().fire({type:"info",title:this.translate.instant("SORRY"),text:t&&t.message?this.translate.instant(t.message.replaceAll("GraphQL error: ","")):t,confirmButtonText:this.translate.instant("DISCONNECT_SCHOOL.BUTTON3")})})}),console.log("this.usersList : ",this.usersList,s,i),this.getAllRecipientWithoutFilter(),this.getRecipientsFromSchool()}else if(this.isUserAJM){const s=this.currentUser.entities.filter(n=>"Academic Final Jury Member"===n.type.name),i=d.uniqBy(s,"school.short_name");i.forEach(n=>{this.subs.sink=this.mailboxService.geUserListBySchoolAndUsertype([n.school._id],[this.acadDirId,this.acadAdminId]).subscribe(t=>{this.usersList=d.concat(this.usersList,t)},t=>{this.userService.postErrorLog(t),p().fire({type:"info",title:this.translate.instant("SORRY"),text:t&&t.message?this.translate.instant(t.message.replaceAll("GraphQL error: ","")):t,confirmButtonText:this.translate.instant("DISCONNECT_SCHOOL.BUTTON3")})})}),console.log("this.usersList : ",this.usersList,s,i),this.getAllRecipientWithoutFilter(),this.getRecipientsFromSchool()}else if(this.isUserCertifierCorrector){const s=this.currentUser.entities.filter(l=>"Corrector Certifier"===l.type.name),i=d.uniqBy(s,"school.short_name"),n=this.currentUser.entities?this.currentUser.entities[0].type.name:"";this.academicUser=this.userData.entities.filter(l=>l.type.name===n);const t=this.utilService.getAcademicAllAssignedTitle(this.academicUser),o=this.utilService.getUserAllAssignedSchool();i.forEach(l=>{this.subs.sink=this.mailboxService.geUserListBySchoolAndTitleAndUsertype(o,t,[this.certDirId,this.certAdminId]).subscribe(r=>{this.usersList=d.concat(this.usersList,r)},r=>{this.userService.postErrorLog(r),p().fire({type:"info",title:this.translate.instant("SORRY"),text:r&&r.message?this.translate.instant(r.message.replaceAll("GraphQL error: ","")):r,confirmButtonText:this.translate.instant("DISCONNECT_SCHOOL.BUTTON3")})})}),console.log("this.usersList : ",this.usersList,s,i),this.getAllRecipientWithoutFilter(),this.getRecipientsFromSchool()}else if(this.isuserPresidentJury){const s=this.currentUser.entities.filter(l=>"President of Jury"===l.type.name),i=d.uniqBy(s,"school.short_name"),n=this.currentUser.entities?this.currentUser.entities[0].type.name:"";this.academicUser=this.userData.entities.filter(l=>l.type.name===n);const t=this.utilService.getAcademicAllAssignedTitle(this.academicUser),o=this.utilService.getUserAllAssignedSchool();i.forEach(l=>{this.subs.sink=this.mailboxService.geUserListBySchoolAndTitleAndUsertype(o,t,[this.certDirId,this.certAdminId]).subscribe(r=>{this.usersList=d.concat(this.usersList,r)},r=>{this.userService.postErrorLog(r),p().fire({type:"info",title:this.translate.instant("SORRY"),text:r&&r.message?this.translate.instant(r.message.replaceAll("GraphQL error: ","")):r,confirmButtonText:this.translate.instant("DISCONNECT_SCHOOL.BUTTON3")})})}),console.log("this.usersList : ",this.usersList,s,i),this.getAllRecipientWithoutFilter(),this.getRecipientsFromSchool()}else if(this.isUserCorrectorProblematic){const s=this.currentUser.entities.filter(l=>"Corrector of Problematic"===l.type.name),i=d.uniqBy(s,"school.short_name"),n=this.currentUser.entities?this.currentUser.entities[0].type.name:"";this.academicUser=this.userData.entities.filter(l=>l.type.name===n);const t=this.utilService.getAcademicAllAssignedTitle(this.academicUser),o=this.utilService.getUserAllAssignedSchool();i.forEach(l=>{this.subs.sink=this.mailboxService.geUserListBySchoolAndTitleAndUsertype(o,t,[this.certDirId,this.certAdminId]).subscribe(r=>{this.usersList=d.concat(this.usersList,r)},r=>{this.userService.postErrorLog(r),p().fire({type:"info",title:this.translate.instant("SORRY"),text:r&&r.message?this.translate.instant(r.message.replaceAll("GraphQL error: ","")):r,confirmButtonText:this.translate.instant("DISCONNECT_SCHOOL.BUTTON3")})})}),console.log("this.usersList : ",this.usersList,s,i),this.getAllRecipientWithoutFilter(),this.getRecipientsFromSchool()}else if(this.isUserCorrectorQuality){const s=this.currentUser.entities.filter(l=>"Corrector Quality"===l.type.name),i=d.uniqBy(s,"school.short_name"),n=this.currentUser.entities?this.currentUser.entities[0].type.name:"";this.academicUser=this.userData.entities.filter(l=>l.type.name===n);const t=this.utilService.getAcademicAllAssignedTitle(this.academicUser),o=this.utilService.getUserAllAssignedSchool();i.forEach(l=>{this.subs.sink=this.mailboxService.geUserListBySchoolAndTitleAndUsertype(o,t,[this.certDirId,this.certAdminId]).subscribe(r=>{this.usersList=d.concat(this.usersList,r)},r=>{this.userService.postErrorLog(r),p().fire({type:"info",title:this.translate.instant("SORRY"),text:r&&r.message?this.translate.instant(r.message.replaceAll("GraphQL error: ","")):r,confirmButtonText:this.translate.instant("DISCONNECT_SCHOOL.BUTTON3")})})}),console.log("this.usersList : ",this.usersList,s,i),this.getAllRecipientWithoutFilter(),this.getRecipientsFromSchool()}else if(this.isUserChiefGroupAcademic){const s=this.currentUser.entities.filter(l=>"Chief Group Academic"===l.type.name),i=d.uniqBy(s,"school.short_name"),n=this.currentUser.entities?this.currentUser.entities[0].type.name:"";this.academicUser=this.userData.entities.filter(l=>l.type.name===n);const t=this.utilService.getAcademicAllAssignedTitle(this.academicUser),o=this.utilService.getAllSchoolFromChiefGroupUser();i.forEach(l=>{this.subs.sink=this.mailboxService.geUserListBySchoolAndTitle(o,t).subscribe(r=>{this.usersList=d.concat(this.usersList,r)},r=>{this.userService.postErrorLog(r),p().fire({type:"info",title:this.translate.instant("SORRY"),text:r&&r.message?this.translate.instant(r.message.replaceAll("GraphQL error: ","")):r,confirmButtonText:this.translate.instant("DISCONNECT_SCHOOL.BUTTON3")})})}),console.log("this.usersList : ",this.usersList,s,i),this.getAllRecipientWithoutFilter(),this.getRecipientsFromSchool()}else if(this.isUserCertifierDir){const s=this.currentUser.entities.filter(n=>"CR School Director"===n.type.name),i=d.uniqBy(s,"school.short_name");i.forEach(n=>{this.subs.sink=this.mailboxService.getUserBySchoolId(n.school._id).subscribe(t=>{this.usersList=d.filter(t,function(o){return d.find(o.entities,function(l){return l&&l.type&&l.type.name?"Academic Director"!==l.type.name:""})}),console.log("this.usersList : ",this.usersList,s,i),this.getAllRecipientWithoutFilter(),this.getRecipientsFromSchool()},t=>{this.userService.postErrorLog(t),p().fire({type:"info",title:this.translate.instant("SORRY"),text:t&&t.message?this.translate.instant(t.message.replaceAll("GraphQL error: ","")):t,confirmButtonText:this.translate.instant("DISCONNECT_SCHOOL.BUTTON3")})})})}else if(this.isUserCertifierAdmin){const s=this.currentUser.entities.filter(n=>"Certifier Admin"===n.type.name),i=d.uniqBy(s,"school.short_name");i.forEach(n=>{this.subs.sink=this.mailboxService.getUserBySchoolId(n.school._id).subscribe(t=>{this.usersList=d.filter(t,function(o){return d.find(o.entities,function(l){return l&&l.type&&l.type.name?"Academic Director"!==l.type.name:l&&l.type&&l.type.name?"Academic Admin"!==l.type.name:l&&l.type&&l.type.name?"Certifier Admin"!==l.type.name:l&&l.type&&l.type.name?"Academic Final Jury Member"!==l.type.name:l&&l.type&&l.type.name?"operator_admin"!==l.type.name:l&&l.type&&l.type.name?"operator_dir"!==l.type.name:""})}),console.log("this.usersList : ",this.usersList,s,i),this.getAllRecipientWithoutFilter(),this.getRecipientsFromSchool()},t=>{this.userService.postErrorLog(t),p().fire({type:"info",title:this.translate.instant("SORRY"),text:t&&t.message?this.translate.instant(t.message.replaceAll("GraphQL error: ","")):t,confirmButtonText:this.translate.instant("DISCONNECT_SCHOOL.BUTTON3")})})})}else if(this.isUserDirector){const s=this.currentUser.entities.filter(n=>"PC School Director"===n.type.name),i=d.uniqBy(s,"school.short_name");i.forEach(n=>{this.subs.sink=this.mailboxService.getUserBySchoolId(n.school._id).subscribe(t=>{this.usersList=d.filter(t,function(o){return d.filter(o.entities,function(l){return l&&l.type&&l.type.name?"Academic Director"!==l.type.name:""})}),console.log("this.usersList : ",this.usersList,s,i),this.getAllRecipientWithoutFilter(),this.getRecipientsFromSchool()},t=>{this.userService.postErrorLog(t),p().fire({type:"info",title:this.translate.instant("SORRY"),text:t&&t.message?this.translate.instant(t.message.replaceAll("GraphQL error: ","")):t,confirmButtonText:this.translate.instant("DISCONNECT_SCHOOL.BUTTON3")})})})}else if(this.isUserStudent){const s=this.currentUser.entities.filter(l=>"Student"===l.type.name),i=d.uniqBy(s,"school.short_name"),n=this.currentUser.entities?this.currentUser.entities[0].type.name:"";this.academicUser=this.userData.entities.filter(l=>l.type.name===n);const t=this.utilService.getAcademicAllAssignedTitle(this.academicUser),o=this.utilService.getUserAllAssignedSchool();i.forEach(l=>{this.subs.sink=this.mailboxService.geUserListBySchoolAndTitleAndUsertype(o,t,[this.acadDirId]).subscribe(r=>{this.usersList=d.concat(this.usersList,r)},r=>{this.userService.postErrorLog(r),p().fire({type:"info",title:this.translate.instant("SORRY"),text:r&&r.message?this.translate.instant(r.message.replaceAll("GraphQL error: ","")):r,confirmButtonText:this.translate.instant("DISCONNECT_SCHOOL.BUTTON3")})})}),this.getAllRecipientWithoutFilter(),this.getRecipientsFromSchool()}}getRecipientBySchool(){this.usersList=[],this.subs.sink=this.mailboxService.getUserBySchool().subscribe(s=>{console.log("This User By School :",s),s&&s.length&&(s.forEach(i=>{this.usersList.push(i.users),this.subs.sink=this.mailboxService.getStudent(i._id).subscribe(n=>{n&&n.length&&(this.usersList=[],this.usersList=d.concat(i.users,n))},n=>{this.userService.postErrorLog(n),p().fire({type:"info",title:this.translate.instant("SORRY"),text:n&&n.message?this.translate.instant(n.message.replaceAll("GraphQL error: ","")):n,confirmButtonText:this.translate.instant("DISCONNECT_SCHOOL.BUTTON3")})})}),this.usersList=this.usersList.filter(i=>null!=i),console.log("this.usersList : ",this.usersList),this.getAllRecipientWithoutFilter(),this.getRecipientsFromSchool())})}getRecipientByCross(){this.usersList=[],this.subs.sink=this.mailboxService.getUserBySchool().subscribe(s=>{if(console.log("This User By School :",s),s&&s.length){let i,n;s.forEach(t=>{i=d.cloneDeep(t.users),i=i.filter(o=>null!=o)}),i.forEach(t=>{n=t.entities.filter(o=>"Academic Director"===o.type.name),this.usersList.push(n)}),console.log("this.usersList : ",this.usersList,i),this.getAllRecipientWithoutFilter(),this.getRecipientsFromSchool()}},s=>{this.userService.postErrorLog(s),p().fire({type:"info",title:this.translate.instant("SORRY"),text:s&&s.message?this.translate.instant(s.message.replaceAll("GraphQL error: ","")):s,confirmButtonText:this.translate.instant("DISCONNECT_SCHOOL.BUTTON3")})})}getRecipientsFromSchool(){this.subs.sink=this.sendEmailForm.get("to").valueChanges.pipe((0,y.b)(400)).subscribe(s=>{this.emailAddressesListTo=[],this.usersList=d.uniqBy(this.usersList,"email"),d.filter(this.usersList,function(t){const o=t?t.first_name+" "+t.last_name:"";return o?o.toLowerCase().includes(s?s.toLowerCase():""):""}).filter(t=>!this.selectedRecepientsList.includes(("neutral"!==t.civility?this.translate.instant(t.civility)+" ":"")+t.first_name+" "+t.last_name+" <"+t.email+">")).concat(this.selectedRecepientsList.filter(t=>!this.selectedRecepientsList.includes(("neutral"!==t.civility?t.civility+" ":"")+t.first_name+" "+t.last_name+" <"+t.email+">"))).forEach(t=>{void 0!==t.email&&this.emailAddressesListTo.push(("neutral"!==t.civility?this.translate.instant(t.civility)+" ":"")+t.first_name+" "+t.last_name+" <"+t.email+">")})}),this.subs.sink=this.sendEmailForm.get("cc").valueChanges.pipe((0,y.b)(400)).subscribe(s=>{this.emailAddressesListCc=[],this.usersList=d.uniqBy(this.usersList,"email"),d.filter(this.usersList,function(t){const o=t?t.first_name+" "+t.last_name:"";return o?o.toLowerCase().includes(s?s.toLowerCase():""):""}).filter(t=>!this.selectedRecepientsList.includes(("neutral"!==t.civility?this.translate.instant(t.civility)+" ":"")+t.first_name+" "+t.last_name+" <"+t.email+">")).concat(this.selectedRecepientsList.filter(t=>!this.selectedRecepientsList.includes(("neutral"!==t.civility?t.civility+" ":"")+t.first_name+" "+t.last_name+" <"+t.email+">"))).forEach(t=>{void 0!==t.email&&this.emailAddressesListCc.push(("neutral"!==t.civility?this.translate.instant(t.civility)+" ":"")+t.first_name+" "+t.last_name+" <"+t.email+">")})}),this.subs.sink=this.sendEmailForm.get("bcc").valueChanges.pipe((0,y.b)(400)).subscribe(s=>{this.emailAddressesListBcc=[],this.usersList=d.uniqBy(this.usersList,"email"),d.filter(this.usersList,function(t){const o=t?t.first_name+" "+t.last_name:"";return o?o.toLowerCase().includes(s?s.toLowerCase():""):""}).filter(t=>!this.selectedRecepientsList.includes(("neutral"!==t.civility?this.translate.instant(t.civility)+" ":"")+t.first_name+" "+t.last_name+" <"+t.email+">")).concat(this.selectedRecepientsList.filter(t=>!this.selectedRecepientsList.includes(("neutral"!==t.civility?t.civility+" ":"")+t.first_name+" "+t.last_name+" <"+t.email+">"))).forEach(t=>{void 0!==t.email&&this.emailAddressesListBcc.push(("neutral"!==t.civility?this.translate.instant(t.civility)+" ":"")+t.first_name+" "+t.last_name+" <"+t.email+">")})})}getAllRecipientWithoutFilter(){console.log("First Populate"),this.populated=!1,this.emailAddressesListTo=[],this.usersList=d.uniqBy(this.usersList,"email");const s=this.usersList.filter(t=>!this.selectedRecepientsList.includes(("neutral"!==t.civility?this.translate.instant(t.civility)+" ":"")+t.first_name+" "+t.last_name+" <"+t.email+">")).concat(this.selectedRecepientsList.filter(t=>!this.selectedRecepientsList.includes(("neutral"!==t.civility?t.civility+" ":"")+t.first_name+" "+t.last_name+" <"+t.email+">")));s.forEach(t=>{void 0!==t.email&&this.emailAddressesListTo.push(("neutral"!==t.civility?this.translate.instant(t.civility)+" ":"")+t.first_name+" "+t.last_name+" <"+t.email+">")}),this.emailAddressesListCc=[],this.usersList=d.uniqBy(this.usersList,"email"),this.usersList.filter(t=>!this.selectedRecepientsList.includes(("neutral"!==t.civility?this.translate.instant(t.civility)+" ":"")+t.first_name+" "+t.last_name+" <"+t.email+">")).concat(this.selectedRecepientsList.filter(t=>!this.selectedRecepientsList.includes(("neutral"!==t.civility?t.civility+" ":"")+t.first_name+" "+t.last_name+" <"+t.email+">"))),s.forEach(t=>{void 0!==t.email&&this.emailAddressesListCc.push(("neutral"!==t.civility?this.translate.instant(t.civility)+" ":"")+t.first_name+" "+t.last_name+" <"+t.email+">")}),this.emailAddressesListBcc=[],this.usersList=d.uniqBy(this.usersList,"email"),this.usersList.filter(t=>!this.selectedRecepientsList.includes(("neutral"!==t.civility?this.translate.instant(t.civility)+" ":"")+t.first_name+" "+t.last_name+" <"+t.email+">")).concat(this.selectedRecepientsList.filter(t=>!this.selectedRecepientsList.includes(("neutral"!==t.civility?t.civility+" ":"")+t.first_name+" "+t.last_name+" <"+t.email+">"))),s.forEach(t=>{void 0!==t.email&&this.emailAddressesListBcc.push(("neutral"!==t.civility?this.translate.instant(t.civility)+" ":"")+t.first_name+" "+t.last_name+" <"+t.email+">")})}ngOnDestroy(){this.subs.unsubscribe()}stringToHTML(s){const i=new DOMParser,n=s.split("<style>");let t="";n&&n.length?n.forEach((l,r)=>{r!==n.length-1&&(t+=l)}):t=s;const o=i.parseFromString(t,"text/html");return o.body.outerHTML.includes("https://ckeditor.com/docs/")?o.body.getElementsByClassName("ck-content")[0].innerHTML:o.body.outerHTML}openAttachment(s){if(s.is_from_builder){const i=document.createElement("a");i.target="_blank",i.href=s.path,i.download=s.file_name,i.click(),i.remove()}else if(s.document_id&&"Invoice"===s.document_id){const i=`${I.a.baseApi}/fileuploads/${s.name}`.replace("/graphql",""),n=document.createElement("a");n.target="_blank",n.href=i,n.download=s.file_name,n.click(),n.remove()}}addDoc(){this.addDocumentBuilderDialogComponent=this.dialog.open(B.V,{width:"600px",minHeight:"100px",disableClose:!0,data:{_id:this.recepientData&&this.recepientData.student_id?this.recepientData.student_id._id:null,student:this.recepientData&&this.recepientData.student_id?this.recepientData.student_id:null}}),this.subs.sink=this.addDocumentBuilderDialogComponent.afterClosed().subscribe(s=>{s&&("Invoice"===s.document_builder_name?(this.attachmnetsPaths.push({path:null,name:s.document_id,is_from_builder:!1,document_id:"Invoice"}),this.isForInvoice=!0):this.attachmnetsPaths.push({path:s.path,name:s.file_name,is_from_builder:!0}))})}}return h.\u0275fac=function(s){return new(s||h)(e.\u0275\u0275directiveInject(D.sK),e.\u0275\u0275directiveInject(R.e),e.\u0275\u0275directiveInject(k.e),e.\u0275\u0275directiveInject(S.so),e.\u0275\u0275directiveInject(F.J),e.\u0275\u0275directiveInject(f.UntypedFormBuilder),e.\u0275\u0275directiveInject(w.t),e.\u0275\u0275directiveInject(N.YI),e.\u0275\u0275directiveInject(S.uw),e.\u0275\u0275directiveInject(S.WI))},h.\u0275cmp=e.\u0275\u0275defineComponent({type:h,selectors:[["ms-send-mail-dialog"]],viewQuery:function(s,i){if(1&s&&(e.\u0275\u0275viewQuery(Y,5),e.\u0275\u0275viewQuery(J,5),e.\u0275\u0275viewQuery($,5),e.\u0275\u0275viewQuery(q,5),e.\u0275\u0275viewQuery(z,5),e.\u0275\u0275viewQuery(X,5)),2&s){let n;e.\u0275\u0275queryRefresh(n=e.\u0275\u0275loadQuery())&&(i.currentFile=n.first),e.\u0275\u0275queryRefresh(n=e.\u0275\u0275loadQuery())&&(i.languagesInput=n.first),e.\u0275\u0275queryRefresh(n=e.\u0275\u0275loadQuery())&&(i.recipientCc=n.first),e.\u0275\u0275queryRefresh(n=e.\u0275\u0275loadQuery())&&(i.recipientBcc=n.first),e.\u0275\u0275queryRefresh(n=e.\u0275\u0275loadQuery())&&(i.matAutocomplete=n.first),e.\u0275\u0275queryRefresh(n=e.\u0275\u0275loadQuery())&&(i.chipList=n.first)}},inputs:{allowOther:"allowOther",returnType:"returnType"},outputs:{optionSelected:"optionSelected"},decls:51,vars:39,consts:[["cdkDrag","","cdkDragRootElement",".cdk-overlay-pane","cdkDragHandle","",3,"formGroup"],[2,"color","black"],["mat-dialog-title",""],["svgIcon","pencil",1,"icon-style",2,"cursor","default"],[1,"title-email"],[2,"float","right"],["mat-button","","mat-raised-button","","color","accent",3,"click",4,"ngIf"],[1,"icon-style",3,"matTooltip","click"],["matTooltip","CC"],[1,"icon-style",3,"click"],[3,"matTooltip"],[1,"icon-style",3,"matTooltip"],["type","file","name","file","multiple","","accept",".jpeg,.png,.rar,.zip,.doc,.docx,.ppt,.pdf,.xls",2,"display","none",3,"change"],["myInput",""],["class","vertical-align-mid cursorStyle",3,"matTooltip","click",4,"ngIf"],["style","color: rgb(170, 168, 168)","class","vertical-align-mid",4,"ngIf"],[1,"chip-list"],[3,"ngClass"],["chipList",""],[3,"selectable","removable","removed",4,"ngFor","ngForOf"],["type","email","matInput","","formControlName","to",3,"matAutocomplete","matChipInputFor","matChipInputSeparatorKeyCodes","matChipInputAddOnBlur","matChipInputTokenEnd","change"],["languagesInput",""],[4,"ngIf"],[3,"optionSelected"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["class","chip-list",4,"ngIf"],["matInput","","formControlName","subject",3,"placeholder"],[1,"file-section","p-col-12"],["class","fileInfo",4,"ngFor","ngForOf"],["formControlName","message",3,"editor","config","ready"],["mat-button","","mat-raised-button","","color","accent",3,"click"],[1,"vertical-align-mid","cursorStyle",3,"matTooltip","click"],[1,"vertical-align-mid",2,"color","rgb(170, 168, 168)"],[3,"selectable","removable","removed"],["matChipRemove","",4,"ngIf"],["matChipRemove",""],[3,"value"],["chipListCc",""],["matInput","","formControlName","cc",3,"placeholder","matAutocomplete","matChipInputFor","matChipInputSeparatorKeyCodes","matChipInputAddOnBlur","matChipInputTokenEnd"],["recipientCc",""],[3,"value","click",4,"ngFor","ngForOf"],[3,"value","click"],["chipListBcc",""],["matInput","","formControlName","bcc",3,"placeholder","matAutocomplete","matChipInputFor","matChipInputSeparatorKeyCodes","matChipInputAddOnBlur","matChipInputTokenEnd"],["recipientBcc",""],[1,"fileInfo"],["mat-icon-button","","type","button"],[3,"ngClass","click"],["mat-icon-button","","type","button",3,"click"]],template:function(s,i){if(1&s&&(e.\u0275\u0275elementStart(0,"form",0)(1,"div",1)(2,"h1",2),e.\u0275\u0275element(3,"mat-icon",3),e.\u0275\u0275elementStart(4,"span",4),e.\u0275\u0275text(5),e.\u0275\u0275pipe(6,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(7,"div",5),e.\u0275\u0275template(8,Z,3,3,"button",6),e.\u0275\u0275elementStart(9,"mat-icon",7),e.\u0275\u0275listener("click",function(){return i.closeDialog()}),e.\u0275\u0275pipe(10,"translate"),e.\u0275\u0275text(11,"close"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(12,"label",8)(13,"a",9),e.\u0275\u0275listener("click",function(){return i.showCC=!i.showCC}),e.\u0275\u0275text(14,"CC"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(15,"label",10),e.\u0275\u0275pipe(16,"translate"),e.\u0275\u0275elementStart(17,"a",9),e.\u0275\u0275listener("click",function(){return i.showBCC=!i.showBCC}),e.\u0275\u0275text(18),e.\u0275\u0275pipe(19,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(20,"label")(21,"mat-icon",11),e.\u0275\u0275pipe(22,"translate"),e.\u0275\u0275text(23,"attachment"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(24,"input",12,13),e.\u0275\u0275listener("change",function(t){return i.handleInputChange(t)}),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(26,tt,3,3,"mat-icon",14),e.\u0275\u0275template(27,et,2,0,"mat-icon",15),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(28,"mat-dialog-content")(29,"mat-form-field",16)(30,"mat-label",17),e.\u0275\u0275text(31),e.\u0275\u0275pipe(32,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(33,"mat-chip-list",null,18),e.\u0275\u0275template(35,st,3,4,"mat-chip",19),e.\u0275\u0275elementStart(36,"input",20,21),e.\u0275\u0275listener("matChipInputTokenEnd",function(t){return i.addTo(t)})("change",function(t){return i.validateTo(t)}),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(38,nt,3,3,"mat-error",22),e.\u0275\u0275elementStart(39,"mat-autocomplete",23,24),e.\u0275\u0275listener("optionSelected",function(t){return i.setSelectedEmailTo(t)}),e.\u0275\u0275template(41,at,2,2,"mat-option",25),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(42,ht,11,10,"mat-form-field",26),e.\u0275\u0275template(43,gt,11,10,"mat-form-field",26),e.\u0275\u0275elementStart(44,"mat-form-field"),e.\u0275\u0275element(45,"input",27),e.\u0275\u0275pipe(46,"translate"),e.\u0275\u0275template(47,ft,3,3,"mat-error",22),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(48,"div",28),e.\u0275\u0275template(49,bt,9,5,"div",29),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(50,"ckeditor",30),e.\u0275\u0275listener("ready",function(t){return i.onReady(t)}),e.\u0275\u0275elementEnd()()()()),2&s){const n=e.\u0275\u0275reference(34),t=e.\u0275\u0275reference(40);e.\u0275\u0275property("formGroup",i.sendEmailForm),e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(6,25,"MailBox.composeMail.title"),""),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",null==i.recepientData?null:i.recepientData.triggeredFromStudent),e.\u0275\u0275advance(1),e.\u0275\u0275propertyInterpolate("matTooltip",e.\u0275\u0275pipeBind1(10,27,"CLOSE")),e.\u0275\u0275advance(6),e.\u0275\u0275propertyInterpolate("matTooltip",e.\u0275\u0275pipeBind1(16,29,"MailBox.composeMail.bcc")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(19,31,"MailBox.composeMail.bcc")),e.\u0275\u0275advance(3),e.\u0275\u0275propertyInterpolate("matTooltip",e.\u0275\u0275pipeBind1(22,33,"MailBox.ATTACH_FILE")),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",i.sendEmailForm.get("subject").value&&(i.selectedEmailTo.length||i.showBCC&&i.selectedEmailBcc.length||i.showCC&&i.selectedEmailCc.length)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(i.sendEmailForm.get("subject").value&&(i.selectedEmailTo.length||i.showBCC&&i.selectedEmailBcc.length||i.showCC&&i.selectedEmailCc.length))),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngClass",i.isWarningTo?"style-warning-label":""),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind1(32,35,"MailBox.composeMail.to")," *"),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngForOf",i.selectedEmailTo),e.\u0275\u0275advance(1),e.\u0275\u0275property("matAutocomplete",t)("matChipInputFor",n)("matChipInputSeparatorKeyCodes",i.separatorKeysCodes)("matChipInputAddOnBlur",i.addOnBlur),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",i.sendEmailForm.get("to").hasError("required")&&(i.sendEmailForm.get("to").dirty||i.sendEmailForm.get("to").touched)),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",i.emailAddressesListTo),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",i.showCC||i.showCCInput),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",i.showBCC||i.showBCCInput),e.\u0275\u0275advance(2),e.\u0275\u0275propertyInterpolate("placeholder",e.\u0275\u0275pipeBind1(46,37,"Subject")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",i.sendEmailForm.get("subject").hasError("required")&&(i.sendEmailForm.get("subject").dirty||i.sendEmailForm.get("subject").touched)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",i.attachmnetsPaths),e.\u0275\u0275advance(1),e.\u0275\u0275property("editor",i.Editor)("config",i.config)}},dependencies:[x.Zt,x.Bh,A.XC,A.ZL,V.ey,G.lW,v.qn,v.HS,v.oH,v.qH,S.uh,S.xY,j.Hw,M.TO,M.KE,M.hX,W.Nt,K.gM,f.\u0275NgNoValidate,f.DefaultValueAccessor,f.NgControlStatus,f.NgControlStatusGroup,f.FormGroupDirective,f.FormControlName,Q.oO,E.mk,E.sg,E.O5,H.u,D.X$],styles:[".top-space[_ngcontent-%COMP%]{margin-top:30px}table[_ngcontent-%COMP%]   .mat-select-trigger[_ngcontent-%COMP%]{display:inline-table}table[_ngcontent-%COMP%]   .mat-select-value[_ngcontent-%COMP%]{display:table-cell;max-width:0}table[_ngcontent-%COMP%]   .mat-select-arrow-wrapper[_ngcontent-%COMP%]{display:table-cell;vertical-align:middle}[_nghost-%COMP%]     table:not(.no-action-header):not(.notif-table) th{font-weight:400}[_nghost-%COMP%]     table:not(.no-action-header):not(.notif-table) thead>tr:first-child{height:40px}[_nghost-%COMP%]     table:not(.no-action-header):not(.notif-table) thead>tr:nth-child(2){border-top:4px solid #607d8b}[_nghost-%COMP%]     table:not(.no-action-header):not(.notif-table) thead>tr:not(:first-child){border-left:4px solid #607d8b;border-right:4px solid #607d8b}[_nghost-%COMP%]     table:not(.no-action-header):not(.notif-table) thead>tr:nth-last-child(2){border-bottom:4px solid #607d8b}[_nghost-%COMP%]     table:not(.no-action-header):not(.notif-table) thead>tr:last-child{border-bottom:4px solid #607d8b}[_nghost-%COMP%]     table:not(.no-action-header):not(.notif-table) tbody>tr{border-left:4px solid #607d8b;border-right:4px solid #607d8b}[_nghost-%COMP%]     table:not(.no-action-header):not(.notif-table) tbody>tr:last-child{border-bottom:4px solid #607d8b}[_nghost-%COMP%]     table:not(.no-action-header):not(.notif-table) tbody tr:nth-child(odd){background-color:#607d8b}[_nghost-%COMP%]     table:not(.no-action-header):not(.notif-table) tbody tr:nth-child(odd) .mat-icon-button .mat-icon{line-height:1!important}[_nghost-%COMP%]     table:not(.no-action-header):not(.notif-table) tbody tr:nth-child(odd) .mat-icon-button{background:#353535;line-height:0!important}[_nghost-%COMP%]     table:not(.no-action-header):not(.notif-table) tbody tr:nth-child(even){background-color:#353535}[_nghost-%COMP%]     table:not(.no-action-header):not(.notif-table) tbody tr:nth-child(even) .mat-icon-button .mat-icon{line-height:1!important}[_nghost-%COMP%]     table:not(.no-action-header):not(.notif-table) tbody tr:nth-child(even) .mat-icon-button{background:#607d8b;line-height:0!important}[_nghost-%COMP%]     table.no-action-header th{font-weight:400}[_nghost-%COMP%]     table.no-action-header thead>tr:nth-child(1){border-top:4px solid #607d8b;border-left:4px solid #607d8b;border-right:4px solid #607d8b}[_nghost-%COMP%]     table.no-action-header thead>tr:not(:first-child){border-left:4px solid #607d8b;border-right:4px solid #607d8b}[_nghost-%COMP%]     table.no-action-header thead>tr:nth-last-child(2){border-bottom:4px solid #607d8b}[_nghost-%COMP%]     table.no-action-header thead>tr:last-child{border-bottom:4px solid #607d8b}[_nghost-%COMP%]     table.no-action-header tbody>tr{border-left:4px solid #607d8b;border-right:4px solid #607d8b}[_nghost-%COMP%]     table.no-action-header tbody>tr:last-child{border-bottom:4px solid #607d8b}[_nghost-%COMP%]     table.no-action-header tbody tr:nth-child(odd){background-color:#607d8b}[_nghost-%COMP%]     table.no-action-header tbody tr:nth-child(odd) .mat-icon-button .mat-icon{line-height:1!important}[_nghost-%COMP%]     table.no-action-header tbody tr:nth-child(odd) .mat-icon-button{background:#353535;line-height:0!important}[_nghost-%COMP%]     table.no-action-header tbody tr:nth-child(even){background-color:#353535}[_nghost-%COMP%]     table.no-action-header tbody tr:nth-child(even) .mat-icon-button .mat-icon{line-height:1!important}[_nghost-%COMP%]     table.no-action-header tbody tr:nth-child(even) .mat-icon-button{background:#607d8b;line-height:0!important}.horizontal[_ngcontent-%COMP%]{overflow:auto}.child-tab-font[_ngcontent-%COMP%]{font-size:.8rem}.center-spinner[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.hide[_ngcontent-%COMP%], .hidden[_ngcontent-%COMP%]{display:none!important}.header-div[_ngcontent-%COMP%]{border-bottom:1px solid black;display:flex;padding:1rem}.header-text[_ngcontent-%COMP%]{color:#000;margin-left:1rem;margin-bottom:0!important}.header-icon[_ngcontent-%COMP%]{align-self:center;margin-left:auto!important;background-color:transparent!important}.baseline-align[_ngcontent-%COMP%]{align-items:baseline}.admtc-table-button[_ngcontent-%COMP%], button.yellow-button.mat-raised-button[_ngcontent-%COMP%], button.blue-patina-button.mat-raised-button[_ngcontent-%COMP%]{min-width:7em;height:2.8em;font-size:1.2em;font-family:Roboto,Helvetica Neue,sans-serif!important}.admtc-table-button[_ngcontent-%COMP%]   .mat-icon[svgicon][_ngcontent-%COMP%], button.yellow-button.mat-raised-button[_ngcontent-%COMP%]   .mat-icon[svgicon][_ngcontent-%COMP%], button.blue-patina-button.mat-raised-button[_ngcontent-%COMP%]   .mat-icon[svgicon][_ngcontent-%COMP%]{margin-top:.5em;margin-right:.3em}.admtc-normal-button[_ngcontent-%COMP%], button.yellow-button-normal.mat-raised-button[_ngcontent-%COMP%]{min-width:7em;height:2em;font-size:1em;font-family:Roboto,Helvetica Neue,sans-serif!important}.admtc-normal-button[_ngcontent-%COMP%]   .mat-icon[svgicon][_ngcontent-%COMP%], button.yellow-button-normal.mat-raised-button[_ngcontent-%COMP%]   .mat-icon[svgicon][_ngcontent-%COMP%]{margin-top:.3em;margin-right:.2em}.background-accent[_ngcontent-%COMP%], button.yellow-button-normal.mat-raised-button[_ngcontent-%COMP%], button.yellow-button.mat-raised-button[_ngcontent-%COMP%]{background-color:#fdd835!important;color:#000000de}.background-warn[_ngcontent-%COMP%]{background-color:red!important;color:#fff}.background-success[_ngcontent-%COMP%]{background-color:#4caf50!important;color:#fff}.background-primary[_ngcontent-%COMP%]{background-color:#607d8b!important;color:#fff}.background-medium-grey[_ngcontent-%COMP%]{background-color:#424242!important;color:#fff}.background-black[_ngcontent-%COMP%]{background-color:#212121!important;color:#fff}button.blue-patina-button.mat-raised-button[_ngcontent-%COMP%]{background-color:#607d8b!important}[_nghost-%COMP%]     .mat-slide-toggle.mat-checked .mat-slide-toggle-bar .mat-slide-toggle-thumb{background-color:#fdd835}[_nghost-%COMP%]     .mat-slide-toggle.mat-checked .mat-slide-toggle-bar{background-color:#ffc10780}[_nghost-%COMP%]     .mat-form-field-appearance-outline .mat-form-field-infix{padding:.15rem}[_nghost-%COMP%]     mat-form-field.mat-form-field-should-float label{font-size:18px;font-weight:600;color:#000}.status-icon[_ngcontent-%COMP%], .red-icon[_ngcontent-%COMP%], .purple-icon[_ngcontent-%COMP%], .black-icon[_ngcontent-%COMP%], .greenyellow-icon[_ngcontent-%COMP%], .yellow-icon[_ngcontent-%COMP%], .green-icon[_ngcontent-%COMP%]{font-size:25px;width:30px}.is-loading[_ngcontent-%COMP%]   .mat-option-text[_ngcontent-%COMP%]{display:flex;justify-content:center}.display-flex[_ngcontent-%COMP%]{display:flex}.green-icon[_ngcontent-%COMP%]{color:#4caf50}.yellow-icon[_ngcontent-%COMP%]{color:#ff0}.greenyellow-icon[_ngcontent-%COMP%]{color:#adff2f}.black-icon[_ngcontent-%COMP%]{color:#000}.purple-icon[_ngcontent-%COMP%]{color:purple}.red-icon[_ngcontent-%COMP%], .red-text[_ngcontent-%COMP%]{color:red}.text-white[_ngcontent-%COMP%]{color:#fff}.greenyellow-text[_ngcontent-%COMP%]{color:#adff2f!important}.mat-sort-header-container[_ngcontent-%COMP%]{justify-content:center}.tags[_ngcontent-%COMP%]{background-color:#fdd835;color:#000;padding:3px 5px;border-radius:3px;margin-right:5px}.p-grid[_ngcontent-%COMP%]{margin-right:unset!important;margin-left:unset!important;margin-top:unset!important}.add-btn[_ngcontent-%COMP%]{background:#fdd835;width:10rem}.color[_ngcontent-%COMP%]{background:#607d8b;width:10rem}.alignment[_ngcontent-%COMP%]{text-align:right;padding-right:0}mat-form-field[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]     .ck-editor__editable_inline{min-height:50px;border:1px solid #b8b8b8;background:white;color:#000}.fontColor[_ngcontent-%COMP%]{color:#000}.yellow-border[_ngcontent-%COMP%]{border:2px solid #fdd835}.silver-border[_ngcontent-%COMP%]{border:2px solid whitesmoke}.red-border[_ngcontent-%COMP%]{border:2px solid red}.certification-rule-pop-up[_ngcontent-%COMP%]   .mat-dialog-container[_ngcontent-%COMP%]{padding:0}.one-time-pop-up[_ngcontent-%COMP%]   .mat-dialog-container[_ngcontent-%COMP%]{width:800px!important}.dark-mode-pop-up[_ngcontent-%COMP%]   .mat-dialog-container[_ngcontent-%COMP%]{color:#fff;background:#303030}.grey-mode-pop-up[_ngcontent-%COMP%]   .mat-dialog-container[_ngcontent-%COMP%]{color:#fff;background:#7c7c7c}.view-step-validation-pop-up[_ngcontent-%COMP%]   .mat-dialog-container[_ngcontent-%COMP%]{max-height:590px}.image-preview-pop-up[_ngcontent-%COMP%]   .mat-dialog-container[_ngcontent-%COMP%]{background:rgba(0,0,0,.231372549);box-shadow:none;padding:0;overflow:hidden}.pass-fail-pop-up[_ngcontent-%COMP%]   .mat-dialog-container[_ngcontent-%COMP%]{padding:0 24px 18px}.expected-doc-task[_ngcontent-%COMP%]   .mat-dialog-container[_ngcontent-%COMP%]{padding:16px!important;overflow:visible}.no-padding-pop-up[_ngcontent-%COMP%]   .mat-dialog-container[_ngcontent-%COMP%]{padding:0;overflow:visible}.questionnaire-simulation-pop-up[_ngcontent-%COMP%]   .mat-dialog-container[_ngcontent-%COMP%]{overflow:scroll;width:60vw;max-height:90vh;background-color:#607d8b;color:#fff}.reply-message-pop-up[_ngcontent-%COMP%]   .mat-dialog-container[_ngcontent-%COMP%]{padding:0;min-height:430px}.send-pro-evaluation-pop-up[_ngcontent-%COMP%]   .mat-dialog-container[_ngcontent-%COMP%]{padding:0;min-height:430px;visibility:hidden}.banner-connect-snackbar[_ngcontent-%COMP%]{padding:0!important;min-height:0!important;max-height:0!important}.editor-background-white[_ngcontent-%COMP%]{background-color:#fafafa;color:#000}.editor-background-white[_ngcontent-%COMP%]   .ck-editor__editable[_ngcontent-%COMP%]{min-height:140px!important}.small-text-fieldset[_ngcontent-%COMP%]{font-size:12px}.small-icon[_ngcontent-%COMP%]{transform:scale(.6)}.padding-0[_ngcontent-%COMP%]{padding:0!important}.mt-1rem[_ngcontent-%COMP%]{margin-top:1rem}.mr-1rem[_ngcontent-%COMP%]{margin-right:1rem}.mb-1rem[_ngcontent-%COMP%]{margin-bottom:1rem}.ellipsis-one-line[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.span-block[_ngcontent-%COMP%]{width:-moz-fit-content;width:fit-content;display:block;max-width:-webkit-fill-available;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.dialog-title[_ngcontent-%COMP%]{color:#000}.icon-self-right[_ngcontent-%COMP%]{position:absolute;right:0;top:0;cursor:pointer}.dialog-body[_ngcontent-%COMP%]{color:#000}.no-padding[_ngcontent-%COMP%]{padding:0!important}.no-padding-x[_ngcontent-%COMP%]{padding-right:0!important;padding-left:0!important}.no-padding-y[_ngcontent-%COMP%]{padding-top:0!important;padding-bottom:0!important}.no-padding-r[_ngcontent-%COMP%]{padding-right:0!important}.no-padding-l[_ngcontent-%COMP%]{padding-left:0!important}.no-padding-t[_ngcontent-%COMP%]{padding-top:0!important}.no-padding-b[_ngcontent-%COMP%]{padding-bottom:0!important}.no-margin[_ngcontent-%COMP%]{margin:0}.align-center[_ngcontent-%COMP%]{text-align:center}.align-end[_ngcontent-%COMP%]{text-align:end}.one-line-text[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}[_ngcontent-%COMP%]::-webkit-scrollbar{-webkit-appearance:none;width:7px;height:8px}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{border-radius:4px;background-color:#00000080;box-shadow:0 0 1px #ffffff80;-webkit-box-shadow:0 0 1px rgba(255,255,255,.5)}.ckeditor-small[_ngcontent-%COMP%]   .ck-editor__editable[_ngcontent-%COMP%]{min-height:140px!important;max-height:140px!important;border:1px solid rgba(0,0,0,.5)!important}.ckeditor-medium[_ngcontent-%COMP%]   .ck-editor__editable[_ngcontent-%COMP%]{min-height:300px!important;max-height:300px!important;border:1px solid rgba(0,0,0,.5)!important}.ckeditor-big[_ngcontent-%COMP%]   .ck-editor__editable[_ngcontent-%COMP%]{min-height:500px!important;max-height:500px!important}.ckeditor-white-background[_ngcontent-%COMP%]{background-color:#fff!important;color:#000!important}.custom-dialog-container-publishable-doc[_ngcontent-%COMP%]   .mat-dialog-container[_ngcontent-%COMP%]{overflow:unset;padding:15px}.align-input-field[_ngcontent-%COMP%]{margin-bottom:9px}.hide-pagination-buttons[_ngcontent-%COMP%]   .mat-paginator-navigation-first[_ngcontent-%COMP%], .hide-pagination-buttons[_ngcontent-%COMP%]   .mat-paginator-navigation-previous[_ngcontent-%COMP%], .hide-pagination-buttons[_ngcontent-%COMP%]   .mat-paginator-navigation-next[_ngcontent-%COMP%], .hide-pagination-buttons[_ngcontent-%COMP%]   .mat-paginator-navigation-last[_ngcontent-%COMP%]{display:none!important}.clickable[_ngcontent-%COMP%]{cursor:pointer}input[type=number][_ngcontent-%COMP%]::-webkit-inner-spin-button, input[type=number][_ngcontent-%COMP%]::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}.flex-layout-row-wrap[_ngcontent-%COMP%]{display:flex;flex-flow:row wrap;box-sizing:border-box}[_nghost-%COMP%]     ng-select.ng-invalid.ng-touched .ng-select-container{border-color:#dc3545!important;box-shadow:inset 0 1px 1px #00000013,0 0 0 3px #fde6e8!important}.title-email[_ngcontent-%COMP%]{position:relative;top:3px}.icon-style[_ngcontent-%COMP%]{vertical-align:middle;margin-right:1rem;cursor:pointer}[_nghost-%COMP%]     .mat-dialog-content{max-height:520px;height:auto}[_nghost-%COMP%]     .ck-editor__editable_inline{height:auto;color:#000}[_nghost-%COMP%]     .ck-editor__editable_inline   .image-inline{max-width:170px!important;max-height:150px!important}.cursorStyle[_ngcontent-%COMP%], .pointer[_ngcontent-%COMP%]{cursor:pointer}.file-upload[_ngcontent-%COMP%]{cursor:pointer;min-width:initial;padding:10px;font-size:1.5rem;line-height:20px;margin-right:.33333rem}.file-upload[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .uploader[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{display:none}.uploader[_ngcontent-%COMP%]{align-items:center;background-color:#efefef;background-color:#00000005;display:flex;height:50px;justify-content:center;outline:3px dashed #ccc;outline-offset:5px;position:relative;width:50px}.uploader[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], .uploader[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{pointer-events:none}.uploader[_ngcontent-%COMP%], .uploader[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{transition:all .1s ease-in}.uploader[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{color:#eee;color:#0003;font-size:5em}.uploader[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{left:50%;opacity:0;max-height:100%;max-width:100%;position:absolute;top:50%;transition:all .3s ease-in;transform:translate(-50%,-50%);z-index:-1}.uploader[_ngcontent-%COMP%]   img.loaded[_ngcontent-%COMP%]{opacity:1}.fileInfo[_ngcontent-%COMP%]{width:-moz-fit-content!important;width:fit-content!important;margin:5px!important;display:inline-block!important;border:1px solid rgba(0,0,0,.1);z-index:10;box-shadow:inset 1px 1px #0000001a,inset 0 -1px #00000012}.chip-list[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]  .mat-radio-outer-circle{border-color:#0000008a!important}[_nghost-%COMP%]  .mat-form-field-underline{background-color:#0000001f!important}.style-warning-label[_ngcontent-%COMP%]{color:#ff5722;opacity:.8}"]}),h})()}}]);