<ms-filter-breadcrumb
  [filterBreadcrumbData]="filterBreadcrumbData"
  (removeFilterTrigger)="removeFilterBreadcrumb($event)"
></ms-filter-breadcrumb>
<div class="p-grid p-align-baseline" style="position: relative">
  <div class="p-col-fixed no-padding super-filter">
    <label class="float-label" *ngIf="scholarSeasonFilter?.value && scholarSeasonFilter?.value?.length !== 0">
      {{ 'CARDDETAIL.Scholar Season' | translate }}
    </label>
    <ng-select
      [items]="scholarSeasonList"
      bindValue="_id"
      bindLabel="scholar_season"
      class="custom-dropdownpanel"
      [appendTo]="'body'"
      [multiple]="false"
      notFoundText="{{ 'NOT RECORD FOUND' | translate }}"
      placeholder="{{ 'CARDDETAIL.Scholar Season' | translate }}"
      [formControl]="scholarSeasonFilter"
      [clearable]="false"
      [closeOnSelect]="false"
      (close)="scholarSelect()"
    >
      <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
        <input id="item-{{ index }}" type="checkbox" [ngModel]="item$.selected" />
        {{ item.scholar_season }}
      </ng-template>
    </ng-select>
  </div>
  <div class="p-col-fixed no-padding super-filter">
    <label class="float-label" *ngIf="schoolFilter?.value && schoolFilter?.value?.length !== 0">
      {{ 'ADMISSION.TABLE_ADMISSION_CHANNEL.School' | translate }}
    </label>
    <ng-select
      [items]="schoolList"
      bindValue="_id"
      bindLabel="short_name"
      class="custom-dropdownpanel"
      [appendTo]="'body'"
      [multiple]="true"
      notFoundText="{{ 'NOT RECORD FOUND' | translate }}"
      placeholder="{{ 'ADMISSION.TABLE_ADMISSION_CHANNEL.School' | translate }}"
      [formControl]="schoolFilter"
      [clearable]="false"
      [closeOnSelect]="false"
      (close)="checkSuperFilterSchool()"
    >
      <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
        <input id="item-{{ index }}" type="checkbox" [ngModel]="item$.selected" /> {{ item.short_name | translate }}
      </ng-template>
      <ng-template ng-header-tmp *ngIf="schoolList?.length">
        <mat-checkbox
          class="all-input"
          style="cursor: pointer"
          [checked]="isAllDropdownSelected('school')"
          [indeterminate]="isSomeDropdownSelected('school')"
          (change)="selectAllData($event, 'school')"
        >
          {{ 'AllM' | translate }}
        </mat-checkbox>
      </ng-template>
    </ng-select>
  </div>
  <div class="p-col-fixed no-padding super-filter">
    <label class="float-label" *ngIf="campusFilter?.value && campusFilter?.value?.length !== 0">
      {{ 'ADMISSION.TABLE_ADMISSION_CHANNEL.Campus' | translate }}
    </label>
    <ng-select
      [items]="campusList"
      bindValue="_id"
      bindLabel="name"
      class="custom-dropdownpanel"
      [appendTo]="'body'"
      [multiple]="true"
      notFoundText="{{ 'NOT RECORD FOUND' | translate }}"
      placeholder="{{ 'ADMISSION.TABLE_ADMISSION_CHANNEL.Campus' | translate }}"
      [formControl]="campusFilter"
      [clearable]="false"
      [closeOnSelect]="false"
      (close)="checkSuperFilterCampus()"
    >
      <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
        <input id="item-{{ index }}" type="checkbox" [ngModel]="item$.selected" /> {{ item.name }}
      </ng-template>
      <ng-template ng-header-tmp *ngIf="campusList?.length">
        <mat-checkbox
          class="all-input"
          style="cursor: pointer"
          [checked]="isAllDropdownSelected('campus')"
          [indeterminate]="isSomeDropdownSelected('campus')"
          (change)="selectAllData($event, 'campus')"
        >
          {{ 'AllF' | translate }}
        </mat-checkbox>
      </ng-template>
    </ng-select>
  </div>
  <div class="p-col-fixed no-padding super-filter">
    <label class="float-label" *ngIf="levelFilter?.value && levelFilter?.value?.length !== 0">
      {{ 'ADMISSION.TABLE_ADMISSION_CHANNEL.Level' | translate }}
    </label>
    <ng-select
      [items]="levelList"
      bindValue="_id"
      bindLabel="name"
      class="custom-dropdownpanel"
      [appendTo]="'body'"
      [multiple]="true"
      notFoundText="{{ 'NOT RECORD FOUND' | translate }}"
      placeholder="{{ 'ADMISSION.TABLE_ADMISSION_CHANNEL.Level' | translate }}"
      [formControl]="levelFilter"
      [clearable]="false"
      [closeOnSelect]="false"
      (close)="checkSuperFilterLevel()"
    >
      <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
        <input id="item-{{ index }}" type="checkbox" [ngModel]="item$.selected" /> {{ item.name }}
      </ng-template>
      <ng-template ng-header-tmp *ngIf="levelList?.length">
        <mat-checkbox
          class="all-input"
          style="cursor: pointer"
          [checked]="isAllDropdownSelected('level')"
          [indeterminate]="isSomeDropdownSelected('level')"
          (change)="selectAllData($event, 'level')"
        >
          {{ 'AllF' | translate }}
        </mat-checkbox>
      </ng-template>
    </ng-select>
  </div>
  <div class="p-col-fixed no-padding super-filter">
    <label class="float-label" *ngIf="sectorFilter?.value && sectorFilter?.value?.length !== 0">
      {{ 'ADMISSION.TABLE_ADMISSION_CHANNEL.Sector' | translate }}
    </label>
    <ng-select
      [items]="sectorList"
      bindValue="_id"
      bindLabel="name"
      class="custom-dropdownpanel"
      [appendTo]="'body'"
      [multiple]="true"
      notFoundText="{{ 'NOT RECORD FOUND' | translate }}"
      placeholder="{{ 'ADMISSION.TABLE_ADMISSION_CHANNEL.Sector' | translate }}"
      [formControl]="sectorFilter"
      [clearable]="false"
      [closeOnSelect]="false"
      (close)="checkSuperFilterSector()"
    >
      <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
        <input id="item-{{ index }}" type="checkbox" [ngModel]="item$.selected" /> {{ item.name }}
      </ng-template>
      <ng-template ng-header-tmp *ngIf="sectorList?.length">
        <mat-checkbox
          class="all-input"
          style="cursor: pointer"
          [checked]="isAllDropdownSelected('sector')"
          [indeterminate]="isSomeDropdownSelected('sector')"
          (change)="selectAllData($event, 'sector')"
        >
          {{ 'AllF' | translate }}
        </mat-checkbox>
      </ng-template>
    </ng-select>
  </div>
  <div class="p-col-fixed no-padding super-filter">
    <label class="float-label" *ngIf="specialityFilter?.value && specialityFilter?.value?.length !== 0">
      {{ 'ADMISSION.TABLE_ADMISSION_CHANNEL.Speciality' | translate }}
    </label>
    <ng-select
      [items]="specialityList"
      bindValue="_id"
      bindLabel="name"
      class="custom-dropdownpanel"
      [appendTo]="'body'"
      [multiple]="true"
      notFoundText="{{ 'NOT RECORD FOUND' | translate }}"
      placeholder="{{ 'ADMISSION.TABLE_ADMISSION_CHANNEL.Speciality' | translate }}"
      [formControl]="specialityFilter"
      [clearable]="false"
      [closeOnSelect]="false"
      (close)="checkSuperFilterSpecialities()"
    >
      <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
        <input id="item-{{ index }}" type="checkbox" [ngModel]="item$.selected" /> {{ item.name }}
      </ng-template>
      <ng-template ng-header-tmp *ngIf="specialityList?.length">
        <mat-checkbox
          class="all-input"
          style="cursor: pointer"
          [checked]="isAllDropdownSelected('speciality')"
          [indeterminate]="isSomeDropdownSelected('speciality')"
          (change)="selectAllData($event, 'speciality')"
        >
          {{ 'AllF' | translate }}
        </mat-checkbox>
      </ng-template>
    </ng-select>
  </div>
  <div class="p-col-fixed no-padding super-filter">
    <label class="float-label" *ngIf="tagFilter?.value && tagFilter?.value?.length !== 0">
      {{ 'All_Students.Tag' | translate }}
    </label>
    <ng-select
      [items]="tagList"
      bindValue="_id"
      bindLabel="name"
      class="custom-dropdownpanel"
      [appendTo]="'body'"
      [multiple]="true"
      notFoundText="{{ 'NOT RECORD FOUND' | translate }}"
      placeholder="{{ 'All_Students.Tag' | translate }}"
      [formControl]="tagFilter"
      [clearable]="false"
      [closeOnSelect]="false"
      (close)="checkSuperFilterTags()"
    >
      <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
        <input id="item-{{ index }}" type="checkbox" [ngModel]="item$.selected" /> {{ item.name }}
      </ng-template>
      <ng-template ng-header-tmp *ngIf="tagList?.length">
        <mat-checkbox
          class="all-input"
          style="cursor: pointer"
          [checked]="isAllDropdownSelected('tags')"
          [indeterminate]="isSomeDropdownSelected('tags')"
          (change)="selectAllData($event, 'tags')"
        >
          {{ 'AllF' | translate }}
        </mat-checkbox>
      </ng-template>
    </ng-select>
  </div>
  <div class="p-col-fixed no-padding">
    <button mat-raised-button color="accent" [disabled]="isDisabled || isWaitingForResponse" (click)="applySuperFilter()">
      {{ 'Apply Filter' | translate }}
    </button>
  </div>
</div>
<div style="margin-top: 15px">
  <div class="horizontal header-button header-action">
    <div class="text-right custom-button tw-flex tw-items-center tw-justify-end">
      <div class="button-dummy">
        <button
          class="btn-dummy"
          [disabled]="isWaitingForResponse"
          mat-raised-button
          color="accent"
          matTooltip="{{ 'Configure Column' | translate }}"
          matTooltipPosition="above"
          (click)="openColumnDropdown()"
          *ngIf="!columnCtrl?.value?.length"
          style="z-index: 1"
        >
          <span class="tw-flex tw-items-center">
            <svg width="24" height="24" viewBox="0 0 24 24" role="presentation">
              <g fill="currentColor">
                <path
                  d="M4 18h16.008C20 18 20 6 20 6H3.992C4 6 4 18 4 18zM2 5.994C2 4.893 2.898 4 3.99 4h16.02C21.108 4 22 4.895 22 5.994v12.012A1.997 1.997 0 0120.01 20H3.99A1.994 1.994 0 012 18.006V5.994z"
                ></path>
                <path d="M8 6v12h2V6zm6 0v12h2V6z"></path>
              </g>
            </svg>

            <mat-icon>keyboard_arrow_down</mat-icon>
          </span>
        </button>
      </div>
      <mat-form-field appearance="legacy" class="custom-form-field mat-select-button">
        <mat-select [formControl]="columnCtrl" multiple disableOptionCentering #templateColumn (openedChange)="handleClose($event)">
          <mat-select-trigger>
            <button
              [disabled]="isWaitingForResponse"
              mat-raised-button
              color="accent"
              matTooltip="{{ 'Configure Column' | translate }}"
              matTooltipPosition="above"
            >
              <span class="tw-flex tw-items-center">
                <svg width="24" height="24" viewBox="0 0 24 24" role="presentation">
                  <g fill="currentColor">
                    <path
                      d="M4 18h16.008C20 18 20 6 20 6H3.992C4 6 4 18 4 18zM2 5.994C2 4.893 2.898 4 3.99 4h16.02C21.108 4 22 4.895 22 5.994v12.012A1.997 1.997 0 0120.01 20H3.99A1.994 1.994 0 012 18.006V5.994z"
                    ></path>
                    <path d="M8 6v12h2V6zm6 0v12h2V6z"></path>
                  </g>
                </svg>
  
                <mat-icon>keyboard_arrow_down</mat-icon>
              </span>
            </button>
          </mat-select-trigger>
          <div class="container-dropdown">
            <mat-option [disabled]="isWaitingForResponse" *ngFor="let col of defaultDisplayedColumns" [value]="col">{{
              col.name | translate
            }}</mat-option>
          </div>
          <mat-divider></mat-divider>
          <div class="p-grid">
            <div class="p-col-8">
              <span
                [ngStyle]="{ cursor: isWaitingForResponse ? 'auto' : 'pointer' }"
                (click)="!isWaitingForResponse ? defaultTemplateColumn() : ''"
                class="restore-to-default"
              >
                {{ 'Restore to default' | translate }}
              </span>
            </div>
            <div class="p-col-4 text-right">
              <small>{{ columnCtrl?.value?.length }} / {{ defaultDisplayedColumns?.length }}</small>
            </div>
          </div>
        </mat-select>
      </mat-form-field>
      <button
        mat-raised-button
        color="accent"
        [matMenuTriggerFor]="actions"
        matTooltip="{{ 'Action' | translate }}"
        matTooltipPosition="above"
        [disabled]="isWaitingForResponse || isLoading || !displayedColumns?.length"
        *ngIf="
          permission.studentsAllStudentsSendEmail() ||
          permission.studentsAllStudentsAddMultipleTags() ||
          permission.studentsAllStudentsRemoveTags()
        "
      >
        {{ 'Action' | translate }}
        <mat-icon>expand_more</mat-icon>
      </button>
      <mat-menu #actions="matMenu">
        <button
          (click)="controllerButton('send_mail')"
          mat-menu-item
          matTooltip="{{ 'Send email' | translate }}"
          matTooltipPosition="above"
          class="border-button"
          *ngIf="permission.studentsAllStudentsSendEmail()"
        >
          {{ 'Send email' | translate }}
        </button>
        <button
          (click)="controllerButton('add_tag')"
          mat-menu-item
          matTooltip="{{ 'All_Students.Add tag' | translate }}"
          matTooltipPosition="above"
          class="border-button"
          *ngIf="permission.studentsAllStudentsAddMultipleTags()"
        >
          {{ 'All_Students.Add tag' | translate }}
        </button>
        <button
          (click)="controllerButton('remove_tag')"
          mat-menu-item
          matTooltip="{{ 'All_Students.Remove tag' | translate }}"
          matTooltipPosition="above"
          class="border-button"
          *ngIf="permission.studentsAllStudentsRemoveTags()"
        >
          {{ 'All_Students.Remove tag' | translate }}
        </button>
        <button
          mat-menu-item
          matTooltip="{{ 'All_Students.Ask for visa document' | translate }}"
          matTooltipPosition="above"
          class="border-button"
          *ngIf="true"
          (click)="controllerButton('ask_for_visa_document')"
        >
          {{ 'All_Students.Ask for visa document' | translate }}
        </button>
        <button
          mat-menu-item
          matTooltip="{{ 'All_Students.Reminder for visa document' | translate }}"
          matTooltipPosition="above"
          *ngIf="true"
          (click)="controllerButton('reminder_for_visa_document')"
        >
          {{ 'All_Students.Reminder for visa document' | translate }}
        </button>
      </mat-menu>
      <button
        (click)="controllerButton('export')"
        mat-raised-button
        color="primary"
        matTooltip="{{ 'Export' | translate }}"
        matTooltipPosition="above"
        [disabled]="isWaitingForResponse || isLoading || !displayedColumns?.length"
        *ngIf="permission.studentsAllStudentsExport()"
      >
        <mat-icon svgIcon="file-excel" class="mat-icon-svgIcon"> </mat-icon>
        {{ 'Export' | translate }}
      </button>

      <button
        mat-raised-button
        (click)="resetTable()"
        color="primary"
        matTooltip="{{ 'Reset' | translate }}"
        matTooltipPosition="above"
        [disabled]="isWaitingForResponse || isLoading || !displayedColumns?.length"
        *ngIf="permission.studentsAllStudentsReset()"
      >
        <mat-icon svgIcon="loop" class="mat-icon-svgIcon"></mat-icon>
        {{ 'Reset' | translate }}
      </button>
    </div>
    <div class="text-right text-count">
      <span style="font-family: 'firaSans' !important" *ngIf="dataSelected?.length || (isCheckedAll && dataCount)"
        >{{ 'Selected Data' | translate }} : {{ isCheckedAll ? dataCount - dataUnselectUser?.length : dataSelected?.length }}</span
      >
    </div>
  </div>
  <div class="horizontal">
    <div class="custom-message" [ngClass]="displayedColumns?.length ? 'hide' : ''">
      <div class="p-grid pad-top-30">
        <div class="p-col-12 text-center">
          <mat-icon class="custom-icon-setting" svgIcon="setting-column"> setting-column </mat-icon>
          <div>
            <h3>{{ 'Configure your columns' | translate }}</h3>
            <div>{{ 'You havent configured any columns yet. Add fields as columns to see table information.' | translate }}</div>
            <div class="margin-top-10">
              <button
                (click)="openColumnDropdown()"
                mat-raised-button
                color="primary"
                matTooltip="{{ 'Configure Column' | translate }}"
                matTooltipPosition="above"
                [disabled]="isWaitingForResponse || isLoading"
              >
                {{ 'Configure Column' | translate }}
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <table
      [ngClass]="displayedColumns?.length ? '' : 'hide'"
      mat-table
      [dataSource]="dataSource"
      class="mat-elevation-z8"
      matSort
      (matSortChange)="sortData($event)"
      cdkDropList
      (cdkDropListDropped)="drop($event)"
      cdkDropListOrientation="horizontal"
    >
      <!-- Filter -->
      <ng-container *ngFor="let filter of filterColumns; let i = index" [matColumnDef]="filter">
        <th mat-header-cell *matHeaderCellDef>
          <ng-container [ngSwitch]="filter">
            <ng-container *ngSwitchCase="'formationTypeFilter'">
              <ng-select
                [items]="listSigle"
                class="custom-dropdownpanel"
                [appendTo]="'body'"
                [multiple]="true"
                notFoundText="{{ 'NOT RECORD FOUND' | translate }}"
                placeholder="{{ 'search' | translate }}"
                [formControl]="formationTypeFilter"
                [clearable]="false"
                [closeOnSelect]="false"
                (close)="setFormationTypeFilter()"
              >
                <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
                  <input id="item-{{ index }}" type="checkbox" [ngModel]="item$.selected" /> {{ item | translate }}
                </ng-template>
                <ng-template ng-header-tmp *ngIf="listSigle?.length">
                  <mat-checkbox
                    class="all-input"
                    style="cursor: pointer"
                    [checked]="isAllDropdownSelected('formationType')"
                    [indeterminate]="isSomeDropdownSelected('formationType')"
                    (change)="selectAllData($event, 'formationType')"
                  >
                    {{ 'All' | translate }}
                  </mat-checkbox>
                </ng-template>
              </ng-select>
            </ng-container>
            <ng-container *ngSwitchCase="'studentNumberFilter'">
              <mat-form-field appearance="legacy">
                <input matInput [formControl]="studentNumberFilter" placeholder="{{ 'search' | translate }}" />
              </mat-form-field>
            </ng-container>
            <ng-container *ngSwitchCase="'nameFilter'">
              <mat-form-field appearance="legacy">
                <input matInput [formControl]="nameFilter" placeholder="{{ 'search' | translate }}" />
              </mat-form-field>
            </ng-container>
            <ng-container *ngSwitchCase="'currentProgramFilter'">
              <ng-select
                [items]="listProgram"
                bindValue="program"
                bindLabel="program"
                class="custom-dropdownpanel"
                [appendTo]="'body'"
                [multiple]="true"
                notFoundText="{{ 'NOT RECORD FOUND' | translate }}"
                placeholder="{{ 'search' | translate }}"
                [formControl]="currentProgramFilter"
                [clearable]="false"
                [closeOnSelect]="false"
                (close)="onFilterSelect()"
              >
                <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
                  <input id="item-{{ index }}" type="checkbox" [ngModel]="item$.selected" /> {{ item?.program | translate }}
                </ng-template>
                <ng-template ng-header-tmp *ngIf="listProgram?.length">
                  <mat-checkbox
                    class="all-input"
                    style="cursor: pointer"
                    [checked]="isAllDropdownSelected('intakeChannel')"
                    [indeterminate]="isSomeDropdownSelected('intakeChannel')"
                    (change)="selectAllData($event, 'intakeChannel')"
                  >
                    {{ 'AllM' | translate }}
                  </mat-checkbox>
                </ng-template>
              </ng-select>
            </ng-container>
            <ng-container *ngSwitchCase="'statusFilter'">
              <ng-select
                [items]="studentStatusFilterList"
                class="custom-dropdownpanel"
                bindValue="value"
                bindLabel="label"
                [appendTo]="'body'"
                [multiple]="true"
                notFoundText="{{ 'NOT RECORD FOUND' | translate }}"
                placeholder="{{ 'search' | translate }}"
                [formControl]="statusFilter"
                [clearable]="false"
                [closeOnSelect]="false"
                (close)="setTypeStatusFilter()"
              >
                <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
                  <input id="item-{{ index }}" type="checkbox" [ngModel]="item$.selected" /> {{ item?.label }}
                </ng-template>
                <ng-template ng-header-tmp *ngIf="studentStatusFilterList?.length">
                  <mat-checkbox
                    class="all-input"
                    style="cursor: pointer"
                    [checked]="isAllDropdownSelected('status')"
                    [indeterminate]="isSomeDropdownSelected('status')"
                    (change)="selectAllData($event, 'status')"
                  >
                    {{ 'All' | translate }}
                  </mat-checkbox>
                </ng-template>
              </ng-select>
            </ng-container>
            <ng-container *ngSwitchCase="'typeOfRegistrationFilter'">
              <ng-select
                [items]="listRegistration"
                class="custom-dropdownpanel"
                bindValue="value"
                bindLabel="label"
                [appendTo]="'body'"
                [multiple]="true"
                notFoundText="{{ 'NOT RECORD FOUND' | translate }}"
                placeholder="{{ 'search' | translate }}"
                [formControl]="typeOfRegistrationFilter"
                [clearable]="false"
                [closeOnSelect]="false"
                (close)="setTypeofRegisFilter()"
              >
                <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
                  <input id="item-{{ index }}" type="checkbox" [ngModel]="item$.selected" /> {{ item?.label }}
                </ng-template>
                <ng-template ng-header-tmp *ngIf="listRegistration?.length">
                  <mat-checkbox
                    class="all-input"
                    style="cursor: pointer"
                    [checked]="isAllDropdownSelected('typeOfRegis')"
                    [indeterminate]="isSomeDropdownSelected('typeOfRegis')"
                    (change)="selectAllData($event, 'typeOfRegis')"
                  >
                    {{ 'All' | translate }}
                  </mat-checkbox>
                </ng-template>
              </ng-select>
            </ng-container>
            <ng-container *ngSwitchCase="'downPaymentFilter'">
              <ng-select
                [items]="DPFilterList"
                bindValue="value"
                bindLabel="label"
                class="custom-dropdownpanel"
                [appendTo]="'body'"
                [multiple]="true"
                notFoundText="{{ 'NOT RECORD FOUND' | translate }}"
                placeholder="{{ 'search' | translate }}"
                [formControl]="downPaymentFilter"
                [clearable]="false"
                [closeOnSelect]="false"
                (close)="setDownPaymentFilter()"
              >
                <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
                  <input id="item-{{ index }}" type="checkbox" [ngModel]="item$.selected" /> {{ item?.label }}
                </ng-template>
                <ng-template ng-header-tmp *ngIf="DPFilterList?.length">
                  <mat-checkbox
                    class="all-input"
                    style="cursor: pointer; margin-right: 0 !important"
                    [checked]="isAllDropdownSelected('downPayment')"
                    [indeterminate]="isSomeDropdownSelected('downPayment')"
                    (change)="selectAllDataTable($event, 'downPayment')"
                  >
                    {{ 'AllM' | translate }}
                  </mat-checkbox>
                </ng-template>
              </ng-select>
            </ng-container>
            <ng-container *ngSwitchCase="'registrationDateFilter'">
              <mat-form-field appearance="legacy">
                <input
                  matInput
                  (click)="picker.open()"
                  [matDatepicker]="picker"
                  [readonly]="true"
                  placeholder="{{ 'search' | translate }}"
                  [formControl]="registrationDateFilter"
                />
                <mat-datepicker-toggle matSuffix [for]="picker" style="margin-right: 4px"></mat-datepicker-toggle>
                <mat-datepicker #picker></mat-datepicker>
              </mat-form-field>
            </ng-container>
            <ng-container *ngSwitchCase="'visaDocumentFilter'">
              <ng-select
                [items]="listVisa"
                class="custom-ngselect-allstudents"
                bindValue="value"
                bindLabel="label"
                [appendTo]="'body'"
                [multiple]="true"
                notFoundText="{{ 'NOT RECORD FOUND' | translate }}"
                placeholder="{{ 'search' | translate }}"
                [formControl]="visaFilter"
                [clearable]="false"
                [closeOnSelect]="false"
                (close)="setVisaFilter()"
              >
                <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
                  <input id="item-{{ index }}" type="checkbox" [ngModel]="item$.selected" /> {{ item?.label }}
                </ng-template>
                <ng-template ng-header-tmp *ngIf="listVisa?.length">
                  <mat-checkbox
                    class="all-input"
                    style="cursor: pointer"
                    [checked]="isAllDropdownSelected('visa')"
                    [indeterminate]="isSomeDropdownSelected('visa')"
                    (change)="selectAllData($event, 'visa')"
                  >
                    {{ 'All' | translate }}
                  </mat-checkbox>
                </ng-template>
              </ng-select>
            </ng-container>
            <ng-container *ngSwitchDefault> </ng-container>
          </ng-container>
        </th>
      </ng-container>

      <!-- Data -->
      <ng-container *ngFor="let column of displayedColumns; let i = index" [matColumnDef]="column">
        <ng-container [ngSwitch]="column">
          <ng-container *ngSwitchCase="'select'">
            <th
              cdkDrag
              cdkDragBoundary=".example-boundary"
              mat-header-cell
              *matHeaderCellDef
              class="text-center column-dragging"
              style="position: relative"
            >
            <div class="p-grid p-align-center p-justify-center" style="position: relative">
              <mat-icon cdkDragHandle svgIcon="drag_indicator" class="mat-icon-svgIcon icon-drag-checkbox">
                <div *cdkDragPreview class="preview">
                  <div class="checkbox" class="preview-drag"></div>
                </div>
              </mat-icon>
              <mat-checkbox
                class="label-header-checkbox"
                (change)="$event ? masterToggle() : null"
                (change)="showOptions('all', '')"
                [checked]="(selection.hasValue() && isAllSelected()) || isCheckedAll"
                [indeterminate]="selection.hasValue() && (dataUnselectUser?.length > 0 || !isAllSelected())"
                [aria-label]="checkboxLabel()"
              >
              </mat-checkbox>
            </div> 
            </th>
            <td mat-cell *matCellDef="let element" class="text-center">
              <mat-checkbox
                (click)="$event.stopPropagation()"
                (change)="$event ? selection.toggle(element._id) : null"
                [checked]="selection.isSelected(element._id) || (isCheckedAll && !dataUnselectUser?.includes(element?._id))"
                (change)="showOptions('one', element)"
                [aria-label]="checkboxLabel(element)"
              >
              </mat-checkbox>
            </td>
          </ng-container>
          <ng-container *ngSwitchCase="'formationType'">
            <th
              mat-header-cell
              *matHeaderCellDef
              cdkDrag
              cdkDragBoundary=".example-boundary"
              class="column-dragging"
              mat-sort-header="type_formation"
              matTooltip="{{ 'All_Students.Formation type' | translate }}"
              matTooltipPosition="above"
            >
              <mat-icon cdkDragHandle svgIcon="drag_indicator" class="mat-icon-svgIcon icon-drag">
                <div *cdkDragPreview class="preview">
                  <span style="word-break: break-word" class="preview-drag">
                    <svg width="15px" fill="currentColor" viewBox="0 0 24 24">
                      <path
                        d="M10 9h4V6h3l-5-5-5 5h3v3zm-1 1H6V7l-5 5 5 5v-3h3v-4zm14 2l-5-5v3h-3v4h3v3l5-5zm-9 3h-4v3H7l5 5 5-5h-3v-3z"
                      ></path>
                      <path d="M0 0h24v24H0z" fill="none"></path>
                    </svg>
                    {{ 'All_Students.Formation type' | translate }}
                  </span>
                </div>
              </mat-icon>
              <h5 class="label-header">{{ 'All_Students.Formation type' | translate }}</h5>
            </th>
            <td
              mat-cell
              matTooltip="{{ element?.type_of_formation_id?.sigle ? element?.type_of_formation_id?.sigle : '' }}"
              *matCellDef="let element"
            >
              {{ element?.type_of_formation_id?.sigle ? element?.type_of_formation_id?.sigle : '' }}
            </td>
          </ng-container>
          <ng-container *ngSwitchCase="'studentNumber'">
            <th
              mat-header-cell
              cdkDrag
              cdkDragBoundary=".example-boundary"
              *matHeaderCellDef
              class="column-dragging"
              mat-sort-header="candidate_unique_number"
              matTooltip="{{ 'Student Number' | translate }}"
              matTooltipPosition="above"
            >
              <mat-icon cdkDragHandle svgIcon="drag_indicator" class="mat-icon-svgIcon icon-drag">
                <div *cdkDragPreview class="preview">
                  <span style="word-break: break-word" class="preview-drag">
                    <svg width="15px" fill="currentColor" viewBox="0 0 24 24">
                      <path
                        d="M10 9h4V6h3l-5-5-5 5h3v3zm-1 1H6V7l-5 5 5 5v-3h3v-4zm14 2l-5-5v3h-3v4h3v3l5-5zm-9 3h-4v3H7l5 5 5-5h-3v-3z"
                      ></path>
                      <path d="M0 0h24v24H0z" fill="none"></path>
                    </svg>
                    {{ 'Student Number' | translate }}
                  </span>
                </div>
              </mat-icon>
              <h5 class="label-header">{{ 'Student Number' | translate }}</h5>
            </th>
            <td mat-cell matTooltip="{{ element?.candidate_unique_number }}" *matCellDef="let element">
              {{ element?.candidate_unique_number }}
            </td>
          </ng-container>
          <ng-container *ngSwitchCase="'name'">
            <th
              mat-header-cell
              *matHeaderCellDef
              cdkDrag
              cdkDragBoundary=".example-boundary"
              class="column-dragging"
              mat-sort-header="candidate"
              matTooltip="{{ 'Name' | translate }}"
              matTooltipPosition="above"
            >
              <mat-icon cdkDragHandle svgIcon="drag_indicator" class="mat-icon-svgIcon icon-drag">
                <div *cdkDragPreview class="preview">
                  <span style="word-break: break-word" class="preview-drag">
                    <svg width="15px" fill="currentColor" viewBox="0 0 24 24">
                      <path
                        d="M10 9h4V6h3l-5-5-5 5h3v3zm-1 1H6V7l-5 5 5 5v-3h3v-4zm14 2l-5-5v3h-3v4h3v3l5-5zm-9 3h-4v3H7l5 5 5-5h-3v-3z"
                      ></path>
                      <path d="M0 0h24v24H0z" fill="none"></path>
                    </svg>
                    {{ 'Name' | translate }}
                  </span>
                </div>
              </mat-icon>
              <h5 class="label-header">{{ 'Name' | translate }}</h5>
            </th>
            <td
              mat-cell
              matTooltip="{{ element?.last_name | uppercase }} {{ element?.first_name }} {{
                element?.civility && element?.civility === 'neutral' ? '' : (element?.civility | translate)
              }}"
              *matCellDef="let element"
            >
              {{
                (element?.last_name | uppercase) +
                  ' ' +
                  element?.first_name +
                  ' ' +
                  (element?.civility && element?.civility === 'neutral' ? '' : (element?.civility | translate))
              }}
            </td>
          </ng-container>
          <ng-container *ngSwitchCase="'currentProgram'">
            <th
              mat-header-cell
              *matHeaderCellDef
              cdkDrag
              cdkDragBoundary=".example-boundary"
              class="column-dragging"
              mat-sort-header="intake_channel"
              matTooltip="{{ 'Current Program' | translate }}"
              matTooltipPosition="above"
            >
              <mat-icon cdkDragHandle svgIcon="drag_indicator" class="mat-icon-svgIcon icon-drag">
                <div *cdkDragPreview class="preview">
                  <span style="word-break: break-word" class="preview-drag">
                    <svg width="15px" fill="currentColor" viewBox="0 0 24 24">
                      <path
                        d="M10 9h4V6h3l-5-5-5 5h3v3zm-1 1H6V7l-5 5 5 5v-3h3v-4zm14 2l-5-5v3h-3v4h3v3l5-5zm-9 3h-4v3H7l5 5 5-5h-3v-3z"
                      ></path>
                      <path d="M0 0h24v24H0z" fill="none"></path>
                    </svg>
                    {{ 'Current Program' | translate }}
                  </span>
                </div>
              </mat-icon>
              <h5 class="label-header">{{ 'Current Program' | translate }}</h5>
            </th>
            <td mat-cell *matCellDef="let element" [matTooltip]="intakeChannel(element) | translate">{{ intakeChannel(element) }}</td>
          </ng-container>
          <ng-container *ngSwitchCase="'status'">
            <th
              mat-header-cell
              *matHeaderCellDef
              cdkDrag
              cdkDragBoundary=".example-boundary"
              class="column-dragging"
              mat-sort-header="candidate_admission_status"
              matTooltip="{{ 'Status' | translate }}"
              matTooltipPosition="above"
            >
              <mat-icon cdkDragHandle svgIcon="drag_indicator" class="mat-icon-svgIcon icon-drag">
                <div *cdkDragPreview class="preview">
                  <span style="word-break: break-word" class="preview-drag">
                    <svg width="15px" fill="currentColor" viewBox="0 0 24 24">
                      <path
                        d="M10 9h4V6h3l-5-5-5 5h3v3zm-1 1H6V7l-5 5 5 5v-3h3v-4zm14 2l-5-5v3h-3v4h3v3l5-5zm-9 3h-4v3H7l5 5 5-5h-3v-3z"
                      ></path>
                      <path d="M0 0h24v24H0z" fill="none"></path>
                    </svg>
                    {{ 'Status' | translate }}
                  </span>
                </div>
              </mat-icon>
              <h5 class="label-header">{{ 'Status' | translate }}</h5>
            </th>
            <td mat-cell *matCellDef="let element">
              <span *ngIf="element?.candidate_admission_status === 'admission_in_progress'" [matTooltip]="'Admitted' | translate">
                {{ 'Adm.' | translate }}
              </span>
              <span
                *ngIf="element?.candidate_admission_status === 'engaged'"
                [matTooltip]="element?.candidate_admission_status | translate"
              >
                {{ 'Eng.' | translate }}
              </span>
              <span
                *ngIf="element?.candidate_admission_status === 'bill_validated'"
                [matTooltip]="element?.candidate_admission_status | translate"
              >
                {{ 'Bill' | translate }}
              </span>
              <span
                *ngIf="element?.candidate_admission_status === 'registered'"
                [matTooltip]="element?.candidate_admission_status | translate"
              >
                {{ 'Reg.' | translate }}
              </span>
              <span
                *ngIf="element?.candidate_admission_status === 'resign_after_school_begins'"
                [matTooltip]="'Resigned after school begins' | translate"
              >
                {{ 'status_resign_after_school_begins' | translate }}
              </span>
              <span
                *ngIf="element?.candidate_admission_status === 'no_show'"
                [matTooltip]="element?.candidate_admission_status | translate"
              >
                {{ 'No.' | translate }}
              </span>
              <span
                *ngIf="element?.candidate_admission_status === 'resigned'"
                [matTooltip]="element?.candidate_admission_status | translate"
              >
                {{ 'Res.' | translate }}
              </span>
              <span
                *ngIf="element?.candidate_admission_status === 'report_inscription'"
                [matTooltip]="'Postpone Inscription N+1' | translate"
              >
                {{ 'Post.' | translate }}
              </span>

              <span
                *ngIf="element?.candidate_admission_status === 'financement_validated'"
                [matTooltip]="'financement_validated' | translate"
              >
                {{ 'Await.' | translate }}
              </span>

              <span
                *ngIf="element?.candidate_admission_status === 'resigned_after_engaged'"
                [matTooltip]="element?.candidate_admission_status | translate"
              >
                {{ 'ResAfter.' | translate }}
              </span>
              <span
                *ngIf="element?.candidate_admission_status === 'resigned_after_registered'"
                [matTooltip]="element?.candidate_admission_status | translate"
              >
                {{ 'ResReg.' | translate }}
              </span>
              <span *ngIf="element?.candidate_admission_status === 'deactivated'" [matTooltip]="'Deactivated' | translate">
                {{ 'Deac.' | translate }}
              </span>
              <span *ngIf="element?.candidate_admission_status === 'in_scholarship'" [matTooltip]="'in_scholarship' | translate">
                {{ 'Sch.' | translate }}
              </span>
              <span
                *ngIf="element?.candidate_admission_status === 'resignation_missing_prerequisites'"
                [matTooltip]="'resignation_missing_prerequisites' | translate"
              >
                {{ 'Ren. PM' | translate }}
              </span>
              <span
                *ngIf="element?.candidate_admission_status === 'mission_card_validated'"
                [matTooltip]="element?.candidate_admission_status | translate"
              >
                {{ 'Miss.' | translate }}
              </span>
            </td>
          </ng-container>
          <ng-container *ngSwitchCase="'typeOfRegistration'">
            <th
              mat-header-cell
              class="column-dragging"
              *matHeaderCellDef
              cdkDrag
              cdkDragBoundary=".example-boundary"
              mat-sort-header="type_of_registration"
              matTooltip="{{ 'All_Students.Type of registration' | translate }}"
              matTooltipPosition="above"
            >
              <mat-icon cdkDragHandle svgIcon="drag_indicator" class="mat-icon-svgIcon icon-drag">
                <div *cdkDragPreview class="preview">
                  <span style="word-break: break-word" class="preview-drag">
                    <svg width="15px" fill="currentColor" viewBox="0 0 24 24">
                      <path
                        d="M10 9h4V6h3l-5-5-5 5h3v3zm-1 1H6V7l-5 5 5 5v-3h3v-4zm14 2l-5-5v3h-3v4h3v3l5-5zm-9 3h-4v3H7l5 5 5-5h-3v-3z"
                      ></path>
                      <path d="M0 0h24v24H0z" fill="none"></path>
                    </svg>
                    {{ 'All_Students.Type of registration' | translate }}
                  </span>
                </div>
              </mat-icon>
              <h5 class="label-header">{{ 'All_Students.Type of registration' | translate }}</h5>
            </th>
            <td
              mat-cell
              *matCellDef="let element"
              [matTooltip]="
                element?.readmission_status ? ('STUDENT_TABLE.readmission' | translate) : ('STUDENT_TABLE.admission' | translate)
              "
            >
              {{ element?.readmission_status ? ('STUDENT_TABLE.readmission' | translate) : ('STUDENT_TABLE.admission' | translate) }}
            </td>
          </ng-container>
          <ng-container *ngSwitchCase="'downPayment'">
            <th
              mat-header-cell
              class="column-dragging"
              *matHeaderCellDef
              cdkDrag
              cdkDragBoundary=".example-boundary"
              mat-sort-header="payment"
              matTooltip="{{ 'AdmissionFollowUp.Down payment' | translate }}"
              matTooltipPosition="above"
            >
              <mat-icon cdkDragHandle svgIcon="drag_indicator" class="mat-icon-svgIcon icon-drag">
                <div *cdkDragPreview class="preview">
                  <span style="word-break: break-word" class="preview-drag">
                    <mat-icon class="icon-header"> euro_symbol </mat-icon>
                  </span>
                </div>
              </mat-icon>
              <h5 class="label-header">
                <mat-icon class="icon-header"> euro_symbol </mat-icon>
              </h5>
            </th>
            <td mat-cell *matCellDef="let element">
              <!-- <ng-container *ngIf="element?.payment === 'sepa_pending' || element?.payment === 'pending'">
            <mat-icon [matTooltip]="'down_payment_option.pending' | translate" class="yellow icon-header" aria-hidden="true"
              >lens
            </mat-icon>
          </ng-container>
          <ng-container *ngIf="element?.payment !== 'sepa_pending' && element?.payment !== 'pending'">
            <ng-container *ngIf="checkIfDoesntHaveAnyDP(element)">
              <span style="color: #b7b7b7">x</span>
            </ng-container>
            <ng-container *ngIf="element?.billing_id?.deposit_status === 'billed' && !element?.payment_method" >
              <mat-icon [matTooltip]="'billed' | translate" class="blue icon-header" aria-hidden="true">lens
              </mat-icon>
            </ng-container>
            <ng-container *ngIf="checkDpIsNotPaid(element) && !checkIfDoesntHaveAnyDP(element)">
              <mat-icon [matTooltip]="'down_payment_option.not_paid' | translate" class="red icon-header" aria-hidden="true"
              >lens
            </mat-icon>
            </ng-container>
            <ng-container
              *ngIf="
                (checkDpIsPaidPartial(element) && !checkIfDoesntHaveAnyDP(element)) ||
                ((element?.payment === 'not_authorized' || element?.payment === 'chargeback') &&
                  element.payment_method !== 'check' &&
                  element.payment_method !== 'transfer')
              "
            >
              <mat-icon
                [ngClass]="checkConditionStatusDownPayment(element)"
                class="icon-header"
                aria-hidden="true"
                [matTooltip]="renderTooltipStatusDP(element)"
                >lens
              </mat-icon>
            </ng-container>
          </ng-container> -->

              <!-- *************** not paid icon-->
              <ng-container *ngIf="renderTooltipStatusDP(element) === 'not_paid'">
                <mat-icon matTooltip="{{ 'DP_Status.not_paid' | translate }}" class="red icon-header" aria-hidden="true">lens </mat-icon>
              </ng-container>
              <!-- *************** reject icon -->
              <ng-container *ngIf="renderTooltipStatusDP(element) === 'rejected'">
                <mat-icon matTooltipPosition="above" matTooltip="{{ 'Refused' | translate }}" class="icon-header red" aria-hidden="true"
                  >lens
                </mat-icon>
              </ng-container>
              <!-- *************** paid icon -->
              <ng-container *ngIf="renderTooltipStatusDP(element) === 'paid'">
                <mat-icon matTooltipPosition="above" matTooltip="{{ 'Paid' | translate }}" class="icon-header green" aria-hidden="true"
                  >lens
                </mat-icon>
              </ng-container>
              <!-- *************** partially_paid icon need checked-->
              <ng-container *ngIf="renderTooltipStatusDP(element) === 'partially_paid'">
                <mat-icon
                  *ngIf="element?.billing_id?.deposit_status === 'partially_paid'"
                  matTooltipPosition="above"
                  matTooltip="{{ 'Partially paid' | translate }}"
                  class="icon-header yellow"
                  aria-hidden="true"
                  >lens
                </mat-icon>
              </ng-container>
              <!-- *************** generated/billed icon-->
              <ng-container *ngIf="renderTooltipStatusDP(element) === 'billed'">
                <mat-icon matTooltip="{{ 'Generated' | translate }}" class="blue icon-header" aria-hidden="true">lens </mat-icon>
              </ng-container>
              <!-- *************** pending icon -->
              <ng-container *ngIf="renderTooltipStatusDP(element) === 'pending'">
                <mat-icon matTooltipPosition="above" matTooltip="{{ 'Pending' | translate }}" class="icon-header orange" aria-hidden="true"
                  >lens
                </mat-icon>
              </ng-container>
              <!-- *************** chargeback -->
              <ng-container *ngIf="renderTooltipStatusDP(element) === 'chargeback'">
                <mat-icon
                  matTooltipPosition="above"
                  matTooltip="{{ 'chargeback' | translate }}"
                  class="icon-header magenta"
                  aria-hidden="true"
                  >lens
                </mat-icon>
              </ng-container>
              <!-- *************** not_billed icon -->
              <ng-container *ngIf="renderTooltipStatusDP(element) === 'not_billed'">
                <mat-icon matTooltipPosition="above" matTooltip="{{ 'not_billed' | translate }}" class="icon-header red" aria-hidden="true"
                  >lens
                </mat-icon>
              </ng-container>
              <ng-container *ngIf="!renderTooltipStatusDP(element)">
                <span style="color: #b7b7b7">x</span>
              </ng-container>
            </td>
          </ng-container>
          <ng-container *ngSwitchCase="'registrationDate'">
            <th
              mat-header-cell
              class="column-dragging"
              cdkDrag
              cdkDragBoundary=".example-boundary"
              *matHeaderCellDef
              mat-sort-header="registered_at"
              matTooltip="{{ 'All_Students.Registration Date' | translate }}"
              matTooltipPosition="above"
            >
              <mat-icon cdkDragHandle svgIcon="drag_indicator" class="mat-icon-svgIcon icon-drag">
                <div *cdkDragPreview class="preview">
                  <span style="word-break: break-word" class="preview-drag">
                    <svg width="15px" fill="currentColor" viewBox="0 0 24 24">
                      <path
                        d="M10 9h4V6h3l-5-5-5 5h3v3zm-1 1H6V7l-5 5 5 5v-3h3v-4zm14 2l-5-5v3h-3v4h3v3l5-5zm-9 3h-4v3H7l5 5 5-5h-3v-3z"
                      ></path>
                      <path d="M0 0h24v24H0z" fill="none"></path>
                    </svg>
                    {{ 'All_Students.Registration Date' | translate }}
                  </span>
                </div>
              </mat-icon>
              <h5 class="label-header" style="left: 10px !important">{{ 'All_Students.Registration Date' | translate }}</h5>
            </th>
            <td mat-cell *matCellDef="let element">
              <ng-container *ngIf="element?.candidate_admission_status === 'registered'">
                <span [matTooltip]="transformRegistrationDate(element)" style="cursor: default">{{
                  transformRegistrationDate(element)
                }}</span>
              </ng-container>
            </td>
          </ng-container>
          <ng-container *ngSwitchCase="'visaDocument'">
            <th
              mat-header-cell
              class="column-dragging"
              *matHeaderCellDef
              cdkDrag
              cdkDragBoundary=".example-boundary"
              mat-sort-header="visa_status"
              matTooltip="{{ 'Visa Document' | translate }}"
              matTooltipPosition="above"
              style="position:relative !important"
            >
              <mat-icon cdkDragHandle svgIcon="drag_indicator" class="mat-icon-svgIcon icon-drag icon-drag-visa">
                <div *cdkDragPreview class="preview">
                  <span style="word-break: break-word" class="preview-drag">
                    <svg width="15px" fill="currentColor" viewBox="0 0 24 24">
                      <path
                        d="M10 9h4V6h3l-5-5-5 5h3v3zm-1 1H6V7l-5 5 5 5v-3h3v-4zm14 2l-5-5v3h-3v4h3v3l5-5zm-9 3h-4v3H7l5 5 5-5h-3v-3z"
                      ></path>
                      <path d="M0 0h24v24H0z" fill="none"></path>
                    </svg>
                    {{ 'Visa Document' | translate }}
                  </span>
                </div>
              </mat-icon>
              <h5 class="label-header">{{ 'Visa Document' | translate }}</h5>
            </th>
            <td mat-cell *matCellDef="let element">
              <span [matTooltip]="'ERP_009_TEACHER_CONTRACT.Not Required' | translate" *ngIf="!element?.require_visa_permit">x </span>
              <mat-icon  *ngIf="element?.require_visa_permit" [ngClass]="checkVisa(element)" [matTooltip]="checkTooltipVisa(element)">
                lens
              </mat-icon>
            </td>
          </ng-container>
          <ng-container *ngSwitchCase="'action'">
            <th
              style="position: relative"
              mat-header-cell
              class="column-dragging"
              cdkDrag
              cdkDragBoundary=".example-boundary"
              *matHeaderCellDef
              matTooltip="{{ 'Action' | translate }}"
              matTooltipPosition="above"
            >
              <div class="p-grid p-align-center p-justify-center custom-drag" style="position: relative">
                <mat-icon cdkDragHandle svgIcon="drag_indicator" class="mat-icon-svgIcon icon-drag-checkbox custom-drag-icon">
                  <div *cdkDragPreview class="preview">
                    <span style="word-break: break-word" class="preview-drag">
                      <svg width="15px" fill="currentColor" viewBox="0 0 24 24">
                        <path
                          d="M10 9h4V6h3l-5-5-5 5h3v3zm-1 1H6V7l-5 5 5 5v-3h3v-4zm14 2l-5-5v3h-3v4h3v3l5-5zm-9 3h-4v3H7l5 5 5-5h-3v-3z"
                        ></path>
                        <path d="M0 0h24v24H0z" fill="none"></path>
                      </svg>
                      {{ 'Action' | translate }}
                    </span>
                  </div>
                </mat-icon>
              </div>
              <h5 class="label-header">{{ 'Action' | translate }}</h5>
            </th>
            <td mat-cell *matCellDef="let element" class="text-center">
              <button
                mat-icon-button
                (click)="connectAsStudent(element)"
                [disabled]="selection.hasValue()"
                matTooltip="{{ 'Connect as this User' | translate }}"
                matTooltipPosition="above"
                style="margin-right: 5px"
              >
                <mat-icon mat-icon-button svgIcon="incognito" class="material-icons icon" style="font-size: 24px"> </mat-icon>
              </button>
              <button
                mat-icon-button
                class="margin-right-button"
                [matTooltip]="'View student card' | translate"
                matTooltipPosition="above"
                (click)="goToStudentCard(element)"
                [disabled]="selection.hasValue()"
              >
                <mat-icon>visibility</mat-icon>
              </button>
              <button
                mat-icon-button
                [matTooltip]="'Send email' | translate"
                matTooltipPosition="above"
                class="margin-right-button"
                *ngIf="permission.studentsAllStudentsSendEmail()"
                (click)="sendEmailStudent(element)"
                [disabled]="selection.hasValue()"
              >
                <mat-icon>send</mat-icon>
              </button>
              <button
                mat-icon-button
                class="margin-right-button"
                [matTooltip]="'All_Students.Ask for visa document' | translate"
                matTooltipPosition="above"
                *ngIf="
                  ['not_sent', 'rejected', 'document_expired'].includes(element?.visa_document_process_id?.form_status) || 
                  (element?.require_visa_permit && !element?.visa_document_process_id)
                "
                [disabled]="selection.hasValue()"
                (click)="askForVisaDocumentDialog(element)"
              >
                <mat-icon>forward_to_inbox</mat-icon>
              </button>
              <button
                mat-icon-button
                [matTooltip]="'All_Students.Reminder for visa document' | translate"
                matTooltipPosition="above"
                *ngIf="['rejected', 'document_expired', 'not_completed'].includes(element?.visa_document_process_id?.form_status)"
                [disabled]="selection.hasValue()"
                (click)="sendReminder(element)"
              >
                <mat-icon>notifications</mat-icon>
              </button>
            </td>
          </ng-container>

          <ng-container *ngSwitchDefault>
            <th mat-header-cell *matHeaderCellDef></th>
            <td mat-cell *matCellDef="let element"></td>
          </ng-container>
        </ng-container>
      </ng-container>

      <ng-container matColumnDef="loading">
        <th mat-header-cell *matHeaderCellDef colspan="100%" class="text-center">
          <div class="center-spinner">
            <mat-spinner color="accent"></mat-spinner>
          </div>
        </th>
      </ng-container>
      <tr mat-header-row *matHeaderRowDef="displayedColumns" class="example-boundary"></tr>
      <tr mat-header-row *matHeaderRowDef="filterColumns"></tr>
      <tr mat-header-row *matHeaderRowDef="['loading']" [hidden]="!isWaitingForResponse"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns" [hidden]="isWaitingForResponse"></tr>
    </table>
  </div>
  <div style="margin-bottom: 30px" class="horizontal">
    <div *ngIf="!dataSource.data.length && !isWaitingForResponse" class="no-records">
      {{ 'NOT RECORD FOUND' | translate }}
    </div>
    <div [ngClass]="!displayedColumns?.length ? 'hide' : !dataSource.data.length ? 'hide' : ''">
      <mat-paginator
        [ngClass]="{ 'hide-pagination-buttons': dataCount <= 10 }"
        [length]="dataCount"
        [hidePageSize]="true"
        pageSize="10"
        showFirstLastButtons
      ></mat-paginator>
    </div>
  </div>
</div>
<div *ngIf="isLoading" class="loading-indicator">
  <mat-spinner color="accent" [diameter]="100"></mat-spinner>
</div>
<div style="display: none">
  <iframe *ngIf="studentSafeUrl" style="display: none" [src]="studentSafeUrl" id="ifr"></iframe>
</div>
