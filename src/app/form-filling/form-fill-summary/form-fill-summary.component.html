<!-- <ms-form-filling-revision-box
  *ngIf="formDetail?.revise_request_messages?.length"
  [formDetail]="formDetail"
  [messages]="formDetail?.revise_request_messages"
></ms-form-filling-revision-box> -->

<ng-container *ngIf="!processFinish">
  <div class="revision-box-container" *ngIf="formDetail?.revise_request_messages?.length">
    <ms-form-filling-revision-box
      [formDetail]="formDetail"
      [messages]="formDetail?.revise_request_messages"
      (triggerRefresh)="this.triggerRefresh.emit(formDetail.formId)"
    ></ms-form-filling-revision-box>
  </div>

  <div class="row">
    <div class="col-lg-12">
      <div class="row">
        <div class="col-lg-12">
          <div class="pdf-document">
            <!-- Header Document -->
            <div class="header">
              <div [innerHTML]="stepData?.direction"></div>
              <!-- {{ stepData.segments[0].segment_title }} -->
            </div>
            <div class="p-grid" style="margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 0.1px solid rgba(0, 0, 0, 0.1)">
              <div class="p-col-12">
                <span style="font-size: 1.7rem">
                  <b> {{ stepData?.segments[0]?.segment_title | titlecase }} {{ 'Admission Form' | translate }}</b>
                </span>
                <span *ngIf="!formDetail.isPreview" style="text-align: end; float: right">
                  <button
                    color="accent"
                    mat-raised-button
                    class="btn-save"
                    matTooltip="{{ 'PDF' | translate }}"
                    [disabled]="isLoading"
                    (click)="downloadPDF()"
                  >
                    <mat-icon class="pdf-icon" svgIcon="file-pdf-outline"></mat-icon>
                    {{ 'PDF' | translate }}
                  </button>
                </span>
                <span *ngIf="formDetail?.isPreview" style="text-align: end; float: right">
                  <button color="accent" mat-raised-button class="btn-save" matTooltip="{{ 'PDF' | translate }}">
                    <mat-icon class="pdf-icon" svgIcon="file-pdf-outline"></mat-icon>
                    {{ 'PDF' | translate }}
                  </button>
                </span>
              </div>
            </div>

            <!-- HEADER -->
            <ng-container>
              <div class="p-grid">
                <div class="p-col-12">
                  <div [innerHTML]="stepData?.segments[0]?.questions[0]?.special_question?.summary_header"></div>
                </div>
              </div>
            </ng-container>

            <div style="border: 1px solid black" *ngIf="!isLoading">
              <form [formGroup]="templateSummaryForm">
                <ng-container *ngFor="let step of templateStep; let in = index">
                  <ng-container *ngIf="step?.is_step_included_in_summary">
                    <div class="p-col-12 step-title">
                      <div style="display: flex">
                        <div class="p-col-12 no-padding" style="text-align: center">
                          <b>{{ step?.step_title }}</b>
                        </div>
                      </div>
                    </div>

                    <ng-container *ngIf="step?.step_type === 'question_and_field' || step?.step_type === 'academic_journey'">
                      <ng-container *ngFor="let segment of step?.segments; let segmentInd = index">
                        <div class="p-col-12 segment-title">
                          <div style="display: flex">
                            <div class="p-col-12">
                              <b style="padding: 0.5em">{{ segment?.segment_title }}</b>
                            </div>
                          </div>
                        </div>

                        <div class="p-col-12 pad-ver-none">
                          <div class="p-grid">
                            <div
                              #questionLoop
                              *ngFor="let question of segment?.questions; let questInd = index"
                              [ngClass]="[
                                (segment?.questions[questInd + 1]?.field_position === 'right' && question?.field_position !== 'right') ||
                                (segment?.questions[questInd === 0 ? 0 : questInd - 1]?.field_position === 'left' &&
                                  question?.field_position === 'right')
                                  ? 'p-col-12 p-md-6'
                                  : 'p-col-12 p-md-6 full-width',
                                questionLoop.classList.contains('full-width') && question?.field_position === 'right'
                                  ? 'right-end'
                                  : 'left-end'
                              ]"
                            >
                              <!----- IF is_field is TRUE ------------------------------------------------------>
                              <ng-container *ngIf="question?.is_field && question?.field_type !== 'upload_picture'">
                                <ng-container *ngIf="question?.field_type === 'parent_relation'; else default">
                                  <div
                                    class="p-grid"
                                    [ngClass]="questionLoop.classList.contains('right-end') ? 'justify-end' : 'justify-start'"
                                  >
                                    <div class="p-col-4">
                                      <p>{{ 'FORM_BUILDER_FIELD.' + question?.field_type | translate }}</p>
                                    </div>
                                    <div class="p-col-8">
                                      : <span style="margin-left: 10px">{{ 'CARDDETAIL.RELATION.' + question?.answer | translate }}</span>
                                    </div>
                                  </div>
                                </ng-container>
                                <ng-template #default>
                                  <div
                                    class="p-grid"
                                    [ngClass]="questionLoop.classList.contains('right-end') ? 'justify-end' : 'justify-start'"
                                  >
                                    <div class="p-col-4">
                                      <p>{{ 'FORM_BUILDER_FIELD.' + question?.field_type | translate }}</p>
                                    </div>
                                    <div class="p-col-8">
                                      :
                                      <span style="margin-left: 10px">
                                        <ng-container
                                          *ngIf="
                                            question?.field_type === 'student_iban' || question?.field_type === 'financial_support_iban'
                                          "
                                          >{{ generateIban(question?.answer) }}
                                        </ng-container>
                                        <ng-container
                                          *ngIf="
                                            question?.field_type !== 'student_iban' && question?.field_type !== 'financial_support_iban'
                                          "
                                          >{{
                                            question?.field_type === 'student_civility' || question?.field_type === 'parent_civility'
                                              ? (question?.answer | translate)
                                              : question?.answer
                                          }}
                                        </ng-container>
                                      </span>
                                    </div>
                                  </div>
                                </ng-template>
                              </ng-container>

                              <!----- IF is_field is FALSE ------------------------------------------------------>
                              <ng-container *ngIf="!question?.is_field">
                                <!----- Free Text ------------------------------->
                                <ng-container *ngIf="question?.answer_type === 'free_text'">
                                  <div
                                    class="p-grid"
                                    [ngClass]="questionLoop.classList.contains('right-end') ? 'justify-end' : 'justify-start'"
                                  >
                                    <div class="p-col-4">
                                      <p>{{ question?.question_label }}</p>
                                    </div>
                                    <div class="p-col-8">
                                      : <span style="margin-left: 10px">{{ question?.answer }}</span>
                                    </div>
                                  </div>
                                </ng-container>
                                <!----- Long Text ------------------------------->
                                <ng-container *ngIf="question?.answer_type === 'long_answer'">
                                  <div
                                    class="p-grid"
                                    [ngClass]="questionLoop.classList.contains('right-end') ? 'justify-end' : 'justify-start'"
                                  >
                                    <div class="p-col-4">
                                      <p>{{ question?.question_label }}</p>
                                    </div>
                                    <div class="p-col-8">
                                      : <span style="margin-left: 10px">{{ question?.answer }}</span>
                                    </div>
                                  </div>
                                </ng-container>
                                <!----- Email ------------------------------->
                                <ng-container *ngIf="question?.answer_type === 'email'">
                                  <div
                                    class="p-grid"
                                    [ngClass]="questionLoop.classList.contains('right-end') ? 'justify-end' : 'justify-start'"
                                  >
                                    <div class="p-col-4">
                                      <p>{{ question?.question_label }}</p>
                                    </div>
                                    <div class="p-col-8">
                                      : <span style="margin-left: 10px">{{ question?.answer }}</span>
                                    </div>
                                  </div>
                                </ng-container>
                                <!----- Date Type ------------------------------->
                                <ng-container *ngIf="question?.answer_type === 'date'">
                                  <div
                                    class="p-grid"
                                    [ngClass]="questionLoop.classList.contains('right-end') ? 'justify-end' : 'justify-start'"
                                  >
                                    <div class="p-col-4">
                                      <p>{{ question?.question_label }}</p>
                                    </div>
                                    <div class="p-col-8">
                                      : <span style="margin-left: 10px">{{ question?.answer_date?.date }}</span>
                                    </div>
                                  </div>
                                </ng-container>
                                <!----- Numeric ------------------------------->
                                <ng-container *ngIf="question?.answer_type === 'numeric'">
                                  <div
                                    class="p-grid"
                                    [ngClass]="questionLoop.classList.contains('right-end') ? 'justify-end' : 'justify-start'"
                                  >
                                    <div class="p-col-4">
                                      <p>{{ question?.question_label }}</p>
                                    </div>
                                    <div class="p-col-8">
                                      : <span style="margin-left: 10px">{{ question?.answer_number }}</span>
                                    </div>
                                  </div>
                                </ng-container>
                                <!----- Single Option ------------------------------->
                                <ng-container *ngIf="question?.answer_type === 'single_option' || question?.answer_type === 'dropdown_single_option'">
                                  <div
                                    class="p-grid"
                                    [ngClass]="questionLoop.classList.contains('right-end') ? 'justify-end' : 'justify-start'"
                                  >
                                    <div class="p-col-4">
                                      <p>{{ question?.question_label }}</p>
                                    </div>
                                    <div class="p-col-8">
                                      : <span style="margin-left: 10px">{{ question?.answer }}</span>
                                    </div>
                                  </div>
                                </ng-container>
                                <!----- Multiple Option ------------------------------->
                                <ng-container *ngIf="question?.answer_type === 'multiple_option' || question?.answer_type === 'dropdown_multiple_option'">
                                  <div
                                    class="p-grid"
                                    [ngClass]="questionLoop.classList.contains('right-end') ? 'justify-end' : 'justify-start'"
                                  >
                                    <div class="p-col-4">
                                      <p>{{ question?.question_label }}</p>
                                    </div>
                                    <div class="p-col-8">
                                      :
                                      <span
                                        style="margin-left: 10px"
                                        *ngFor="let answer_multiple of question?.answer_multiple; let isLast = last"
                                        >{{ answer_multiple }}<span *ngIf="!isLast">, </span>
                                      </span>
                                    </div>
                                  </div>
                                </ng-container>
                              </ng-container>
                            </div>
                          </div>
                        </div>
                      </ng-container>
                    </ng-container>
                    <ng-container *ngIf="step?.step_type === 'modality_payment'">
                      <ng-container *ngFor="let segment of step?.segments; let segmentInd = index">
                        <!-- validation to show only selected modality payment -->
                        <ng-container *ngIf="segment?.is_selected_modality">
                          <div class="p-col-12 segment-title">
                            <div style="display: flex">
                              <div class="p-col-12">
                                <b style="padding: 0.5em">{{ segment?.segment_title }}</b>
                              </div>
                            </div>
                          </div>

                          <div class="p-col-12 pad-ver-none">
                            <div class="p-grid">
                              <div
                                #questionLoop
                                *ngFor="let question of segment?.questions; let questInd = index"
                                [ngClass]="[
                                  (segment?.questions[questInd + 1]?.field_position === 'right' && question?.field_position !== 'right') ||
                                  (segment?.questions[questInd === 0 ? 0 : questInd - 1]?.field_position === 'left' &&
                                    question?.field_position === 'right')
                                    ? 'p-col-12 p-md-6'
                                    : 'p-col-12 p-md-6 should-full',
                                  questionLoop.classList.contains('should-full') && question?.field_position === 'right'
                                    ? 'right-end'
                                    : 'left-end'
                                ]"
                              >
                                <!----- IF is_field is TRUE ------------------------------------------------------>
                                <ng-container *ngIf="question?.is_field">
                                  <ng-container *ngIf="question?.field_type === 'parent_relation'; else default">
                                    <div
                                      class="p-grid"
                                      [ngClass]="questionLoop.classList.contains('right-end') ? 'justify-end' : 'justify-start'"
                                    >
                                      <div class="p-col-4">
                                        <p>{{ 'FORM_BUILDER_FIELD.' + question?.field_type | translate }}</p>
                                      </div>
                                      <div class="p-col-8">
                                        : <span style="margin-left: 10px">{{ 'CARDDETAIL.RELATION.' + question?.answer | translate }}</span>
                                      </div>
                                    </div>
                                  </ng-container>
                                  <ng-template #default>
                                    <div
                                      class="p-grid"
                                      [ngClass]="questionLoop.classList.contains('right-end') ? 'justify-end' : 'justify-start'"
                                    >
                                      <div class="p-col-4">
                                        <p>{{ 'FORM_BUILDER_FIELD.' + question?.field_type | translate }}</p>
                                      </div>
                                      <div class="p-col-8">
                                        :
                                        <ng-container
                                          *ngIf="
                                            question?.field_type === 'student_iban' || question?.field_type === 'financial_support_iban'
                                          "
                                        >
                                          <span style="margin-left: 10px">{{ generateIban(question?.answer) }}</span>
                                        </ng-container>
                                        <ng-container
                                          *ngIf="
                                            question?.field_type !== 'student_iban' && question?.field_type !== 'financial_support_iban'
                                          "
                                        >
                                          <span style="margin-left: 10px">{{
                                            question?.field_type === 'financial_support_link'
                                              ? ('CARDDETAIL.RELATION.' + question?.answer | translate)
                                              : question?.field_type === 'financial_support_civility'
                                              ? ('CARDDETAIL.' + question?.answer | translate)
                                              : question?.answer
                                          }}</span>
                                        </ng-container>
                                      </div>
                                    </div>
                                  </ng-template>
                                </ng-container>

                                <!----- IF is_field is FALSE ------------------------------------------------------>
                                <ng-container *ngIf="!question?.is_field">
                                  <!----- Free Text ------------------------------->
                                  <ng-container *ngIf="question?.answer_type === 'free_text'">
                                    <div
                                      class="p-grid"
                                      [ngClass]="questionLoop.classList.contains('right-end') ? 'justify-end' : 'justify-start'"
                                    >
                                      <div class="p-col-4">
                                        <p>{{ question?.question_label }}</p>
                                      </div>
                                      <div class="p-col-8">
                                        : <span style="margin-left: 10px">{{ question?.answer }}</span>
                                      </div>
                                    </div>
                                  </ng-container>
                                  <!----- Long Text ------------------------------->
                                  <ng-container *ngIf="question?.answer_type === 'long_answer'">
                                    <div
                                      class="p-grid"
                                      [ngClass]="questionLoop.classList.contains('right-end') ? 'justify-end' : 'justify-start'"
                                    >
                                      <div class="p-col-4">
                                        <p>{{ question?.question_label }}</p>
                                      </div>
                                      <div class="p-col-8">
                                        : <span style="margin-left: 10px">{{ question?.answer }}</span>
                                      </div>
                                    </div>
                                  </ng-container>
                                  <!----- Email ------------------------------->
                                  <ng-container *ngIf="question?.answer_type === 'email'">
                                    <div
                                      class="p-grid"
                                      [ngClass]="questionLoop.classList.contains('right-end') ? 'justify-end' : 'justify-start'"
                                    >
                                      <div class="p-col-4">
                                        <p>{{ question?.question_label }}</p>
                                      </div>
                                      <div class="p-col-8">
                                        : <span style="margin-left: 10px">{{ question?.answer }}</span>
                                      </div>
                                    </div>
                                  </ng-container>
                                  <!----- Date Type ------------------------------->
                                  <ng-container *ngIf="question?.answer_type === 'date'">
                                    <div
                                      class="p-grid"
                                      [ngClass]="questionLoop.classList.contains('right-end') ? 'justify-end' : 'justify-start'"
                                    >
                                      <div class="p-col-4">
                                        <p>{{ question?.question_label }}</p>
                                      </div>
                                      <div class="p-col-8">
                                        : <span style="margin-left: 10px">{{ question?.answer_date?.date }}</span>
                                      </div>
                                    </div>
                                  </ng-container>
                                  <!----- Numeric ------------------------------->
                                  <ng-container *ngIf="question?.answer_type === 'numeric'">
                                    <div
                                      class="p-grid"
                                      [ngClass]="questionLoop.classList.contains('right-end') ? 'justify-end' : 'justify-start'"
                                    >
                                      <div class="p-col-4">
                                        <p>{{ question?.question_label }}</p>
                                      </div>
                                      <div class="p-col-8">
                                        : <span style="margin-left: 10px">{{ question?.answer_number }}</span>
                                      </div>
                                    </div>
                                  </ng-container>
                                  <!----- Single Option ------------------------------->
                                  <ng-container *ngIf="question?.answer_type === 'single_option'">
                                    <div
                                      class="p-grid"
                                      [ngClass]="questionLoop.classList.contains('right-end') ? 'justify-end' : 'justify-start'"
                                    >
                                      <div class="p-col-4">
                                        <p>{{ question?.question_label }}</p>
                                      </div>
                                      <div class="p-col-8">
                                        : <span style="margin-left: 10px">{{ question?.answer }}</span>
                                      </div>
                                    </div>
                                  </ng-container>
                                  <!----- Multiple Option ------------------------------->
                                  <ng-container *ngIf="question?.answer_type === 'multiple_option'">
                                    <div
                                      class="p-grid"
                                      [ngClass]="questionLoop.classList.contains('right-end') ? 'justify-end' : 'justify-start'"
                                    >
                                      <div class="p-col-4">
                                        <p>{{ question?.question_label }}</p>
                                      </div>
                                      <div class="p-col-8">
                                        :
                                        <span
                                          style="margin-left: 10px"
                                          *ngFor="let answer_multiple of question?.answer_multiple; let isLast = last"
                                          >{{ answer_multiple }}<span *ngIf="!isLast">, </span>
                                        </span>
                                      </div>
                                    </div>
                                  </ng-container>
                                </ng-container>
                              </div>
                            </div>
                            <ng-container *ngIf="segment?.is_multiple_financial_support">
                              <ng-container
                                *ngFor="let addtionalQuestion of segment?.additional_financial_supports; let addtionalIndex = index"
                              >
                                <div class="divider"></div>
                                <div class="p-grid">
                                  <div
                                    #questionLoop2
                                    *ngFor="let question of addtionalQuestion?.questions; let questInd = index"
                                    [ngClass]="[
                                      (addtionalQuestion?.questions[questInd + 1]?.field_position === 'right' &&
                                        question?.field_position !== 'right') ||
                                      (addtionalQuestion?.questions[questInd === 0 ? 0 : questInd - 1]?.field_position === 'left' &&
                                        question?.field_position === 'right')
                                        ? 'p-col-12 p-md-6'
                                        : 'p-col-12 p-md-6 should-full',
                                      questionLoop2.classList.contains('should-full') && question?.field_position === 'right'
                                        ? 'right-end'
                                        : 'left-end'
                                    ]"
                                  >
                                    <!----- IF is_field is TRUE ------------------------------------------------------>
                                    <ng-container *ngIf="question?.is_field">
                                      <ng-container *ngIf="question?.field_type === 'parent_relation'; else default">
                                        <div
                                          class="p-grid"
                                          [ngClass]="questionLoop2.classList.contains('right-end') ? 'justify-end' : 'justify-start'"
                                        >
                                          <div class="p-col-4">
                                            <p>{{ 'FORM_BUILDER_FIELD.' + question?.field_type | translate }}</p>
                                          </div>
                                          <div class="p-col-8">
                                            :
                                            <span style="margin-left: 10px">{{
                                              'CARDDETAIL.RELATION.' + question?.answer | translate
                                            }}</span>
                                          </div>
                                        </div>
                                      </ng-container>
                                      <ng-template #default>
                                        <div
                                          class="p-grid"
                                          [ngClass]="questionLoop2.classList.contains('right-end') ? 'justify-end' : 'justify-start'"
                                        >
                                          <div class="p-col-4">
                                            <p>{{ 'FORM_BUILDER_FIELD.' + question?.field_type | translate }}</p>
                                          </div>
                                          <div class="p-col-8">
                                            :
                                            <span style="margin-left: 10px">{{
                                              question?.field_type === 'financial_support_link'
                                                ? ('CARDDETAIL.RELATION.' + question?.answer | translate)
                                                : question?.field_type === 'financial_support_civility'
                                                ? ('CARDDETAIL.' + question?.answer | translate)
                                                : question?.answer
                                            }}</span>
                                          </div>
                                        </div>
                                      </ng-template>
                                    </ng-container>

                                    <!----- IF is_field is FALSE ------------------------------------------------------>
                                    <ng-container *ngIf="!question?.is_field">
                                      <!----- Free Text ------------------------------->
                                      <ng-container *ngIf="question?.answer_type === 'free_text'">
                                        <div
                                          class="p-grid"
                                          [ngClass]="questionLoop2.classList.contains('right-end') ? 'justify-end' : 'justify-start'"
                                        >
                                          <div class="p-col-4">
                                            <p>{{ question?.question_label }}</p>
                                          </div>
                                          <div class="p-col-8">
                                            : <span style="margin-left: 10px">{{ question?.answer }}</span>
                                          </div>
                                        </div>
                                      </ng-container>
                                      <!----- Long Text ------------------------------->
                                      <ng-container *ngIf="question?.answer_type === 'long_answer'">
                                        <div
                                          class="p-grid"
                                          [ngClass]="questionLoop2.classList.contains('right-end') ? 'justify-end' : 'justify-start'"
                                        >
                                          <div class="p-col-4">
                                            <p>{{ question?.question_label }}</p>
                                          </div>
                                          <div class="p-col-8">
                                            : <span style="margin-left: 10px">{{ question?.answer }}</span>
                                          </div>
                                        </div>
                                      </ng-container>
                                      <!----- Email ------------------------------->
                                      <ng-container *ngIf="question?.answer_type === 'email'">
                                        <div
                                          class="p-grid"
                                          [ngClass]="questionLoop2.classList.contains('right-end') ? 'justify-end' : 'justify-start'"
                                        >
                                          <div class="p-col-4">
                                            <p>{{ question?.question_label }}</p>
                                          </div>
                                          <div class="p-col-8">
                                            : <span style="margin-left: 10px">{{ question?.answer }}</span>
                                          </div>
                                        </div>
                                      </ng-container>
                                      <!----- Date Type ------------------------------->
                                      <ng-container *ngIf="question?.answer_type === 'date'">
                                        <div
                                          class="p-grid"
                                          [ngClass]="questionLoop2.classList.contains('right-end') ? 'justify-end' : 'justify-start'"
                                        >
                                          <div class="p-col-4">
                                            <p>{{ question?.question_label }}</p>
                                          </div>
                                          <div class="p-col-8">
                                            : <span style="margin-left: 10px">{{ question?.answer_date?.date }}</span>
                                          </div>
                                        </div>
                                      </ng-container>
                                      <!----- Numeric ------------------------------->
                                      <ng-container *ngIf="question?.answer_type === 'numeric'">
                                        <div
                                          class="p-grid"
                                          [ngClass]="questionLoop2.classList.contains('right-end') ? 'justify-end' : 'justify-start'"
                                        >
                                          <div class="p-col-4">
                                            <p>{{ question?.question_label }}</p>
                                          </div>
                                          <div class="p-col-8">
                                            : <span style="margin-left: 10px">{{ question?.answer_number }}</span>
                                          </div>
                                        </div>
                                      </ng-container>
                                      <!----- Single Option ------------------------------->
                                      <ng-container *ngIf="question?.answer_type === 'single_option'">
                                        <div
                                          class="p-grid"
                                          [ngClass]="questionLoop2.classList.contains('right-end') ? 'justify-end' : 'justify-start'"
                                        >
                                          <div class="p-col-4">
                                            <p>{{ question?.question_label }}</p>
                                          </div>
                                          <div class="p-col-8">
                                            : <span style="margin-left: 10px">{{ question?.answer }}</span>
                                          </div>
                                        </div>
                                      </ng-container>
                                      <!----- Multiple Option ------------------------------->
                                      <ng-container *ngIf="question?.answer_type === 'multiple_option'">
                                        <div
                                          class="p-grid"
                                          [ngClass]="questionLoop2.classList.contains('right-end') ? 'justify-end' : 'justify-start'"
                                        >
                                          <div class="p-col-4">
                                            <p>{{ question?.question_label }}</p>
                                          </div>
                                          <div class="p-col-8">
                                            :
                                            <span
                                              style="margin-left: 10px"
                                              *ngFor="let answer_multiple of question?.answer_multiple; let isLast = last"
                                              >{{ answer_multiple }}<span *ngIf="!isLast">, </span>
                                            </span>
                                          </div>
                                        </div>
                                      </ng-container>
                                    </ng-container>
                                  </div>
                                </div>
                              </ng-container>
                            </ng-container>
                          </div>
                        </ng-container>
                      </ng-container>
                    </ng-container>

                    <ng-container *ngIf="step?.step_type === 'scholarship_fee'">
                      <div class="p-col-12 pad-ver-none">
                        <div class="p-grid">
                          <div class="p-col-6">
                            <ng-container *ngIf="candidateData?.registration_profile?.discount_on_full_rate === 100 && !registrationFee">
                              <div class="p-grid">
                                <div class="p-col-4">
                                  <p>{{ 'Payment Plan' | translate }} :</p>
                                </div>
                                <div class="p-col-8">
                                  <p>{{ 'None' | translate }}</p>
                                </div>
                              </div>
                            </ng-container>
                            <ng-container *ngIf="candidateData?.registration_profile?.discount_on_full_rate !== 100">
                              <div class="p-grid">
                                <div class="p-col-4">
                                  <p>{{ 'Payment Plan' | translate }} :</p>
                                </div>
                                <div class="p-col-8">
                                  <p>
                                    {{
                                      candidateData?.method_of_payment
                                        ? ('method_of_payment.' + candidateData?.method_of_payment | translate)
                                        : ' '
                                    }}
                                    -
                                    {{ candidateData?.selected_payment_plan?.times ? candidateData?.selected_payment_plan?.times : '0' }}
                                    {{ 'times' | translate }}
                                  </p>
                                </div>
                              </div>
                            </ng-container>
                            <div class="p-grid">
                              <div class="p-col-4">
                                <p>{{ 'Scholarship fees' | translate }} :</p>
                              </div>
                              <div class="p-col-8">
                                <p>{{ rateAmount ? (rateAmount | currency: 'EURO':'':'0.2') : '0' }} €</p>
                              </div>
                            </div>
                            <div class="p-grid" *ngIf="discount !== 0">
                              <div class="p-col-4">
                                <p>{{ 'Discount' | translate }} ({{ discount ? discount : 0 }}%) :</p>
                              </div>
                              <div class="p-col-8">
                                <p>-{{ discountCalculted ? (discountCalculted | currency: 'EURO':'':'0.2') : '0' }} €</p>
                              </div>
                            </div>
                            <div class="p-grid">
                              <div class="p-col-4">
                                <p>{{ 'Registration fees' | translate }} :</p>
                              </div>
                              <div class="p-col-8">
                                <p>{{ registrationFee ? (registrationFee | currency: 'EURO':'':'0.2') : '0' }} €</p>
                              </div>
                            </div>
                            <div class="p-grid">
                              <div class="p-col-4">
                                <p>{{ 'Additional cost' | translate }} :</p>
                              </div>
                              <div class="p-col-8">
                                <p>{{ additionalCost ? (additionalCost | currency: 'EURO':'':'0.2') : '0' }} €</p>
                              </div>
                            </div>
                            <div class="p-grid">
                              <div class="p-col-4">
                                <p>
                                  <b>{{ 'TOTAL' | translate }} :</b>
                                </p>
                              </div>
                              <div class="p-col-8">
                                <p>
                                  <b>{{ calcTotal() | currency: 'EURO':'':'0.2' }} €</b>
                                </p>
                              </div>
                            </div>
                            <div class="p-grid">
                              <div class="p-col-12">
                                <p>
                                  {{ 'Down payment to pay' | translate }} :
                                  <span
                                    >{{
                                      candidateData?.selected_payment_plan?.down_payment
                                        ? (candidateData?.selected_payment_plan?.down_payment | currency: 'EURO':'':'0.2')
                                        : '0'
                                    }}
                                    €</span
                                  >
                                </p>
                              </div>
                            </div>
                          </div>
                          <div class="p-col-6">
                            <div class="p-grid">
                              <div class="p-col-12">
                                <b>{{ 'Amount to pay after the down payment is paid' | translate }} :</b>
                              </div>
                              <div class="p-col-8">
                                <b> {{ calcTotalToPay() | currency: 'EURO':'':'0.2' }} € </b>
                              </div>
                            </div>
                            <br />
                            <ng-container *ngIf="candidateData?.registration_profile?.discount_on_full_rate !== 100">
                              <div class="p-grid">
                                <div class="p-col-8">
                                  <b>{{ 'Details of the terms' | translate }} :</b>
                                </div>
                                <div class="p-col-8">
                                  <p *ngFor="let pay of candidateData?.selected_payment_plan?.payment_date">
                                    > {{ pay?.date }} - {{ pay?.amount ? (pay?.amount | currency: 'EURO':'':'0.2') : '0' }} €
                                  </p>
                                </div>
                              </div>
                            </ng-container>
                          </div>
                        </div>
                      </div>
                    </ng-container>

                    <ng-container *ngIf="step?.step_type === 'finance'">
                      <div class="p-col-12 pad-ver-none">
                        <div class="p-grid">
                          <div class="p-col-12">
                            <div class="p-grid">
                              <div class="p-col-9 info">
                                <p>
                                  <span>{{ 'ADMISIONSTEPFINANCEMENT.Volume of Hours' | translate }}</span>
                                  <span>:</span><span>{{ volumeOfHours }}</span>
                                </p>
                                <p>
                                  <span>{{ 'FinancementContinous.Full rate' | translate }}</span>
                                  <span>:</span><span>{{ fullRate }} €</span>
                                </p>
                                <p>
                                  <span>{{ 'FinancementContinous.Remaining due' | translate }}</span>
                                  <span>:</span><span>{{ total }} €</span>
                                </p>
                              </div>
                            </div>
                          </div>
                          <div class="p-col-12">
                            <table mat-table [dataSource]="dataSource" class="mat-elevation-z8">
                              <ng-container matColumnDef="type">
                                <th
                                  mat-header-cell
                                  *matHeaderCellDef
                                  matTooltip="{{ 'ADMISIONSTEPFINANCEMENT.Type of organization' | translate }}"
                                >
                                  <h5>{{ 'ADMISIONSTEPFINANCEMENT.Type of organization' | translate }}</h5>
                                </th>
                                <td mat-cell *matCellDef="let element" [matTooltip]="renderTooltip(element)">
                                  <ng-container *ngIf="element?.organization_id">
                                    {{ element?.organization_id?.organization_type | translate }}
                                  </ng-container>
                                  <ng-container *ngIf="element?.company_branch_id">
                                    {{ 'Company' | translate }}
                                  </ng-container>
                                  <ng-container *ngIf="!element?.company_branch_id && !element?.organization_id">
                                    {{
                                      element?.organization_type && element?.organization_type === 'Company'
                                        ? ('Company' | translate)
                                        : (element?.organization_type | translate)
                                    }}
                                  </ng-container>
                                  <span *ngIf="!element?.organization_id && !element?.company_branch_id"> - {{ 'other' | translate }}</span>
                                </td>
                              </ng-container>

                              <ng-container matColumnDef="organization">
                                <th mat-header-cell *matHeaderCellDef matTooltip="{{ 'ADMISIONSTEPFINANCEMENT.Organization' | translate }}">
                                  <h5>{{ 'ADMISIONSTEPFINANCEMENT.Organization' | translate }}</h5>
                                </th>
                                <td mat-cell *matCellDef="let element" [matTooltip]="renderTooltipOrganizationName(element)">
                                  <ng-container *ngIf="element?.organization_id">
                                    {{ element?.organization_id?.name }}
                                  </ng-container>
                                  <ng-container *ngIf="element?.company_branch_id">
                                    {{ element?.company_branch_id?.company_name }}
                                  </ng-container>
                                  <ng-container *ngIf="!element?.company_branch_id && !element?.organization_id">
                                    {{ element?.organization_name }}
                                  </ng-container>
                                </td>
                              </ng-container>

                              <ng-container matColumnDef="rate_hour">
                                <th mat-header-cell *matHeaderCellDef matTooltip="{{ 'ADMISIONSTEPFINANCEMENT.Rate/Hour' | translate }}">
                                  <h5>{{ 'ADMISIONSTEPFINANCEMENT.Rate/Hour' | translate }}</h5>
                                </th>
                                <td mat-cell *matCellDef="let element" [matTooltip]="formatDecimal(element?.rate_per_hours)">
                                  {{ formatDecimal(element?.rate_per_hours) }}
                                </td>
                              </ng-container>

                              <ng-container matColumnDef="hours">
                                <th mat-header-cell *matHeaderCellDef matTooltip="{{ 'ADMISIONSTEPFINANCEMENT.Hours' | translate }}">
                                  <h5>{{ 'ADMISIONSTEPFINANCEMENT.Hours' | translate }}</h5>
                                </th>
                                <td mat-cell *matCellDef="let element" [matTooltip]="formatDecimal(element?.hours)">
                                  {{ formatDecimal(element?.hours) }}
                                </td>
                              </ng-container>

                              <ng-container matColumnDef="total">
                                <th mat-header-cell *matHeaderCellDef matTooltip="{{ 'ADMISIONSTEPFINANCEMENT.Total' | translate }}">
                                  <h5>{{ 'ADMISIONSTEPFINANCEMENT.Total' | translate }}</h5>
                                </th>
                                <td mat-cell *matCellDef="let element" [matTooltip]="formatDecimal(element?.total)">
                                  {{ formatDecimal(element?.total) }}
                                </td>
                              </ng-container>

                              <ng-container matColumnDef="status">
                                <th mat-header-cell *matHeaderCellDef matTooltip="{{ 'ADMISIONSTEPFINANCEMENT.Status' | translate }}">
                                  <h5>{{ 'ADMISIONSTEPFINANCEMENT.Status' | translate }}</h5>
                                </th>
                                <td
                                  mat-cell
                                  *matCellDef="let element"
                                  [matTooltip]="'financement_status.' + element?.actual_status | translate"
                                >
                                  {{ 'financement_status.' + element?.actual_status | translate }}
                                </td>
                              </ng-container>

                              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                              <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
                            </table>
                            <div *ngIf="noData | async" class="no-records">
                              {{ 'No record' | translate }}
                            </div>
                          </div>
                        </div>
                      </div>
                    </ng-container>

                    <ng-container *ngIf="step?.step_type === 'document_expected'">
                      <ng-container *ngFor="let segment of step?.segments">
                        <div class="p-col-12 segment-title">
                          <div style="display: flex">
                            <div class="p-col-12">
                              <b style="padding: 0.5em">{{ segment?.segment_title }}</b>
                            </div>
                          </div>
                        </div>

                        <!-- The name and status of document expected -->
                        <div class="p-col-12 pad-ver-none">
                          <div class="p-grid">
                            <ng-container *ngFor="let question of segment?.questions">
                              <div class="full-width left-end">
                                <div class="p-grid justify-start">
                                  <div (click)="setDocumentDisplayed(in, question?.answer)" class="p-col-4">
                                    <p class="document-question-label">{{ question?.question_label }}</p>
                                  </div>
                                  <div class="p-col-8">
                                    <ng-container *ngIf="question?.document_validation_status === 'validated'">
                                      : <span style="margin-left: 10px">{{ 'SummaryForm.Submitted' | translate }}</span>
                                    </ng-container>
                                    <ng-container *ngIf="question?.document_validation_status === 'waiting_for_validation'">
                                      : <span style="margin-left: 10px">{{ 'SummaryForm.Waiting Validation' | translate }}</span>
                                    </ng-container>
                                    <ng-container
                                      *ngIf="
                                        question?.document_validation_status === 'not_validated' ||
                                        question?.document_validation_status === null
                                      "
                                    >
                                      : <span style="margin-left: 10px">{{ 'SummaryForm.Not Submitted' | translate }}</span>
                                    </ng-container>
                                  </div>
                                </div>
                              </div>
                            </ng-container>
                          </div>
                        </div>

                        <!-- The IFRAME for the document expected -->
                        <div
                          class="p-col-12 pad-ver-none"
                          *ngIf="documentExpectedDisplays && documentExpectedDisplays.length && getDocumentSelectedUrl(in)"
                        >
                          <div>
                            <div class="ql-editor document-parent">
                              <div class="img-preview container-view-lanscape">
                                <iframe [src]="getDocumentSelectedUrl(in)" frameBorder="0"></iframe>
                              </div>
                            </div>
                          </div>
                        </div>
                      </ng-container>
                    </ng-container>

                    <ng-container *ngIf="step?.step_type === 'document_to_validate'">
                      <ng-container *ngFor="let segment of step?.segments">
                        <div class="p-col-12 pad-ver-none">
                          <div
                            *ngIf="
                              segment?.questions &&
                              segment?.questions.length &&
                              segment?.questions[0]?.special_question?.document_acceptance_pdf
                            "
                          >
                            <div class="ql-editor document-parent">
                              <div class="img-preview container-view-lanscape">
                                <iframe
                                  [src]="setPreviewUrl(segment?.questions[0]?.special_question?.document_acceptance_pdf)"
                                  frameBorder="0"
                                ></iframe>
                              </div>
                            </div>
                          </div>
                        </div>
                      </ng-container>
                    </ng-container>
                  </ng-container>
                </ng-container>

                <div class="separator"></div>

                <!-- Signature Box -->
                <ng-container>
                  <div class="p-col-12 pad-ver-none">
                    <div class="p-grid">
                      <div class="p-col-12">
                        {{ 'Please check this box which is valid for signing the school contract' | translate }}
                      </div>
                      <div class="p-col-12 signature-box">
                        <mat-checkbox
                          formControlName="signature"
                          [disabled]="formData?.signature_date?.date || formDetail?.is_form_closed"
                          [(ngModel)]="signature"
                          style="padding-left: 15px"
                          >{{ 'Signature' | translate }}</mat-checkbox
                        >
                        <div *ngIf="formattedSignatureDate">{{ formattedSignatureDate }} ({{ 'Paris Time' | translate }})</div>
                      </div>
                    </div>
                  </div>
                </ng-container>
              </form>
            </div>
            <!-- FOOTER -->
            <ng-container>
              <div class="p-grid" style="margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 0.1px solid rgba(0, 0, 0, 0.1)">
                <div class="p-col-12">
                  <div [innerHTML]="stepData?.segments[0]?.questions[0]?.special_question?.summary_footer"></div>
                </div>
              </div>
            </ng-container>

            <div class="center-spinner" *ngIf="isLoading">
              <mat-spinner color="accent"></mat-spinner>
            </div>

            <div *ngIf="!formDetail.isPreview && formDetail?.admission_status !== 'submitted' && !formDetail?.is_form_closed" class="p-grid">
              <div class="p-col-12" style="text-align: end; padding-right: 11px; margin-bottom: 10px">
                <button
                  *ngIf="isValidator && !hasValidatorValidated && formDetail?.admission_status !== 'ask_for_revision'"
                  color="accent"
                  mat-raised-button
                  class="btn-save"
                  matTooltip="{{ 'Reject and Ask for Revision' | translate }} "
                  (click)="onAskForRevision()"
                >
                  {{ 'Reject and Ask for Revision' | translate }}
                </button>
                <!-- ask_for_revision + student = complete revision  -->
                <button
                  *ngIf="formDetail?.isFinalRevisionUser && formDetail?.admission_status === 'ask_for_revision'"
                  color="accent"
                  mat-raised-button
                  matTooltip="{{ 'Complete Revision' | translate }}"
                  (click)="onCompleteRevision()"
                >
                  {{ 'Complete Revision' | translate }}
                </button>
                <button
                  *ngIf="isValidator && !isReceiver && !hasValidatorValidated && formDetail?.admission_status !== 'ask_for_revision'"
                  color="accent"
                  mat-raised-button
                  class="btn-save"
                  matTooltip="{{ 'Validate the Admission Form' | translate }}"
                  [disabled]="!signature"
                  (click)="validateForm()"
                >
                  <mat-icon class="mat-icon-default">
                    <svg style="width: 24px; height: 24px" viewBox="0 0 24 24">
                      <path
                        fill="currentColor"
                        d="M19,19H5V5H15V3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V11H19M7.91,10.08L6.5,11.5L11,16L21,6L19.59,4.58L11,13.17L7.91,10.08Z"
                      />
                    </svg>
                  </mat-icon>
                  {{ 'Validate the Admission Form' | translate }}
                </button>
                <button
                  *ngIf="isReceiver && !isAccepted && formDetail?.admission_status !== 'ask_for_revision'"
                  color="accent"
                  mat-raised-button
                  class="btn-save"
                  matTooltip="{{ 'Next' | translate }}"
                  (click)="submitForm()"
                  [disabled]="!signature"
                >
                  <mat-icon class="mat-icon-default">save</mat-icon>
                  {{ 'Next' | translate }}
                </button>
              </div>
            </div>

            <div *ngIf="formDetail?.isPreview" class="p-grid">
              <div class="p-col-12" style="text-align: end; padding-right: 11px; margin-bottom: 10px">
                <button color="accent" mat-raised-button class="btn-save" matTooltip="{{ 'Next' | translate }}" [disabled]="!signature">
                  <mat-icon class="mat-icon-default">save</mat-icon>
                  {{ 'Next' | translate }}
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</ng-container>

<ng-container *ngIf="processFinish">
  <div style="margin-top: 20px !important; text-align: center">
    <div *ngIf="candidateData?.school?.school_logo">
      <div class="row no-margin msg-pay">{{ 'Thank You For Submitting Your Admission' | translate }}</div>
      <div class="row no-margin payment-img">
        <img class="payment-success" style="height: 385px" [src]="serverimgPath + candidateData?.school?.school_logo" />
      </div>
    </div>
    <div *ngIf="!candidateData?.school?.school_logo">
      <div class="row no-margin msg-pay" style="font-size: 25px; margin-top: 170px !important">
        {{ 'Thank You For Submitting Your Admission' | translate }}
      </div>
    </div>
  </div>
</ng-container>

<div *ngIf="isWaitingForResponse" class="loading-indicator">
  <mat-progress-spinner mode="indeterminate" color="accent"></mat-progress-spinner>
</div>