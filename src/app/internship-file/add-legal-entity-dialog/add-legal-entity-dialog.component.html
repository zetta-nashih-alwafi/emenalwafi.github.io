<div class="dialog-border" cdkDrag cdkDragRootElement=".cdk-overlay-pane" cdkDragHandle>
  <div class="dialogTitleWrapper">
    <div class="p-grid">
      <div class="w-30 no-padding">
        <mat-icon style="vertical-align: middle">add</mat-icon>
      </div>
      <div class="p-col-10 acad-title">
        <h3 *ngIf="!hideButton" class="dialogTitle">
          {{ 'Add Legal entity' | translate }}
        </h3>
        <h3 *ngIf="hideButton" class="dialogTitle">
          {{ 'Edit Legal entity' | translate }}
        </h3>
      </div>
      <div class="w-65 no-padding" [ngStyle]="{ right: showForm || showPatchForm ? '-65px' : '-35px' }">
        <button mat-icon-button class="close-icon float-right" mat-dialog-close tabindex="-1">
          <mat-icon>close</mat-icon>
        </button>
      </div>
    </div>
  </div>
</div>

<div class="p-grid" *ngIf="!hideButton">
  <div class="p-col-5 text-right">
    <button (click)="openSelectExisting()" mat-raised-button color="accent">
      {{ 'Select existing legal entity' | translate }}
    </button>
  </div>
  <div class="p-col-2 text-center">
    {{ 'OR' | translate }}
  </div>
  <div class="p-col-5">
    <button (click)="openForm()" mat-raised-button color="accent">
      {{ 'Create new legal entity' | translate }}
    </button>
  </div>
</div>

<div *ngIf="showExisting && !showForm" style="margin-top: 20px">
  <ng-select
    aria-required="true"
    class="mrgn-btn"
    [items]="listLegalEntity"
    bindLabel="legal_entity_name"
    bindValue="_id"
    [hideSelected]="true"
    clearAllText="Clear"
    [appendTo]="'body'"
    placeholder="{{ 'Select legal entity' | translate }}"
    (change)="selectedLegalEntity($event)"
    [formControl]="listLegalEntityCtrl"
  >
  </ng-select>
</div>

<form [formGroup]="identityForm" *ngIf="showForm || showPatchForm" style="margin-top: 20px">
  <div class="fontColor">
    <mat-dialog-content>
      <div class="p-grid">
        <div class="p-col-12 no-padding">
          <div class="p-grid">
            <div class="p-col-fixed center-label no-padding-left label-align" style="width: 195px">
              <label>{{ 'Legal entity' | translate }}*</label>
            </div>
            <div class="p-col no-padding">
              <mat-form-field floatLabel="never" color="accent">
                <input matInput formControlName="name" required type="text" placeholder="{{ 'Legal entity' | translate }}" />
              </mat-form-field>
            </div>
          </div>
          <div class="p-grid">
            <div class="p-col-fixed center-label no-padding-left label-align" style="width: 195px">
              <label>{{ 'Immatriculation' | translate }}*</label>
            </div>
            <div class="p-col no-padding">
              <mat-form-field floatLabel="never" color="accent">
                <input matInput formControlName="immatriculation" required type="text" placeholder="{{ 'Immatriculation' | translate }}" />
              </mat-form-field>
            </div>
          </div>
          <div class="p-grid">
            <div class="p-col-fixed center-label no-padding-left label-align" style="width: 195px">
              <label>{{ 'SIRET' | translate }}*</label>
            </div>
            <div class="p-col no-padding">
              <mat-form-field floatLabel="never" color="accent">
                <input matInput formControlName="siret" required type="text" placeholder="{{ 'SIRET' | translate }}" />
              </mat-form-field>
            </div>
          </div>
          <div class="p-grid" formGroupName="legal_representative">
            <div class="p-col-fixed center-label no-padding-left label-align" style="width: 195px">
              <label>{{ 'Legal Representative' | translate }}*</label>
            </div>
            <div class="p-col-2 no-padding" style="padding-top: 14px !important">
              <mat-radio-group formControlName="civility" style="font-size: 12px">
                <mat-radio-button style="margin-right: 1rem" value="MR">{{ 'CARDDETAIL.MR' | translate }}</mat-radio-button>
                <mat-radio-button value="MRS">{{ 'CARDDETAIL.MRS' | translate }}</mat-radio-button>
                <ng-container *ngIf="coreService?.neutralCivility">
                  <mat-radio-button style="margin-left: 8px" value="neutral">{{ 'Neutral' | translate }}</mat-radio-button>
                </ng-container>
              </mat-radio-group>
            </div>
            <div class="p-col-2 no-padding" style="margin-right: 15px">
              <mat-form-field floatLabel="never" color="accent">
                <input matInput formControlName="first_name" required type="text" placeholder="{{ 'First Name' | translate }}" />
              </mat-form-field>
            </div>
            <div class="p-col-2 no-padding" style="margin-right: 15px">
              <mat-form-field floatLabel="never" color="accent">
                <input matInput formControlName="last_name" required type="text" placeholder="{{ 'Last Name' | translate }}" />
              </mat-form-field>
            </div>
            <div class="p-col no-padding">
              <mat-form-field floatLabel="never" color="accent">
                <input matInput formControlName="email" required type="text" placeholder="{{ 'Email' | translate }}" />
              </mat-form-field>
            </div>
          </div>
          <div class="p-grid" formGroupName="financial_representative">
            <div class="p-col-fixed center-label no-padding-left label-align" style="width: 195px">
              <label>{{ 'Financial Representative' | translate }}*</label>
            </div>
            <div class="p-col-2 no-padding" style="padding-top: 14px !important">
              <mat-radio-group formControlName="civility" style="font-size: 12px">
                <mat-radio-button style="margin-right: 1rem" value="MR">{{ 'CARDDETAIL.MR' | translate }}</mat-radio-button>
                <mat-radio-button value="MRS">{{ 'CARDDETAIL.MRS' | translate }}</mat-radio-button>
                <ng-container *ngIf="coreService?.neutralCivility">
                  <mat-radio-button style="margin-left: 8px" value="neutral">{{ 'Neutral' | translate }}</mat-radio-button>
                </ng-container>
              </mat-radio-group>
            </div>
            <div class="p-col-2 no-padding" style="margin-right: 15px">
              <mat-form-field floatLabel="never" color="accent">
                <input matInput formControlName="first_name" required type="text" placeholder="{{ 'First Name' | translate }}" />
              </mat-form-field>
            </div>
            <div class="p-col-2 no-padding" style="margin-right: 15px">
              <mat-form-field floatLabel="never" color="accent">
                <input matInput formControlName="last_name" required type="text" placeholder="{{ 'Last Name' | translate }}" />
              </mat-form-field>
            </div>
            <div class="p-col no-padding">
              <mat-form-field floatLabel="never" color="accent">
                <input matInput formControlName="email" required type="text" placeholder="{{ 'Email' | translate }}" />
              </mat-form-field>
            </div>
          </div>
        </div>
      </div>
      <hr style="border-bottom: 1px solid" />
      <div class="p-grid" formGroupName="headquarter_address">
        <div class="p-col-12 no-padding">
          <div class="p-grid">
            <div class="p-col-fixed center-label no-padding-left label-align" style="width: 195px">
              <label>{{ 'Headquarters' | translate }}*</label>
            </div>
            <div class="p-col no-padding"></div>
          </div>
          <div class="p-grid">
            <div class="p-col-4 no-padding">
              <div class="p-grid">
                <div class="p-col-fixed center-label no-padding-left label-align" style="width: 110px">
                  <label>{{ 'Number' | translate }}*</label>
                </div>
                <div class="p-col no-padding" style="padding-right: 20px !important">
                  <mat-form-field floatLabel="never" color="accent">
                    <input matInput formControlName="number" maxlength="5" required type="text" placeholder="{{ 'Number' | translate }}" />
                  </mat-form-field>
                </div>
              </div>
            </div>
            <div class="p-col-8 no-padding">
              <div class="p-grid">
                <div class="p-col-fixed center-label no-padding-left label-align" style="width: 110px">
                  <label>{{ 'Street' | translate }}*</label>
                </div>
                <div class="p-col no-padding">
                  <mat-form-field floatLabel="never" color="accent">
                    <input matInput formControlName="street" required type="text" placeholder="{{ 'Street' | translate }}" />
                  </mat-form-field>
                </div>
              </div>
            </div>
          </div>
          <div class="p-grid">
            <div class="p-col-4 no-padding">
              <div class="p-grid">
                <div class="p-col-fixed center-label no-padding-left label-align" style="width: 110px">
                  <label>{{ 'Postal Code' | translate }}*</label>
                </div>
                <div class="p-col no-padding" style="padding-right: 20px !important">
                  <mat-form-field floatLabel="never" color="accent">
                    <input
                      matInput
                      required
                      maxlength="5"
                      formControlName="postal_code"
                      (keyup)="getPostcodeHeadquartersData()"
                      type="text"
                      placeholder="{{ 'Postal Code' | translate }}"
                    />
                  </mat-form-field>
                </div>
              </div>
            </div>
            <div class="p-col-4 no-padding">
              <div class="p-grid">
                <div class="p-col-fixed center-label no-padding-left label-align" style="width: 110px">
                  <label>{{ 'Country' | translate }}*</label>
                </div>
                <div class="p-col no-padding" style="padding-right: 20px !important">
                  <mat-form-field color="accent" floatLabel="never">
                    <input
                      type="text"
                      placeholder="{{ 'CARDDETAIL.Country' | translate }}"
                      matInput
                      required
                      formControlName="country"
                      [matAutocomplete]="autoCountryHeadquarters"
                      (keyup)="filterCountryHeadquarters()"
                    />
                    <mat-autocomplete #autoCountryHeadquarters="matAutocomplete" (optionSelected)="getPostcodeHeadquartersData()">
                      <mat-option *ngFor="let option of filteredCountry" [value]="option.name">
                        {{ option.name }}
                      </mat-option>
                    </mat-autocomplete>
                  </mat-form-field>
                </div>
              </div>
            </div>
            <div class="p-col-4 no-padding"></div>
          </div>
          <div class="p-grid">
            <div class="p-col-4 no-padding">
              <div class="p-grid">
                <div class="p-col-fixed center-label no-padding-left label-align" style="width: 110px">
                  <label>{{ 'City' | translate }}*</label>
                </div>
                <div class="p-col no-padding" style="padding-right: 20px !important">
                  <mat-form-field color="accent" class="full-width" floatLabel="never">
                    <input
                      type="text"
                      matInput
                      required
                      placeholder="{{ 'CARDDETAIL.City' | translate }}"
                      formControlName="city"
                      [matAutocomplete]="autoCityHeadquarters"
                      (keyup)="filterCityHeadquarters()"
                    />
                    <mat-autocomplete #autoCityHeadquarters="matAutocomplete">
                      <mat-option *ngFor="let option of filteredCities" [value]="option">
                        {{ option }}
                      </mat-option>
                    </mat-autocomplete>
                  </mat-form-field>
                </div>
              </div>
            </div>
            <div class="p-col-4 no-padding">
              <div class="p-grid">
                <div class="p-col-fixed center-label no-padding-left label-align" style="width: 110px">
                  <label>{{ 'Department' | translate }}*</label>
                </div>
                <div class="p-col no-padding" style="padding-right: 20px !important">
                  <mat-form-field color="accent" class="full-width" floatLabel="never">
                    <input
                      type="text"
                      placeholder="{{ 'CARDDETAIL.Department' | translate }}"
                      matInput
                      required
                      formControlName="department"
                      [matAutocomplete]="autoDepartmentHeadquarters"
                      (keyup)="filterDepartmentHeadquarters()"
                    />
                    <mat-autocomplete #autoDepartmentHeadquarters="matAutocomplete">
                      <mat-option *ngFor="let option of filteredDepartments" [value]="option">
                        {{ option }}
                      </mat-option>
                    </mat-autocomplete>
                  </mat-form-field>
                </div>
              </div>
            </div>
            <div class="p-col-4 no-padding">
              <div class="p-grid">
                <div class="p-col-fixed center-label no-padding-left label-align" style="width: 80px">
                  <label>{{ 'Region' | translate }}*</label>
                </div>
                <div class="p-col no-padding">
                  <mat-form-field color="accent" class="full-width" floatLabel="never">
                    <input
                      type="text"
                      matInput
                      required
                      placeholder="{{ 'CARDDETAIL.Region' | translate }}"
                      formControlName="region"
                      [matAutocomplete]="autoRegionHeadquarters"
                      (keyup)="filterRegionHeadquarters()"
                    />
                    <mat-autocomplete #autoRegionHeadquarters="matAutocomplete">
                      <mat-option *ngFor="let option of filteredRegions" [value]="option">
                        {{ option }}
                      </mat-option>
                    </mat-autocomplete>
                  </mat-form-field>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <hr style="border-bottom: 1px solid" />
      <div class="p-grid" formGroupName="bank">
        <div class="p-col-12 no-padding">
          <div class="p-grid">
            <div class="p-col-fixed center-label no-padding-left label-align" style="width: 110px">
              <label>{{ 'Bank' | translate }}*</label>
            </div>
            <div class="p-col no-padding">
              <mat-form-field color="accent" floatLabel="never">
                <input
                  type="text"
                  required
                  placeholder="{{ 'Bank' | translate }}"
                  matInput
                  formControlName="name"
                  [matAutocomplete]="autoBank"
                  (keyup)="filterBank()"
                />
                <mat-autocomplete #autoBank="matAutocomplete">
                  <mat-option *ngFor="let option of filteredBank" [value]="option">
                    {{ option }}
                  </mat-option>
                </mat-autocomplete>
              </mat-form-field>
            </div>
          </div>
          <div class="p-grid">
            <div class="p-col-fixed center-label no-padding-left label-align" style="width: 110px">
              <label>{{ 'IBAN' | translate }}*</label>
            </div>
            <div class="p-col no-padding">
              <mat-form-field floatLabel="never" color="accent">
                <input matInput formControlName="iban" required type="text" placeholder="{{ 'IBAN' | translate }}" />
              </mat-form-field>
            </div>
          </div>
          <div class="p-grid">
            <div class="p-col-fixed center-label no-padding-left label-align" style="width: 110px">
              <label>{{ 'BIC' | translate }}*</label>
            </div>
            <div class="p-col no-padding">
              <mat-form-field floatLabel="never" color="accent">
                <input matInput formControlName="bic" required type="text" placeholder="{{ 'BIC' | translate }}" />
              </mat-form-field>
            </div>
          </div>
          <div class="p-grid">
            <div class="p-col-fixed center-label no-padding-left label-align" style="width: 110px">
              <label>{{ 'Address' | translate }}*</label>
            </div>
            <div class="p-col no-padding">
              <mat-form-field floatLabel="never" color="accent">
                <input matInput formControlName="address" required type="text" placeholder="{{ 'Address' | translate }}" />
              </mat-form-field>
            </div>
          </div>
          <div class="p-grid">
            <div class="p-col-4 no-padding">
              <div class="p-grid">
                <div class="p-col-fixed center-label no-padding-left label-align" style="width: 110px">
                  <label>{{ 'Postal Code' | translate }}*</label>
                </div>
                <div class="p-col no-padding" style="padding-right: 20px !important">
                  <mat-form-field floatLabel="never" color="accent">
                    <input
                      matInput
                      required
                      formControlName="postal_code"
                      (keyup)="getPostcodeBankData()"
                      type="text"
                      maxlength="5"
                      placeholder="{{ 'Postal Code' | translate }}"
                    />
                  </mat-form-field>
                </div>
              </div>
            </div>
            <div class="p-col-4 no-padding">
              <div class="p-grid">
                <div class="p-col-fixed center-label no-padding-left label-align" style="width: 110px">
                  <label>{{ 'Country' | translate }}*</label>
                </div>
                <div class="p-col no-padding" style="padding-right: 20px !important">
                  <mat-form-field color="accent" floatLabel="never">
                    <input
                      type="text"
                      required
                      placeholder="{{ 'CARDDETAIL.Country' | translate }}"
                      matInput
                      formControlName="country"
                      [matAutocomplete]="autoCountry"
                      (keyup)="filterCountryBank()"
                    />
                    <mat-autocomplete #autoCountry="matAutocomplete" (optionSelected)="getPostcodeBankData()">
                      <mat-option *ngFor="let option of filteredCountryBank" [value]="option.name">
                        {{ option.name }}
                      </mat-option>
                    </mat-autocomplete>
                  </mat-form-field>
                </div>
              </div>
            </div>
            <div class="p-col-4 no-padding"></div>
          </div>
          <div class="p-grid">
            <div class="p-col-4 no-padding">
              <div class="p-grid">
                <div class="p-col-fixed center-label no-padding-left label-align" style="width: 110px">
                  <label>{{ 'City' | translate }}*</label>
                </div>
                <div class="p-col no-padding" style="padding-right: 20px !important">
                  <mat-form-field color="accent" class="full-width" floatLabel="never">
                    <input
                      type="text"
                      required
                      matInput
                      placeholder="{{ 'CARDDETAIL.City' | translate }}"
                      formControlName="city"
                      [matAutocomplete]="autoCity"
                      (keyup)="filterCityBank()"
                    />
                    <mat-autocomplete #autoCity="matAutocomplete">
                      <mat-option *ngFor="let option of filteredCitiesBank" [value]="option">
                        {{ option }}
                      </mat-option>
                    </mat-autocomplete>
                  </mat-form-field>
                </div>
              </div>
            </div>
            <div class="p-col-4 no-padding">
              <div class="p-grid">
                <div class="p-col-fixed center-label no-padding-left label-align" style="width: 110px">
                  <label>{{ 'Department' | translate }}*</label>
                </div>
                <div class="p-col no-padding" style="padding-right: 20px !important">
                  <mat-form-field color="accent" class="full-width" floatLabel="never">
                    <input
                      type="text"
                      required
                      placeholder="{{ 'CARDDETAIL.Department' | translate }}"
                      matInput
                      formControlName="department"
                      [matAutocomplete]="autoDepartment"
                      (keyup)="filterDepartmentBank()"
                    />
                    <mat-autocomplete #autoDepartment="matAutocomplete">
                      <mat-option *ngFor="let option of filteredDepartmentsBank" [value]="option">
                        {{ option }}
                      </mat-option>
                    </mat-autocomplete>
                  </mat-form-field>
                </div>
              </div>
            </div>
            <div class="p-col-4 no-padding">
              <div class="p-grid">
                <div class="p-col-fixed center-label no-padding-left label-align" style="width: 80px">
                  <label>{{ 'Region' | translate }}*</label>
                </div>
                <div class="p-col no-padding">
                  <mat-form-field color="accent" class="full-width" floatLabel="never">
                    <input
                      type="text"
                      required
                      matInput
                      placeholder="{{ 'CARDDETAIL.Region' | translate }}"
                      formControlName="region"
                      [matAutocomplete]="autoRegion"
                      (keyup)="filterRegionBank()"
                    />
                    <mat-autocomplete #autoRegion="matAutocomplete">
                      <mat-option *ngFor="let option of filteredRegionsBank" [value]="option">
                        {{ option }}
                      </mat-option>
                    </mat-autocomplete>
                  </mat-form-field>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <hr style="border-bottom: 1px solid" />
      <div class="p-grid">
        <div class="p-col-12 no-padding">
          <div class="p-grid">
            <div class="p-col-fixed center-label no-padding-left label-align" style="width: 150px">
              <label>{{ 'URSSAF Number' | translate }}*</label>
            </div>
            <div class="p-col no-padding">
              <mat-form-field floatLabel="never" color="accent">
                <input matInput formControlName="urrsaf_number" required type="text" placeholder="{{ 'URSSAF Number' | translate }}" />
              </mat-form-field>
            </div>
          </div>
          <div class="p-grid">
            <div class="p-col-fixed center-label no-padding-left label-align" style="width: 150px">
              <label>{{ 'City' | translate }}*</label>
            </div>
            <div class="p-col no-padding">
              <mat-form-field floatLabel="never" color="accent">
                <input matInput formControlName="city" type="text" required placeholder="{{ 'City' | translate }}" />
              </mat-form-field>
            </div>
          </div>
          <div class="p-grid">
            <div class="p-col-fixed center-label no-padding-left label-align" style="width: 150px">
              <label>{{ 'TVA Number' | translate }}*</label>
            </div>
            <div class="p-col no-padding">
              <mat-form-field floatLabel="never" color="accent">
                <input matInput formControlName="tva_number" type="text" required placeholder="{{ 'TVA Number' | translate }}" />
              </mat-form-field>
            </div>
          </div>
        </div>
      </div>
    </mat-dialog-content>
    <mat-dialog-actions align="right">
      <button mat-raised-button type="button" color="warn" mat-dialog-close>{{ 'CANCEL' | translate }}</button>
      <button mat-raised-button color="primary" [disabled]="identityForm.invalid" (click)="submitVerification()">
        {{ 'Validate' | translate }}
      </button>
    </mat-dialog-actions>
  </div>
</form>
