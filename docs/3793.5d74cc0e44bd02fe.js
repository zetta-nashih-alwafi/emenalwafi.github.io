"use strict";(self.webpackChunkGene=self.webpackChunkGene||[]).push([[3793],{13793:(W,h,n)=>{n.d(h,{D:()=>S});var l=n(24006),m=n(65938),u=n(68745),g=n(35226),s=n.n(g),t=n(94650),f=n(50777),d=n(89383),v=n(84075),E=n(94442),D=n(8739),O=n(610),C=n(52688),p=n(73555),T=n(4859),I=n(97392),y=n(51572),_=n(30277),P=n(36895),x=n(88796);const w=["importFile"];function M(o,r){if(1&o){const e=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"div",5)(1,"div",18)(2,"label"),t.\u0275\u0275text(3),t.\u0275\u0275pipe(4,"translate"),t.\u0275\u0275elementEnd()(),t.\u0275\u0275elementStart(5,"div",19)(6,"span"),t.\u0275\u0275text(7),t.\u0275\u0275elementEnd()(),t.\u0275\u0275elementStart(8,"div",20)(9,"input",21,22),t.\u0275\u0275listener("change",function(a){t.\u0275\u0275restoreView(e);const c=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(c.handleInputChange(a))}),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(11,"button",23),t.\u0275\u0275listener("click",function(){t.\u0275\u0275restoreView(e);const a=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(a.openUploadWindow())}),t.\u0275\u0275elementStart(12,"mat-icon",24),t.\u0275\u0275text(13,"add"),t.\u0275\u0275elementEnd(),t.\u0275\u0275text(14),t.\u0275\u0275pipe(15,"translate"),t.\u0275\u0275elementEnd()()()}if(2&o){const e=t.\u0275\u0275nextContext();t.\u0275\u0275advance(3),t.\u0275\u0275textInterpolate(t.\u0275\u0275pipeBind1(4,4,"Data File")),t.\u0275\u0275advance(4),t.\u0275\u0275textInterpolate(null==e.file?null:e.file.name),t.\u0275\u0275advance(4),t.\u0275\u0275property("disabled",e.importForm.invalid||e.isWaitingForResponse||!(null!=e.importForm&&e.importForm.get("file_delimeter").value)||!(null!=e.importForm&&e.importForm.get("school_id").value)),t.\u0275\u0275advance(3),t.\u0275\u0275textInterpolate1(" ",t.\u0275\u0275pipeBind1(15,6,"Import File")," ")}}function R(o,r){if(1&o){const e=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"div",5)(1,"div",25)(2,"button",23),t.\u0275\u0275listener("click",function(){t.\u0275\u0275restoreView(e);const a=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(a.downloadTemplate())}),t.\u0275\u0275elementStart(3,"mat-icon",24),t.\u0275\u0275text(4,"cloud_download"),t.\u0275\u0275elementEnd(),t.\u0275\u0275text(5),t.\u0275\u0275pipe(6,"translate"),t.\u0275\u0275elementEnd()()()}if(2&o){const e=t.\u0275\u0275nextContext();t.\u0275\u0275advance(2),t.\u0275\u0275property("disabled",e.importForm.invalid||e.isWaitingForResponse||!(null!=e.importForm&&e.importForm.get("file_delimeter").value)||!(null!=e.importForm&&e.importForm.get("school_id").value)),t.\u0275\u0275advance(3),t.\u0275\u0275textInterpolate1(" ",t.\u0275\u0275pipeBind1(6,2,"Download Template")," ")}}function F(o,r){1&o&&(t.\u0275\u0275elementStart(0,"div",26),t.\u0275\u0275element(1,"mat-progress-spinner",27),t.\u0275\u0275elementEnd())}let S=(()=>{class o{constructor(e,i,a,c,b,B,N,A,L,U){this.fb=e,this.dialogRef=i,this.rncpTitleService=a,this.translate=c,this.utilService=b,this.financeService=B,this.admissionService=N,this.router=A,this.data=L,this.userService=U,this.isWaitingForResponse=!1,this.templateDownloaded=!1,this.scholars=[],this.scholarFilter=new l.UntypedFormControl(null),this.schoolFilter=new l.UntypedFormControl(null),this.subs=new u.Y,this.delimeter=[{key:"COMMA [ , ]",value:","},{key:"SEMICOLON [ ; ]",value:";"},{key:"TAB [ ]",value:"tab"}]}ngOnInit(){this.isPermission=this.userService.getPermission(),this.currentUser=this.userService.getLocalStorageUser();const e=this.currentUser?.entities?.find(i=>i?.type?.name===this.isPermission[0]);this.currentUserTypeId=e?.type?._id,this.data&&this.data.scholar_season&&(this.scholarId=this.data.scholar_season),this.delimeter=[{key:this.translate.instant("STUDENT_IMPORT.DELIMETER.COMMA"),value:","},{key:this.translate.instant("STUDENT_IMPORT.DELIMETER.SEMICOLON"),value:";"},{key:this.translate.instant("STUDENT_IMPORT.DELIMETER.TAB"),value:"tab"}],this.initForm(),this.getDataScholarSeasons(),this.getDataSchool(),console.log(this.data)}initForm(){this.importForm=this.fb.group({school_id:[this.data&&this.data.school_id?this.data.school_id:null,[l.Validators.required]],scholar_season:[this.scholarId],file_delimeter:[";",[l.Validators.required]]})}handleInputChange(e){this.isWaitingForResponse=!0;const i=e.target.files[0];this.file=e.target.files[0],console.log(i);const c=this.utilService.getFileExtension(i.name).toLocaleLowerCase();console.log(c),["csv","tsv"].includes(c)?this.isWaitingForResponse=!1:(this.file=null,this.isWaitingForResponse=!1,s().fire({type:"info",title:this.translate.instant("UPLOAD_ERROR.WRONG_TYPE_TITLE"),text:this.translate.instant("UPLOAD_ERROR.WRONG_TYPE_TEXT",{file_exts:".csv, .tsv"}),allowEscapeKey:!1,allowOutsideClick:!1,allowEnterKey:!1}))}openUploadWindow(){this.importFile.nativeElement.click()}submit(){this.data&&this.callCheckImportAPI()}callCheckImportAPI(){this.isWaitingForResponse=!0,console.log(this.file),this.subs.sink=this.financeService.ImportDownPayment(this.importForm.value,this.file).subscribe(e=>{this.isWaitingForResponse=!1,console.log(e),s().fire({type:"success",title:this.translate.instant("Bravo!"),confirmButtonText:this.translate.instant("OK"),allowEnterKey:!1,allowEscapeKey:!1,allowOutsideClick:!1}).then(()=>{this.dialogRef.close(!0)})},e=>{this.isWaitingForResponse=!1,e&&e.message&&e.message.includes("Network error: Http failure response for")?s().fire({type:"warning",title:this.translate.instant("BAD_CONNECTION.Title"),html:this.translate.instant("BAD_CONNECTION.Text"),confirmButtonText:this.translate.instant("BAD_CONNECTION.Button"),allowOutsideClick:!1,allowEnterKey:!1,allowEscapeKey:!1}):s().fire({type:"info",title:this.translate.instant("SORRY"),text:e&&e.message?this.translate.instant(e.message.replaceAll("GraphQL error: ","")):e,confirmButtonText:this.translate.instant("DISCONNECT_SCHOOL.BUTTON3")})})}getDataScholarSeasons(){this.subs.sink=this.financeService.GetAllScholarSeasons().subscribe(e=>{e&&e.length&&(this.scholars=e,this.importForm.get("scholar_season").value||this.importForm.get("scholar_season").setValue(this.scholars[0]._id))},e=>{e&&e.message&&e.message.includes("Network error: Http failure response for")?s().fire({type:"warning",title:this.translate.instant("BAD_CONNECTION.Title"),html:this.translate.instant("BAD_CONNECTION.Text"),confirmButtonText:this.translate.instant("BAD_CONNECTION.Button"),allowOutsideClick:!1,allowEnterKey:!1,allowEscapeKey:!1}):s().fire({type:"info",title:this.translate.instant("SORRY"),text:e&&e.message?this.translate.instant(e.message.replaceAll("GraphQL error: ","")):e,confirmButtonText:this.translate.instant("DISCONNECT_SCHOOL.BUTTON3")})})}getDataSchool(){this.subs.sink=this.admissionService.GetAllSchoolScholar([],this.scholarId,this.currentUserTypeId).subscribe(i=>{i&&i.length&&(this.dataSchoolOriginal=i,this.importForm.get("school_id").value||this.importForm.get("school_id").setValue(this.scholars[0]._id))},i=>{i&&i.message&&i.message.includes("Network error: Http failure response for")?s().fire({type:"warning",title:this.translate.instant("BAD_CONNECTION.Title"),html:this.translate.instant("BAD_CONNECTION.Text"),confirmButtonText:this.translate.instant("BAD_CONNECTION.Button"),allowOutsideClick:!1,allowEnterKey:!1,allowEscapeKey:!1}):s().fire({type:"info",title:this.translate.instant("SORRY"),text:i&&i.message?this.translate.instant(i.message.replaceAll("GraphQL error: ","")):i,confirmButtonText:this.translate.instant("DISCONNECT_SCHOOL.BUTTON3")})})}downloadTemplate(){this.templateDownloaded=!0,this.financeService.downloadDownPaymentTemplateCSV(this.importForm.get("file_delimeter").value,this.importForm.get("scholar_season").value,this.importForm.get("school_id").value),this.importForm.get("file_delimeter").disable(),this.importForm.get("scholar_season").disable(),this.importForm.get("school_id").disable()}resetValue(){this.templateDownloaded=!1,this.importForm.get("file_delimeter").setValue(null),this.importForm.get("school_id").setValue(null),this.importForm.get("file_delimeter").reset(),this.importForm.get("school_id").reset(),this.importForm.get("file_delimeter").enable(),this.importForm.get("school_id").enable(),this.importForm.get("file_delimeter").clearValidators(),this.importForm.get("school_id").clearValidators(),this.importForm.get("file_delimeter").updateValueAndValidity(),this.importForm.get("school_id").updateValueAndValidity()}swalError(e){console.log("[Response BE][Error] : ",e),s().fire({type:"info",title:this.translate.instant("SORRY"),text:e&&e.message?this.translate.instant(e.message.replaceAll("GraphQL error: ","")):e,confirmButtonText:this.translate.instant("DISCONNECT_SCHOOL.BUTTON3")})}closeDialog(){this.dialogRef.close()}ngOnDestroy(){this.subs.unsubscribe()}}return o.\u0275fac=function(e){return new(e||o)(t.\u0275\u0275directiveInject(l.UntypedFormBuilder),t.\u0275\u0275directiveInject(m.so),t.\u0275\u0275directiveInject(f.r),t.\u0275\u0275directiveInject(d.sK),t.\u0275\u0275directiveInject(v.t),t.\u0275\u0275directiveInject(E.N),t.\u0275\u0275directiveInject(D.Q),t.\u0275\u0275directiveInject(O.gz),t.\u0275\u0275directiveInject(m.WI),t.\u0275\u0275directiveInject(C.e))},o.\u0275cmp=t.\u0275\u0275defineComponent({type:o,selectors:[["ms-import-down-payment-dialog"]],viewQuery:function(e,i){if(1&e&&t.\u0275\u0275viewQuery(w,5),2&e){let a;t.\u0275\u0275queryRefresh(a=t.\u0275\u0275loadQuery())&&(i.importFile=a.first)}},decls:34,vars:24,consts:[["cdkDrag","","cdkDragRootElement",".cdk-overlay-pane","cdkDragHandle","",1,"header-div"],["svgIcon","file-upload"],[1,"header-text"],["mat-icon-button","","type","button",1,"header-icon",3,"click"],[1,"pad-x-md","pad-t-md",3,"formGroup"],[1,"p-grid"],[1,"p-col-12",2,"float","left"],[1,"p-grid",2,"margin-bottom","25px"],[1,"title-school",2,"width","100%"],[1,"school-name"],[1,"class-scholar",2,"width","100%"],["bindLabel","key","bindValue","value","formControlName","file_delimeter",1,"mrgn-btn",3,"disabled","items","appendTo","multiple","placeholder"],["class","p-grid",4,"ngIf"],["fxLayout","row","fxLayoutAlign","end center",1,"footer-form"],["mat-raised-button","","color","accent","type","button",3,"disabled","click"],["mat-raised-button","","color","primary","type","button",3,"click"],["mat-raised-button","","color","warn","type","button",3,"click"],["class","loading-indicator",4,"ngIf"],[1,"p-col-3",2,"padding","0.5em 0px","float","left"],[1,"p-col-6",2,"padding","0.5em 0px","float","left"],[1,"p-col-3",2,"padding","0px","float","left","text-align","right"],["type","file","accept",".csv, .tsv","disableMultipart","true",2,"display","none",3,"change"],["importFile",""],["mat-raised-button","","color","accent",1,"margin-right-0",3,"disabled","click"],[1,"mat-icon-default"],[1,"p-col-12",2,"padding","0.5em 0px","float","right","text-align","right"],[1,"loading-indicator"],["mode","indeterminate","color","accent"]],template:function(e,i){1&e&&(t.\u0275\u0275elementStart(0,"div",0),t.\u0275\u0275element(1,"mat-icon",1),t.\u0275\u0275elementStart(2,"h2",2),t.\u0275\u0275text(3),t.\u0275\u0275pipe(4,"translate"),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(5,"button",3),t.\u0275\u0275listener("click",function(){return i.closeDialog()}),t.\u0275\u0275elementStart(6,"mat-icon"),t.\u0275\u0275text(7,"close"),t.\u0275\u0275elementEnd()()(),t.\u0275\u0275element(8,"hr"),t.\u0275\u0275elementStart(9,"div",4)(10,"div",5)(11,"div",6)(12,"div",7)(13,"div",8)(14,"div",9)(15,"div",10),t.\u0275\u0275element(16,"ng-select",11),t.\u0275\u0275pipe(17,"translate"),t.\u0275\u0275elementEnd()()()(),t.\u0275\u0275template(18,M,16,8,"div",12),t.\u0275\u0275template(19,R,7,4,"div",12),t.\u0275\u0275elementEnd()()(),t.\u0275\u0275elementStart(20,"div",13)(21,"div")(22,"button",14),t.\u0275\u0275listener("click",function(){return i.submit()}),t.\u0275\u0275text(23),t.\u0275\u0275pipe(24,"translate"),t.\u0275\u0275elementEnd()(),t.\u0275\u0275elementStart(25,"div")(26,"button",15),t.\u0275\u0275listener("click",function(){return i.resetValue()}),t.\u0275\u0275text(27),t.\u0275\u0275pipe(28,"translate"),t.\u0275\u0275elementEnd()(),t.\u0275\u0275elementStart(29,"div")(30,"button",16),t.\u0275\u0275listener("click",function(){return i.closeDialog()}),t.\u0275\u0275text(31),t.\u0275\u0275pipe(32,"translate"),t.\u0275\u0275elementEnd()()(),t.\u0275\u0275template(33,F,2,0,"div",17)),2&e&&(t.\u0275\u0275advance(3),t.\u0275\u0275textInterpolate1(" ",t.\u0275\u0275pipeBind1(4,14,"IMPORT_TEMPLATE.IMPORT")," "),t.\u0275\u0275advance(6),t.\u0275\u0275property("formGroup",i.importForm),t.\u0275\u0275advance(7),t.\u0275\u0275propertyInterpolate("placeholder",t.\u0275\u0275pipeBind1(17,16,"Delimeter")),t.\u0275\u0275property("disabled",i.templateDownloaded)("items",i.delimeter)("appendTo","body")("multiple",!1),t.\u0275\u0275advance(2),t.\u0275\u0275property("ngIf",i.templateDownloaded),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",!i.templateDownloaded),t.\u0275\u0275advance(3),t.\u0275\u0275property("disabled",!i.file),t.\u0275\u0275advance(1),t.\u0275\u0275textInterpolate1(" ",t.\u0275\u0275pipeBind1(24,18,"Import")," "),t.\u0275\u0275advance(4),t.\u0275\u0275textInterpolate1(" ",t.\u0275\u0275pipeBind1(28,20,"Reset")," "),t.\u0275\u0275advance(4),t.\u0275\u0275textInterpolate1(" ",t.\u0275\u0275pipeBind1(32,22,"Cancel")," "),t.\u0275\u0275advance(2),t.\u0275\u0275property("ngIf",i.isWaitingForResponse))},dependencies:[p.Zt,p.Bh,T.lW,I.Hw,y.Ou,l.NgControlStatus,l.NgControlStatusGroup,l.FormGroupDirective,l.FormControlName,_.xw,_.Wh,P.O5,x.w9,d.X$],styles:[".header-form[_ngcontent-%COMP%]{padding:18px}.footer-form[_ngcontent-%COMP%]{padding:0 18px 18px}[_nghost-%COMP%]  .ng-select .ng-select-container{background-color:#fff0;color:#000;border:none;border-radius:0!important;border-bottom:1px solid #8c8c8c!important;min-height:36px;align-items:center}[_nghost-%COMP%]  .mat-select-arrow-wrapper{padding-right:5px}[_nghost-%COMP%]  .mat-select-value-text{margin-left:10px;font-size:13px}[_nghost-%COMP%]  ng-dropdown-panel{z-index:99999999999}[_nghost-%COMP%]  .ng-select .ng-select-container .ng-value-container .ng-input>input{color:#000;box-sizing:content-box;background:none;border:0;box-shadow:none;outline:0;cursor:default;width:100%}.class-scholar[_ngcontent-%COMP%]{width:150px;display:inline-block;vertical-align:middle;margin-right:10px}.title-school[_ngcontent-%COMP%]{margin-right:10px}"]}),o})()}}]);